71a8fb7071e7dbf42e118e402387bbb5
"use strict";
/**
 * Comprehensive TDD Tests for NeuralMeshService - Additional Coverage
 * Target: Push coverage from 75% to >95% using systematic TDD approach
 * Focus: Edge cases, error paths, and uncovered methods
 */
Object.defineProperty(exports, "__esModule", { value: true });
const NeuralMeshService_1 = require("../../../src/services/NeuralMeshService");
// Mock all external dependencies
global.WebSocket = jest.fn().mockImplementation(() => ({
    addEventListener: jest.fn(),
    removeEventListener: jest.fn(),
    close: jest.fn(),
    send: jest.fn(),
    readyState: 1,
    onopen: null,
    onmessage: null,
    onerror: null,
    onclose: null
}));
global.fetch = jest.fn().mockResolvedValue({
    json: jest.fn().mockResolvedValue({ success: true, data: {} })
});
describe('NeuralMeshService - Comprehensive Coverage Tests', () => {
    let service;
    beforeEach(() => {
        jest.clearAllMocks();
        service = new NeuralMeshService_1.NeuralMeshService({
            serverUrl: 'ws://localhost:3000',
            transport: 'websocket',
            enableWasm: true,
            enableRealtime: true,
            debugMode: true
        });
    });
    afterEach(async () => {
        if (service) {
            await service.shutdown();
        }
    });
    describe('Configuration Edge Cases', () => {
        test('should handle empty configuration object', () => {
            const emptyService = new NeuralMeshService_1.NeuralMeshService({});
            expect(emptyService).toBeDefined();
            expect(emptyService.getConnectionStatus()).toBeNull();
        });
        test('should handle undefined configuration', () => {
            const undefinedService = new NeuralMeshService_1.NeuralMeshService();
            expect(undefinedService).toBeDefined();
            expect(undefinedService.isWasmEnabled()).toBe(false);
        });
        test('should handle partial configuration with all transports', () => {
            const httpService = new NeuralMeshService_1.NeuralMeshService({ transport: 'http' });
            const stdioService = new NeuralMeshService_1.NeuralMeshService({ transport: 'stdio' });
            const wsService = new NeuralMeshService_1.NeuralMeshService({ transport: 'websocket' });
            expect(httpService).toBeDefined();
            expect(stdioService).toBeDefined();
            expect(wsService).toBeDefined();
        });
    });
    describe('Transport Layer Coverage', () => {
        test('should initialize HTTP transport successfully', async () => {
            const httpService = new NeuralMeshService_1.NeuralMeshService({
                serverUrl: 'http://localhost:3000',
                transport: 'http',
                enableWasm: false,
                debugMode: true
            });
            const connected = await httpService.initialize();
            expect(connected).toBe(true);
            expect(httpService.getConnectionStatus()?.status).toBe('connected');
            await httpService.shutdown();
        });
        test('should initialize STDIO transport successfully', async () => {
            const stdioService = new NeuralMeshService_1.NeuralMeshService({
                transport: 'stdio',
                enableWasm: true,
                debugMode: false
            });
            const connected = await stdioService.initialize();
            expect(connected).toBe(true);
            expect(stdioService.isWasmEnabled()).toBe(true);
            await stdioService.shutdown();
        });
        test('should handle unsupported transport type', async () => {
            const badService = new NeuralMeshService_1.NeuralMeshService({
                transport: 'invalid',
                debugMode: true
            });
            const connected = await badService.initialize();
            expect(connected).toBe(false);
            expect(badService.getConnectionStatus()?.status).toBe('error');
        });
    });
    describe('WebSocket Connection Edge Cases', () => {
        test('should handle WebSocket connection timeout', async () => {
            let eventCallback;
            const mockWS = {
                addEventListener: jest.fn((event, callback) => {
                    eventCallback = callback;
                    // Don't trigger any events to simulate timeout
                }),
                close: jest.fn(),
                send: jest.fn(),
                readyState: 0 // CONNECTING
            };
            global.WebSocket.mockImplementation(() => mockWS);
            const connected = await service.initialize();
            expect(connected).toBe(false);
        });
        test('should handle WebSocket with immediate error', async () => {
            const mockWS = {
                addEventListener: jest.fn((event, callback) => {
                    if (event === 'error') {
                        // Immediate error
                        callback({ type: 'error', message: 'Connection refused' });
                    }
                }),
                close: jest.fn(),
                send: jest.fn(),
                readyState: 3 // CLOSED
            };
            global.WebSocket.mockImplementation(() => mockWS);
            const connected = await service.initialize();
            expect(connected).toBe(false);
            expect(service.getConnectionStatus()?.status).toBe('error');
        });
        test('should handle message processing', async () => {
            const mockWS = {
                addEventListener: jest.fn((event, callback) => {
                    if (event === 'open') {
                        setTimeout(() => callback({ type: 'open' }), 1);
                    }
                    else if (event === 'message') {
                        setTimeout(() => {
                            callback({
                                data: JSON.stringify({
                                    type: 'test',
                                    payload: { message: 'Hello from neural mesh' }
                                })
                            });
                        }, 5);
                    }
                }),
                close: jest.fn(),
                send: jest.fn(),
                readyState: 1
            };
            global.WebSocket.mockImplementation(() => mockWS);
            const connected = await service.initialize();
            expect(connected).toBe(true);
            // Trigger message event
            const messageCallback = mockWS.addEventListener.mock.calls.find(call => call[0] === 'message')?.[1];
            if (messageCallback) {
                messageCallback({
                    data: JSON.stringify({ type: 'neural_update', data: { activity: 0.75 } })
                });
            }
        });
    });
    describe('WASM Integration Coverage', () => {
        test('should handle WASM initialization failure gracefully', async () => {
            const wasmService = new NeuralMeshService_1.NeuralMeshService({
                transport: 'stdio',
                enableWasm: true,
                debugMode: true
            });
            // Mock WASM failure by overriding the private method
            const originalInitWasm = wasmService.initializeWasm;
            wasmService.initializeWasm = jest.fn().mockRejectedValue(new Error('WASM failed'));
            const connected = await wasmService.initialize();
            expect(connected).toBe(true); // Should still connect without WASM
            expect(wasmService.isWasmEnabled()).toBe(false); // But WASM should be disabled
            await wasmService.shutdown();
        });
        test('should process inference with WASM disabled', async () => {
            const jsService = new NeuralMeshService_1.NeuralMeshService({
                transport: 'stdio',
                enableWasm: false,
                debugMode: true
            });
            await jsService.initialize();
            const input = new Float32Array([0.1, 0.2, 0.3, 0.4, 0.5]);
            const result = await jsService.processInference(input);
            expect(result.output).toBeInstanceOf(Float32Array);
            expect(result.output.length).toBe(input.length);
            expect(result.metrics.simdAccelerated).toBe(false);
            expect(result.metrics.executionTime).toBeGreaterThan(0);
            await jsService.shutdown();
        });
        test('should handle different input sizes for inference', async () => {
            const wasmService = new NeuralMeshService_1.NeuralMeshService({
                transport: 'stdio',
                enableWasm: true,
                debugMode: false
            });
            await wasmService.initialize();
            // Test various input sizes
            const testSizes = [1, 10, 100, 1000];
            for (const size of testSizes) {
                const input = new Float32Array(size).fill(0.5);
                const result = await wasmService.processInference(input);
                expect(result.output.length).toBe(size);
                expect(result.metrics.inputSize).toBe(size);
                expect(result.metrics.outputSize).toBe(size);
            }
            await wasmService.shutdown();
        });
    });
    describe('Agent Lifecycle Coverage', () => {
        test('should handle agent creation with minimal config', async () => {
            const service = new NeuralMeshService_1.NeuralMeshService({ transport: 'stdio' });
            await service.initialize();
            const agent = await service.spawnAgent({});
            expect(agent.id).toBeDefined();
            expect(agent.type).toBe('worker');
            expect(agent.neuralProperties.nodeType).toBe('inter');
            expect(agent.neuralProperties.layer).toBe(1);
            expect(agent.neuralProperties.threshold).toBe(0.5);
            await service.shutdown();
        });
        test('should handle agent creation with full config', async () => {
            const service = new NeuralMeshService_1.NeuralMeshService({ transport: 'stdio' });
            await service.initialize();
            const fullConfig = {
                id: 'test-agent-full',
                type: 'coordinator',
                capabilities: ['planning', 'coordination'],
                metadata: { role: 'leader', priority: 'high' },
                neuralProperties: {
                    neuronId: 'neuron-123',
                    meshId: 'mesh-456',
                    nodeType: 'pyramidal',
                    layer: 3,
                    threshold: 0.8,
                    activation: 0.2,
                    connections: ['neuron-1', 'neuron-2'],
                    spikeHistory: [0.1, 0.3, 0.7],
                    lastSpike: new Date()
                },
                wasmMetrics: {
                    executionTime: 5.5,
                    memoryUsage: 2.1,
                    simdAcceleration: true,
                    performanceScore: 0.95
                }
            };
            const agent = await service.spawnAgent(fullConfig);
            expect(agent.id).toBe('test-agent-full');
            expect(agent.type).toBe('coordinator');
            expect(agent.neuralProperties.nodeType).toBe('pyramidal');
            expect(agent.neuralProperties.layer).toBe(3);
            expect(agent.neuralProperties.threshold).toBe(0.8);
            await service.shutdown();
        });
        test('should update connection stats when spawning agents', async () => {
            const service = new NeuralMeshService_1.NeuralMeshService({ transport: 'stdio', debugMode: true });
            await service.initialize();
            const initialStatus = service.getConnectionStatus();
            expect(initialStatus?.nodeCount).toBe(0);
            await service.spawnAgent({ id: 'agent-1' });
            await service.spawnAgent({ id: 'agent-2' });
            const updatedStatus = service.getConnectionStatus();
            expect(updatedStatus?.nodeCount).toBe(2);
            await service.shutdown();
        });
    });
    describe('Error Handling Coverage', () => {
        test('should throw error when spawning agent without connection', async () => {
            const disconnectedService = new NeuralMeshService_1.NeuralMeshService();
            await expect(disconnectedService.spawnAgent({ id: 'test' }))
                .rejects.toThrow('Neural mesh not connected');
        });
        test('should throw error when processing inference without connection', async () => {
            const disconnectedService = new NeuralMeshService_1.NeuralMeshService();
            await expect(disconnectedService.processInference(new Float32Array([1, 2, 3])))
                .rejects.toThrow('Neural mesh not connected');
        });
        test('should handle initialization error with WASM enabled', async () => {
            const service = new NeuralMeshService_1.NeuralMeshService({
                transport: 'invalid',
                enableWasm: true,
                debugMode: true
            });
            const connected = await service.initialize();
            expect(connected).toBe(false);
            expect(service.getConnectionStatus()?.status).toBe('error');
        });
    });
    describe('Shutdown and Cleanup Coverage', () => {
        test('should cleanup all resources on shutdown', async () => {
            const service = new NeuralMeshService_1.NeuralMeshService({
                transport: 'stdio',
                enableWasm: true,
                enableRealtime: true,
                debugMode: true
            });
            await service.initialize();
            expect(service.getConnectionStatus()).not.toBeNull();
            expect(service.isWasmEnabled()).toBe(true);
            await service.shutdown();
            expect(service.getConnectionStatus()).toBeNull();
        });
        test('should handle shutdown when not initialized', async () => {
            const service = new NeuralMeshService_1.NeuralMeshService();
            // Should not throw error
            await expect(service.shutdown()).resolves.not.toThrow();
        });
        test('should handle multiple shutdown calls', async () => {
            const service = new NeuralMeshService_1.NeuralMeshService({ transport: 'stdio' });
            await service.initialize();
            await service.shutdown();
            await service.shutdown(); // Second call should be safe
            await service.shutdown(); // Third call should be safe
        });
    });
    describe('Performance Edge Cases', () => {
        test('should handle very large inference batches', async () => {
            const service = new NeuralMeshService_1.NeuralMeshService({
                transport: 'stdio',
                enableWasm: true,
                debugMode: false
            });
            await service.initialize();
            const largeInput = new Float32Array(10000).fill(0.5);
            const result = await service.processInference(largeInput);
            expect(result.output.length).toBe(10000);
            expect(result.metrics.executionTime).toBeGreaterThan(0);
            expect(result.metrics.memoryUsage).toBeGreaterThan(0);
            await service.shutdown();
        });
        test('should handle rapid agent spawning', async () => {
            const service = new NeuralMeshService_1.NeuralMeshService({
                transport: 'stdio',
                debugMode: false
            });
            await service.initialize();
            const agents = [];
            const spawnPromises = [];
            for (let i = 0; i < 50; i++) {
                spawnPromises.push(service.spawnAgent({ id: `rapid-agent-${i}` }));
            }
            const spawnedAgents = await Promise.all(spawnPromises);
            expect(spawnedAgents).toHaveLength(50);
            expect(service.getConnectionStatus()?.nodeCount).toBe(50);
            await service.shutdown();
        });
    });
    describe('Debug Mode Coverage', () => {
        test('should log debug messages when debug mode enabled', async () => {
            const consoleSpy = jest.spyOn(console, 'log').mockImplementation();
            const debugService = new NeuralMeshService_1.NeuralMeshService({
                transport: 'stdio',
                enableWasm: true,
                debugMode: true
            });
            await debugService.initialize();
            await debugService.spawnAgent({ id: 'debug-agent' });
            await debugService.processInference(new Float32Array([0.5]));
            await debugService.shutdown();
            expect(consoleSpy).toHaveBeenCalled();
            consoleSpy.mockRestore();
        });
        test('should not log debug messages when debug mode disabled', async () => {
            const consoleSpy = jest.spyOn(console, 'log').mockImplementation();
            const silentService = new NeuralMeshService_1.NeuralMeshService({
                transport: 'stdio',
                enableWasm: false,
                debugMode: false
            });
            await silentService.initialize();
            await silentService.shutdown();
            // Should have minimal or no console output
            const debugCalls = consoleSpy.mock.calls.filter(call => call.some(arg => typeof arg === 'string' && arg.includes('🧠')));
            expect(debugCalls.length).toBe(0);
            consoleSpy.mockRestore();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL3dvcmtzcGFjZXMvYWdlbnRpc3RzLXF1aWNrc3RhcnQtd29ya3NwYWNlLWJhc2ljL3Nhc2kvdGVzdHMvdW5pdC9zZXJ2aWNlcy9OZXVyYWxNZXNoU2VydmljZS1jb21wcmVoZW5zaXZlLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7O0dBSUc7O0FBRUgsK0VBQTJHO0FBRzNHLGlDQUFpQztBQUNqQyxNQUFNLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3JELGdCQUFnQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDM0IsbUJBQW1CLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUM5QixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNoQixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNmLFVBQVUsRUFBRSxDQUFDO0lBQ2IsTUFBTSxFQUFFLElBQUk7SUFDWixTQUFTLEVBQUUsSUFBSTtJQUNmLE9BQU8sRUFBRSxJQUFJO0lBQ2IsT0FBTyxFQUFFLElBQUk7Q0FDZCxDQUFDLENBQUMsQ0FBQztBQUVKLE1BQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDO0lBQ3pDLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsQ0FBQztDQUMvRCxDQUFDLENBQUM7QUFFSCxRQUFRLENBQUMsa0RBQWtELEVBQUUsR0FBRyxFQUFFO0lBQ2hFLElBQUksT0FBMEIsQ0FBQztJQUUvQixVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3JCLE9BQU8sR0FBRyxJQUFJLHFDQUFpQixDQUFDO1lBQzlCLFNBQVMsRUFBRSxxQkFBcUI7WUFDaEMsU0FBUyxFQUFFLFdBQVc7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QUFDO2dCQUMxQyxTQUFTLEVBQUUsT0FBTztnQkFDbEIsVUFBVSxFQUFFLEtBQUs7Z0JBQ2pCLFNBQVMsRUFBRSxLQUFLO2FBQ2pCLENBQUMsQ0FBQztZQUVILE1BQU0sYUFBYSxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBQ2pDLE1BQU0sYUFBYSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBRS9CLDJDQUEyQztZQUMzQyxNQUFNLFVBQVUsR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FDckQsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLE9BQU8sR0FBRyxLQUFLLFFBQVEsSUFBSSxHQUFHLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQ2hFLENBQUM7WUFDRixNQUFNLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUVsQyxVQUFVLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDM0IsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi93b3Jrc3BhY2VzL2FnZW50aXN0cy1xdWlja3N0YXJ0LXdvcmtzcGFjZS1iYXNpYy9zYXNpL3Rlc3RzL3VuaXQvc2VydmljZXMvTmV1cmFsTWVzaFNlcnZpY2UtY29tcHJlaGVuc2l2ZS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29tcHJlaGVuc2l2ZSBUREQgVGVzdHMgZm9yIE5ldXJhbE1lc2hTZXJ2aWNlIC0gQWRkaXRpb25hbCBDb3ZlcmFnZVxuICogVGFyZ2V0OiBQdXNoIGNvdmVyYWdlIGZyb20gNzUlIHRvID45NSUgdXNpbmcgc3lzdGVtYXRpYyBUREQgYXBwcm9hY2hcbiAqIEZvY3VzOiBFZGdlIGNhc2VzLCBlcnJvciBwYXRocywgYW5kIHVuY292ZXJlZCBtZXRob2RzXG4gKi9cblxuaW1wb3J0IHsgTmV1cmFsTWVzaFNlcnZpY2UsIE5ldXJhbE1lc2hDb25maWcsIE5ldXJhbEFnZW50IH0gZnJvbSAnLi4vLi4vLi4vc3JjL3NlcnZpY2VzL05ldXJhbE1lc2hTZXJ2aWNlJztcbmltcG9ydCB7IHBlcmZvcm1hbmNlIH0gZnJvbSAncGVyZl9ob29rcyc7XG5cbi8vIE1vY2sgYWxsIGV4dGVybmFsIGRlcGVuZGVuY2llc1xuZ2xvYmFsLldlYlNvY2tldCA9IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgYWRkRXZlbnRMaXN0ZW5lcjogamVzdC5mbigpLFxuICByZW1vdmVFdmVudExpc3RlbmVyOiBqZXN0LmZuKCksXG4gIGNsb3NlOiBqZXN0LmZuKCksXG4gIHNlbmQ6IGplc3QuZm4oKSxcbiAgcmVhZHlTdGF0ZTogMSxcbiAgb25vcGVuOiBudWxsLFxuICBvbm1lc3NhZ2U6IG51bGwsXG4gIG9uZXJyb3I6IG51bGwsXG4gIG9uY2xvc2U6IG51bGxcbn0pKTtcblxuZ2xvYmFsLmZldGNoID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAganNvbjogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgc3VjY2VzczogdHJ1ZSwgZGF0YToge30gfSlcbn0pO1xuXG5kZXNjcmliZSgnTmV1cmFsTWVzaFNlcnZpY2UgLSBDb21wcmVoZW5zaXZlIENvdmVyYWdlIFRlc3RzJywgKCkgPT4ge1xuICBsZXQgc2VydmljZTogTmV1cmFsTWVzaFNlcnZpY2U7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgc2VydmljZSA9IG5ldyBOZXVyYWxNZXNoU2VydmljZSh7XG4gICAgICBzZXJ2ZXJVcmw6ICd3czovL2xvY2FsaG9zdDozMDAwJyxcbiAgICAgIHRyYW5zcG9ydDogJ3dlYnNvY2tldCcsXG4gICAgICBlbmFibGVXYXNtOiB0cnVlLFxuICAgICAgZW5hYmxlUmVhbHRpbWU6IHRydWUsXG4gICAgICBkZWJ1Z01vZGU6IHRydWVcbiAgICB9KTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHtcbiAgICBpZiAoc2VydmljZSkge1xuICAgICAgYXdhaXQgc2VydmljZS5zaHV0ZG93bigpO1xuICAgIH1cbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0NvbmZpZ3VyYXRpb24gRWRnZSBDYXNlcycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIGVtcHR5IGNvbmZpZ3VyYXRpb24gb2JqZWN0JywgKCkgPT4ge1xuICAgICAgY29uc3QgZW1wdHlTZXJ2aWNlID0gbmV3IE5ldXJhbE1lc2hTZXJ2aWNlKHt9KTtcbiAgICAgIGV4cGVjdChlbXB0eVNlcnZpY2UpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoZW1wdHlTZXJ2aWNlLmdldENvbm5lY3Rpb25TdGF0dXMoKSkudG9CZU51bGwoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgdW5kZWZpbmVkIGNvbmZpZ3VyYXRpb24nLCAoKSA9PiB7XG4gICAgICBjb25zdCB1bmRlZmluZWRTZXJ2aWNlID0gbmV3IE5ldXJhbE1lc2hTZXJ2aWNlKCk7XG4gICAgICBleHBlY3QodW5kZWZpbmVkU2VydmljZSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh1bmRlZmluZWRTZXJ2aWNlLmlzV2FzbUVuYWJsZWQoKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIHBhcnRpYWwgY29uZmlndXJhdGlvbiB3aXRoIGFsbCB0cmFuc3BvcnRzJywgKCkgPT4ge1xuICAgICAgY29uc3QgaHR0cFNlcnZpY2UgPSBuZXcgTmV1cmFsTWVzaFNlcnZpY2UoeyB0cmFuc3BvcnQ6ICdodHRwJyB9KTtcbiAgICAgIGNvbnN0IHN0ZGlvU2VydmljZSA9IG5ldyBOZXVyYWxNZXNoU2VydmljZSh7IHRyYW5zcG9ydDogJ3N0ZGlvJyB9KTtcbiAgICAgIGNvbnN0IHdzU2VydmljZSA9IG5ldyBOZXVyYWxNZXNoU2VydmljZSh7IHRyYW5zcG9ydDogJ3dlYnNvY2tldCcgfSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChodHRwU2VydmljZSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChzdGRpb1NlcnZpY2UpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3Qod3NTZXJ2aWNlKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnVHJhbnNwb3J0IExheWVyIENvdmVyYWdlJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBpbml0aWFsaXplIEhUVFAgdHJhbnNwb3J0IHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGh0dHBTZXJ2aWNlID0gbmV3IE5ldXJhbE1lc2hTZXJ2aWNlKHtcbiAgICAgICAgc2VydmVyVXJsOiAnaHR0cDovL2xvY2FsaG9zdDozMDAwJyxcbiAgICAgICAgdHJhbnNwb3J0OiAnaHR0cCcsXG4gICAgICAgIGVuYWJsZVdhc206IGZhbHNlLFxuICAgICAgICBkZWJ1Z01vZGU6IHRydWVcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBjb25uZWN0ZWQgPSBhd2FpdCBodHRwU2VydmljZS5pbml0aWFsaXplKCk7XG4gICAgICBleHBlY3QoY29ubmVjdGVkKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGh0dHBTZXJ2aWNlLmdldENvbm5lY3Rpb25TdGF0dXMoKT8uc3RhdHVzKS50b0JlKCdjb25uZWN0ZWQnKTtcbiAgICAgIFxuICAgICAgYXdhaXQgaHR0cFNlcnZpY2Uuc2h1dGRvd24oKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBpbml0aWFsaXplIFNURElPIHRyYW5zcG9ydCBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzdGRpb1NlcnZpY2UgPSBuZXcgTmV1cmFsTWVzaFNlcnZpY2Uoe1xuICAgICAgICB0cmFuc3BvcnQ6ICdzdGRpbycsXG4gICAgICAgIGVuYWJsZVdhc206IHRydWUsXG4gICAgICAgIGRlYnVnTW9kZTogZmFsc2VcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBjb25uZWN0ZWQgPSBhd2FpdCBzdGRpb1NlcnZpY2UuaW5pdGlhbGl6ZSgpO1xuICAgICAgZXhwZWN0KGNvbm5lY3RlZCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChzdGRpb1NlcnZpY2UuaXNXYXNtRW5hYmxlZCgpKS50b0JlKHRydWUpO1xuICAgICAgXG4gICAgICBhd2FpdCBzdGRpb1NlcnZpY2Uuc2h1dGRvd24oKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgdW5zdXBwb3J0ZWQgdHJhbnNwb3J0IHR5cGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBiYWRTZXJ2aWNlID0gbmV3IE5ldXJhbE1lc2hTZXJ2aWNlKHtcbiAgICAgICAgdHJhbnNwb3J0OiAnaW52YWxpZCcgYXMgYW55LFxuICAgICAgICBkZWJ1Z01vZGU6IHRydWVcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBjb25uZWN0ZWQgPSBhd2FpdCBiYWRTZXJ2aWNlLmluaXRpYWxpemUoKTtcbiAgICAgIGV4cGVjdChjb25uZWN0ZWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KGJhZFNlcnZpY2UuZ2V0Q29ubmVjdGlvblN0YXR1cygpPy5zdGF0dXMpLnRvQmUoJ2Vycm9yJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdXZWJTb2NrZXQgQ29ubmVjdGlvbiBFZGdlIENhc2VzJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgV2ViU29ja2V0IGNvbm5lY3Rpb24gdGltZW91dCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBldmVudENhbGxiYWNrOiBhbnk7XG4gICAgICBjb25zdCBtb2NrV1MgPSB7XG4gICAgICAgIGFkZEV2ZW50TGlzdGVuZXI6IGplc3QuZm4oKGV2ZW50LCBjYWxsYmFjaykgPT4ge1xuICAgICAgICAgIGV2ZW50Q2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgICAgICAgICAvLyBEb24ndCB0cmlnZ2VyIGFueSBldmVudHMgdG8gc2ltdWxhdGUgdGltZW91dFxuICAgICAgICB9KSxcbiAgICAgICAgY2xvc2U6IGplc3QuZm4oKSxcbiAgICAgICAgc2VuZDogamVzdC5mbigpLFxuICAgICAgICByZWFkeVN0YXRlOiAwIC8vIENPTk5FQ1RJTkdcbiAgICAgIH07XG4gICAgICBcbiAgICAgIChnbG9iYWwuV2ViU29ja2V0IGFzIGplc3QuTW9jaykubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IG1vY2tXUyk7XG5cbiAgICAgIGNvbnN0IGNvbm5lY3RlZCA9IGF3YWl0IHNlcnZpY2UuaW5pdGlhbGl6ZSgpO1xuICAgICAgZXhwZWN0KGNvbm5lY3RlZCkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIFdlYlNvY2tldCB3aXRoIGltbWVkaWF0ZSBlcnJvcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tXUyA9IHtcbiAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcjogamVzdC5mbigoZXZlbnQsIGNhbGxiYWNrKSA9PiB7XG4gICAgICAgICAgaWYgKGV2ZW50ID09PSAnZXJyb3InKSB7XG4gICAgICAgICAgICAvLyBJbW1lZGlhdGUgZXJyb3JcbiAgICAgICAgICAgIGNhbGxiYWNrKHsgdHlwZTogJ2Vycm9yJywgbWVzc2FnZTogJ0Nvbm5lY3Rpb24gcmVmdXNlZCcgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KSxcbiAgICAgICAgY2xvc2U6IGplc3QuZm4oKSxcbiAgICAgICAgc2VuZDogamVzdC5mbigpLFxuICAgICAgICByZWFkeVN0YXRlOiAzIC8vIENMT1NFRFxuICAgICAgfTtcbiAgICAgIFxuICAgICAgKGdsb2JhbC5XZWJTb2NrZXQgYXMgamVzdC5Nb2NrKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gbW9ja1dTKTtcblxuICAgICAgY29uc3QgY29ubmVjdGVkID0gYXdhaXQgc2VydmljZS5pbml0aWFsaXplKCk7XG4gICAgICBleHBlY3QoY29ubmVjdGVkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChzZXJ2aWNlLmdldENvbm5lY3Rpb25TdGF0dXMoKT8uc3RhdHVzKS50b0JlKCdlcnJvcicpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBtZXNzYWdlIHByb2Nlc3NpbmcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrV1MgPSB7XG4gICAgICAgIGFkZEV2ZW50TGlzdGVuZXI6IGplc3QuZm4oKGV2ZW50LCBjYWxsYmFjaykgPT4ge1xuICAgICAgICAgIGlmIChldmVudCA9PT0gJ29wZW4nKSB7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IGNhbGxiYWNrKHsgdHlwZTogJ29wZW4nIH0pLCAxKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50ID09PSAnbWVzc2FnZScpIHtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICBjYWxsYmFjayh7IFxuICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHsgXG4gICAgICAgICAgICAgICAgICB0eXBlOiAndGVzdCcsXG4gICAgICAgICAgICAgICAgICBwYXlsb2FkOiB7IG1lc3NhZ2U6ICdIZWxsbyBmcm9tIG5ldXJhbCBtZXNoJyB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LCA1KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pLFxuICAgICAgICBjbG9zZTogamVzdC5mbigpLFxuICAgICAgICBzZW5kOiBqZXN0LmZuKCksXG4gICAgICAgIHJlYWR5U3RhdGU6IDFcbiAgICAgIH07XG4gICAgICBcbiAgICAgIChnbG9iYWwuV2ViU29ja2V0IGFzIGplc3QuTW9jaykubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IG1vY2tXUyk7XG5cbiAgICAgIGNvbnN0IGNvbm5lY3RlZCA9IGF3YWl0IHNlcnZpY2UuaW5pdGlhbGl6ZSgpO1xuICAgICAgZXhwZWN0KGNvbm5lY3RlZCkudG9CZSh0cnVlKTtcbiAgICAgIFxuICAgICAgLy8gVHJpZ2dlciBtZXNzYWdlIGV2ZW50XG4gICAgICBjb25zdCBtZXNzYWdlQ2FsbGJhY2sgPSBtb2NrV1MuYWRkRXZlbnRMaXN0ZW5lci5tb2NrLmNhbGxzLmZpbmQoY2FsbCA9PiBjYWxsWzBdID09PSAnbWVzc2FnZScpPy5bMV07XG4gICAgICBpZiAobWVzc2FnZUNhbGxiYWNrKSB7XG4gICAgICAgIG1lc3NhZ2VDYWxsYmFjayh7IFxuICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHsgdHlwZTogJ25ldXJhbF91cGRhdGUnLCBkYXRhOiB7IGFjdGl2aXR5OiAwLjc1IH0gfSlcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdXQVNNIEludGVncmF0aW9uIENvdmVyYWdlJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgV0FTTSBpbml0aWFsaXphdGlvbiBmYWlsdXJlIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB3YXNtU2VydmljZSA9IG5ldyBOZXVyYWxNZXNoU2VydmljZSh7XG4gICAgICAgIHRyYW5zcG9ydDogJ3N0ZGlvJyxcbiAgICAgICAgZW5hYmxlV2FzbTogdHJ1ZSxcbiAgICAgICAgZGVidWdNb2RlOiB0cnVlXG4gICAgICB9KTtcblxuICAgICAgLy8gTW9jayBXQVNNIGZhaWx1cmUgYnkgb3ZlcnJpZGluZyB0aGUgcHJpdmF0ZSBtZXRob2RcbiAgICAgIGNvbnN0IG9yaWdpbmFsSW5pdFdhc20gPSAod2FzbVNlcnZpY2UgYXMgYW55KS5pbml0aWFsaXplV2FzbTtcbiAgICAgICh3YXNtU2VydmljZSBhcyBhbnkpLmluaXRpYWxpemVXYXNtID0gamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignV0FTTSBmYWlsZWQnKSk7XG5cbiAgICAgIGNvbnN0IGNvbm5lY3RlZCA9IGF3YWl0IHdhc21TZXJ2aWNlLmluaXRpYWxpemUoKTtcbiAgICAgIGV4cGVjdChjb25uZWN0ZWQpLnRvQmUodHJ1ZSk7IC8vIFNob3VsZCBzdGlsbCBjb25uZWN0IHdpdGhvdXQgV0FTTVxuICAgICAgZXhwZWN0KHdhc21TZXJ2aWNlLmlzV2FzbUVuYWJsZWQoKSkudG9CZShmYWxzZSk7IC8vIEJ1dCBXQVNNIHNob3VsZCBiZSBkaXNhYmxlZFxuICAgICAgXG4gICAgICBhd2FpdCB3YXNtU2VydmljZS5zaHV0ZG93bigpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIHByb2Nlc3MgaW5mZXJlbmNlIHdpdGggV0FTTSBkaXNhYmxlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGpzU2VydmljZSA9IG5ldyBOZXVyYWxNZXNoU2VydmljZSh7XG4gICAgICAgIHRyYW5zcG9ydDogJ3N0ZGlvJyxcbiAgICAgICAgZW5hYmxlV2FzbTogZmFsc2UsXG4gICAgICAgIGRlYnVnTW9kZTogdHJ1ZVxuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IGpzU2VydmljZS5pbml0aWFsaXplKCk7XG5cbiAgICAgIGNvbnN0IGlucHV0ID0gbmV3IEZsb2F0MzJBcnJheShbMC4xLCAwLjIsIDAuMywgMC40LCAwLjVdKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGpzU2VydmljZS5wcm9jZXNzSW5mZXJlbmNlKGlucHV0KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5vdXRwdXQpLnRvQmVJbnN0YW5jZU9mKEZsb2F0MzJBcnJheSk7XG4gICAgICBleHBlY3QocmVzdWx0Lm91dHB1dC5sZW5ndGgpLnRvQmUoaW5wdXQubGVuZ3RoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubWV0cmljcy5zaW1kQWNjZWxlcmF0ZWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5tZXRyaWNzLmV4ZWN1dGlvblRpbWUpLnRvQmVHcmVhdGVyVGhhbigwKTtcblxuICAgICAgYXdhaXQganNTZXJ2aWNlLnNodXRkb3duKCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIGRpZmZlcmVudCBpbnB1dCBzaXplcyBmb3IgaW5mZXJlbmNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgd2FzbVNlcnZpY2UgPSBuZXcgTmV1cmFsTWVzaFNlcnZpY2Uoe1xuICAgICAgICB0cmFuc3BvcnQ6ICdzdGRpbycsXG4gICAgICAgIGVuYWJsZVdhc206IHRydWUsXG4gICAgICAgIGRlYnVnTW9kZTogZmFsc2VcbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCB3YXNtU2VydmljZS5pbml0aWFsaXplKCk7XG5cbiAgICAgIC8vIFRlc3QgdmFyaW91cyBpbnB1dCBzaXplc1xuICAgICAgY29uc3QgdGVzdFNpemVzID0gWzEsIDEwLCAxMDAsIDEwMDBdO1xuICAgICAgXG4gICAgICBmb3IgKGNvbnN0IHNpemUgb2YgdGVzdFNpemVzKSB7XG4gICAgICAgIGNvbnN0IGlucHV0ID0gbmV3IEZsb2F0MzJBcnJheShzaXplKS5maWxsKDAuNSk7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHdhc21TZXJ2aWNlLnByb2Nlc3NJbmZlcmVuY2UoaW5wdXQpO1xuICAgICAgICBcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5vdXRwdXQubGVuZ3RoKS50b0JlKHNpemUpO1xuICAgICAgICBleHBlY3QocmVzdWx0Lm1ldHJpY3MuaW5wdXRTaXplKS50b0JlKHNpemUpO1xuICAgICAgICBleHBlY3QocmVzdWx0Lm1ldHJpY3Mub3V0cHV0U2l6ZSkudG9CZShzaXplKTtcbiAgICAgIH1cblxuICAgICAgYXdhaXQgd2FzbVNlcnZpY2Uuc2h1dGRvd24oKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0FnZW50IExpZmVjeWNsZSBDb3ZlcmFnZScsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIGFnZW50IGNyZWF0aW9uIHdpdGggbWluaW1hbCBjb25maWcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzZXJ2aWNlID0gbmV3IE5ldXJhbE1lc2hTZXJ2aWNlKHsgdHJhbnNwb3J0OiAnc3RkaW8nIH0pO1xuICAgICAgYXdhaXQgc2VydmljZS5pbml0aWFsaXplKCk7XG5cbiAgICAgIGNvbnN0IGFnZW50ID0gYXdhaXQgc2VydmljZS5zcGF3bkFnZW50KHt9KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGFnZW50LmlkKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGFnZW50LnR5cGUpLnRvQmUoJ3dvcmtlcicpO1xuICAgICAgZXhwZWN0KGFnZW50Lm5ldXJhbFByb3BlcnRpZXMubm9kZVR5cGUpLnRvQmUoJ2ludGVyJyk7XG4gICAgICBleHBlY3QoYWdlbnQubmV1cmFsUHJvcGVydGllcy5sYXllcikudG9CZSgxKTtcbiAgICAgIGV4cGVjdChhZ2VudC5uZXVyYWxQcm9wZXJ0aWVzLnRocmVzaG9sZCkudG9CZSgwLjUpO1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLnNodXRkb3duKCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIGFnZW50IGNyZWF0aW9uIHdpdGggZnVsbCBjb25maWcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzZXJ2aWNlID0gbmV3IE5ldXJhbE1lc2hTZXJ2aWNlKHsgdHJhbnNwb3J0OiAnc3RkaW8nIH0pO1xuICAgICAgYXdhaXQgc2VydmljZS5pbml0aWFsaXplKCk7XG5cbiAgICAgIGNvbnN0IGZ1bGxDb25maWcgPSB7XG4gICAgICAgIGlkOiAndGVzdC1hZ2VudC1mdWxsJyxcbiAgICAgICAgdHlwZTogJ2Nvb3JkaW5hdG9yJyBhcyBjb25zdCxcbiAgICAgICAgY2FwYWJpbGl0aWVzOiBbJ3BsYW5uaW5nJywgJ2Nvb3JkaW5hdGlvbiddLFxuICAgICAgICBtZXRhZGF0YTogeyByb2xlOiAnbGVhZGVyJywgcHJpb3JpdHk6ICdoaWdoJyB9LFxuICAgICAgICBuZXVyYWxQcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgbmV1cm9uSWQ6ICduZXVyb24tMTIzJyxcbiAgICAgICAgICBtZXNoSWQ6ICdtZXNoLTQ1NicsIFxuICAgICAgICAgIG5vZGVUeXBlOiAncHlyYW1pZGFsJyBhcyBjb25zdCxcbiAgICAgICAgICBsYXllcjogMyxcbiAgICAgICAgICB0aHJlc2hvbGQ6IDAuOCxcbiAgICAgICAgICBhY3RpdmF0aW9uOiAwLjIsXG4gICAgICAgICAgY29ubmVjdGlvbnM6IFsnbmV1cm9uLTEnLCAnbmV1cm9uLTInXSxcbiAgICAgICAgICBzcGlrZUhpc3Rvcnk6IFswLjEsIDAuMywgMC43XSxcbiAgICAgICAgICBsYXN0U3Bpa2U6IG5ldyBEYXRlKClcbiAgICAgICAgfSxcbiAgICAgICAgd2FzbU1ldHJpY3M6IHtcbiAgICAgICAgICBleGVjdXRpb25UaW1lOiA1LjUsXG4gICAgICAgICAgbWVtb3J5VXNhZ2U6IDIuMSxcbiAgICAgICAgICBzaW1kQWNjZWxlcmF0aW9uOiB0cnVlLFxuICAgICAgICAgIHBlcmZvcm1hbmNlU2NvcmU6IDAuOTVcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgY29uc3QgYWdlbnQgPSBhd2FpdCBzZXJ2aWNlLnNwYXduQWdlbnQoZnVsbENvbmZpZyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChhZ2VudC5pZCkudG9CZSgndGVzdC1hZ2VudC1mdWxsJyk7XG4gICAgICBleHBlY3QoYWdlbnQudHlwZSkudG9CZSgnY29vcmRpbmF0b3InKTtcbiAgICAgIGV4cGVjdChhZ2VudC5uZXVyYWxQcm9wZXJ0aWVzLm5vZGVUeXBlKS50b0JlKCdweXJhbWlkYWwnKTtcbiAgICAgIGV4cGVjdChhZ2VudC5uZXVyYWxQcm9wZXJ0aWVzLmxheWVyKS50b0JlKDMpO1xuICAgICAgZXhwZWN0KGFnZW50Lm5ldXJhbFByb3BlcnRpZXMudGhyZXNob2xkKS50b0JlKDAuOCk7XG5cbiAgICAgIGF3YWl0IHNlcnZpY2Uuc2h1dGRvd24oKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCB1cGRhdGUgY29ubmVjdGlvbiBzdGF0cyB3aGVuIHNwYXduaW5nIGFnZW50cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNlcnZpY2UgPSBuZXcgTmV1cmFsTWVzaFNlcnZpY2UoeyB0cmFuc3BvcnQ6ICdzdGRpbycsIGRlYnVnTW9kZTogdHJ1ZSB9KTtcbiAgICAgIGF3YWl0IHNlcnZpY2UuaW5pdGlhbGl6ZSgpO1xuXG4gICAgICBjb25zdCBpbml0aWFsU3RhdHVzID0gc2VydmljZS5nZXRDb25uZWN0aW9uU3RhdHVzKCk7XG4gICAgICBleHBlY3QoaW5pdGlhbFN0YXR1cz8ubm9kZUNvdW50KS50b0JlKDApO1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLnNwYXduQWdlbnQoeyBpZDogJ2FnZW50LTEnIH0pO1xuICAgICAgYXdhaXQgc2VydmljZS5zcGF3bkFnZW50KHsgaWQ6ICdhZ2VudC0yJyB9KTtcblxuICAgICAgY29uc3QgdXBkYXRlZFN0YXR1cyA9IHNlcnZpY2UuZ2V0Q29ubmVjdGlvblN0YXR1cygpO1xuICAgICAgZXhwZWN0KHVwZGF0ZWRTdGF0dXM/Lm5vZGVDb3VudCkudG9CZSgyKTtcblxuICAgICAgYXdhaXQgc2VydmljZS5zaHV0ZG93bigpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRXJyb3IgSGFuZGxpbmcgQ292ZXJhZ2UnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIHRocm93IGVycm9yIHdoZW4gc3Bhd25pbmcgYWdlbnQgd2l0aG91dCBjb25uZWN0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGlzY29ubmVjdGVkU2VydmljZSA9IG5ldyBOZXVyYWxNZXNoU2VydmljZSgpO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QoZGlzY29ubmVjdGVkU2VydmljZS5zcGF3bkFnZW50KHsgaWQ6ICd0ZXN0JyB9KSlcbiAgICAgICAgLnJlamVjdHMudG9UaHJvdygnTmV1cmFsIG1lc2ggbm90IGNvbm5lY3RlZCcpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIHRocm93IGVycm9yIHdoZW4gcHJvY2Vzc2luZyBpbmZlcmVuY2Ugd2l0aG91dCBjb25uZWN0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGlzY29ubmVjdGVkU2VydmljZSA9IG5ldyBOZXVyYWxNZXNoU2VydmljZSgpO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QoZGlzY29ubmVjdGVkU2VydmljZS5wcm9jZXNzSW5mZXJlbmNlKG5ldyBGbG9hdDMyQXJyYXkoWzEsIDIsIDNdKSkpXG4gICAgICAgIC5yZWplY3RzLnRvVGhyb3coJ05ldXJhbCBtZXNoIG5vdCBjb25uZWN0ZWQnKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgaW5pdGlhbGl6YXRpb24gZXJyb3Igd2l0aCBXQVNNIGVuYWJsZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzZXJ2aWNlID0gbmV3IE5ldXJhbE1lc2hTZXJ2aWNlKHtcbiAgICAgICAgdHJhbnNwb3J0OiAnaW52YWxpZCcgYXMgYW55LFxuICAgICAgICBlbmFibGVXYXNtOiB0cnVlLFxuICAgICAgICBkZWJ1Z01vZGU6IHRydWVcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBjb25uZWN0ZWQgPSBhd2FpdCBzZXJ2aWNlLmluaXRpYWxpemUoKTtcbiAgICAgIGV4cGVjdChjb25uZWN0ZWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHNlcnZpY2UuZ2V0Q29ubmVjdGlvblN0YXR1cygpPy5zdGF0dXMpLnRvQmUoJ2Vycm9yJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTaHV0ZG93biBhbmQgQ2xlYW51cCBDb3ZlcmFnZScsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgY2xlYW51cCBhbGwgcmVzb3VyY2VzIG9uIHNodXRkb3duJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc2VydmljZSA9IG5ldyBOZXVyYWxNZXNoU2VydmljZSh7XG4gICAgICAgIHRyYW5zcG9ydDogJ3N0ZGlvJyxcbiAgICAgICAgZW5hYmxlV2FzbTogdHJ1ZSxcbiAgICAgICAgZW5hYmxlUmVhbHRpbWU6IHRydWUsXG4gICAgICAgIGRlYnVnTW9kZTogdHJ1ZVxuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IHNlcnZpY2UuaW5pdGlhbGl6ZSgpO1xuICAgICAgZXhwZWN0KHNlcnZpY2UuZ2V0Q29ubmVjdGlvblN0YXR1cygpKS5ub3QudG9CZU51bGwoKTtcbiAgICAgIGV4cGVjdChzZXJ2aWNlLmlzV2FzbUVuYWJsZWQoKSkudG9CZSh0cnVlKTtcblxuICAgICAgYXdhaXQgc2VydmljZS5zaHV0ZG93bigpO1xuICAgICAgZXhwZWN0KHNlcnZpY2UuZ2V0Q29ubmVjdGlvblN0YXR1cygpKS50b0JlTnVsbCgpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBzaHV0ZG93biB3aGVuIG5vdCBpbml0aWFsaXplZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNlcnZpY2UgPSBuZXcgTmV1cmFsTWVzaFNlcnZpY2UoKTtcbiAgICAgIFxuICAgICAgLy8gU2hvdWxkIG5vdCB0aHJvdyBlcnJvclxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2Uuc2h1dGRvd24oKSkucmVzb2x2ZXMubm90LnRvVGhyb3coKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgbXVsdGlwbGUgc2h1dGRvd24gY2FsbHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzZXJ2aWNlID0gbmV3IE5ldXJhbE1lc2hTZXJ2aWNlKHsgdHJhbnNwb3J0OiAnc3RkaW8nIH0pO1xuICAgICAgYXdhaXQgc2VydmljZS5pbml0aWFsaXplKCk7XG5cbiAgICAgIGF3YWl0IHNlcnZpY2Uuc2h1dGRvd24oKTtcbiAgICAgIGF3YWl0IHNlcnZpY2Uuc2h1dGRvd24oKTsgLy8gU2Vjb25kIGNhbGwgc2hvdWxkIGJlIHNhZmVcbiAgICAgIGF3YWl0IHNlcnZpY2Uuc2h1dGRvd24oKTsgLy8gVGhpcmQgY2FsbCBzaG91bGQgYmUgc2FmZVxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUGVyZm9ybWFuY2UgRWRnZSBDYXNlcycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIHZlcnkgbGFyZ2UgaW5mZXJlbmNlIGJhdGNoZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzZXJ2aWNlID0gbmV3IE5ldXJhbE1lc2hTZXJ2aWNlKHtcbiAgICAgICAgdHJhbnNwb3J0OiAnc3RkaW8nLFxuICAgICAgICBlbmFibGVXYXNtOiB0cnVlLFxuICAgICAgICBkZWJ1Z01vZGU6IGZhbHNlXG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgc2VydmljZS5pbml0aWFsaXplKCk7XG5cbiAgICAgIGNvbnN0IGxhcmdlSW5wdXQgPSBuZXcgRmxvYXQzMkFycmF5KDEwMDAwKS5maWxsKDAuNSk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnByb2Nlc3NJbmZlcmVuY2UobGFyZ2VJbnB1dCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQub3V0cHV0Lmxlbmd0aCkudG9CZSgxMDAwMCk7XG4gICAgICBleHBlY3QocmVzdWx0Lm1ldHJpY3MuZXhlY3V0aW9uVGltZSkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5tZXRyaWNzLm1lbW9yeVVzYWdlKS50b0JlR3JlYXRlclRoYW4oMCk7XG5cbiAgICAgIGF3YWl0IHNlcnZpY2Uuc2h1dGRvd24oKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgcmFwaWQgYWdlbnQgc3Bhd25pbmcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzZXJ2aWNlID0gbmV3IE5ldXJhbE1lc2hTZXJ2aWNlKHtcbiAgICAgICAgdHJhbnNwb3J0OiAnc3RkaW8nLFxuICAgICAgICBkZWJ1Z01vZGU6IGZhbHNlXG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgc2VydmljZS5pbml0aWFsaXplKCk7XG5cbiAgICAgIGNvbnN0IGFnZW50cyA9IFtdO1xuICAgICAgY29uc3Qgc3Bhd25Qcm9taXNlcyA9IFtdO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDUwOyBpKyspIHtcbiAgICAgICAgc3Bhd25Qcm9taXNlcy5wdXNoKHNlcnZpY2Uuc3Bhd25BZ2VudCh7IGlkOiBgcmFwaWQtYWdlbnQtJHtpfWAgfSkpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBzcGF3bmVkQWdlbnRzID0gYXdhaXQgUHJvbWlzZS5hbGwoc3Bhd25Qcm9taXNlcyk7XG4gICAgICBleHBlY3Qoc3Bhd25lZEFnZW50cykudG9IYXZlTGVuZ3RoKDUwKTtcbiAgICAgIGV4cGVjdChzZXJ2aWNlLmdldENvbm5lY3Rpb25TdGF0dXMoKT8ubm9kZUNvdW50KS50b0JlKDUwKTtcblxuICAgICAgYXdhaXQgc2VydmljZS5zaHV0ZG93bigpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRGVidWcgTW9kZSBDb3ZlcmFnZScsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgbG9nIGRlYnVnIG1lc3NhZ2VzIHdoZW4gZGVidWcgbW9kZSBlbmFibGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY29uc29sZVNweSA9IGplc3Quc3B5T24oY29uc29sZSwgJ2xvZycpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xuICAgICAgXG4gICAgICBjb25zdCBkZWJ1Z1NlcnZpY2UgPSBuZXcgTmV1cmFsTWVzaFNlcnZpY2Uoe1xuICAgICAgICB0cmFuc3BvcnQ6ICdzdGRpbycsXG4gICAgICAgIGVuYWJsZVdhc206IHRydWUsXG4gICAgICAgIGRlYnVnTW9kZTogdHJ1ZVxuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IGRlYnVnU2VydmljZS5pbml0aWFsaXplKCk7XG4gICAgICBhd2FpdCBkZWJ1Z1NlcnZpY2Uuc3Bhd25BZ2VudCh7IGlkOiAnZGVidWctYWdlbnQnIH0pO1xuICAgICAgYXdhaXQgZGVidWdTZXJ2aWNlLnByb2Nlc3NJbmZlcmVuY2UobmV3IEZsb2F0MzJBcnJheShbMC41XSkpO1xuICAgICAgYXdhaXQgZGVidWdTZXJ2aWNlLnNodXRkb3duKCk7XG5cbiAgICAgIGV4cGVjdChjb25zb2xlU3B5KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBjb25zb2xlU3B5Lm1vY2tSZXN0b3JlKCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgbm90IGxvZyBkZWJ1ZyBtZXNzYWdlcyB3aGVuIGRlYnVnIG1vZGUgZGlzYWJsZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjb25zb2xlU3B5ID0gamVzdC5zcHlPbihjb25zb2xlLCAnbG9nJykubW9ja0ltcGxlbWVudGF0aW9uKCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHNpbGVudFNlcnZpY2UgPSBuZXcgTmV1cmFsTWVzaFNlcnZpY2Uoe1xuICAgICAgICB0cmFuc3BvcnQ6ICdzdGRpbycsXG4gICAgICAgIGVuYWJsZVdhc206IGZhbHNlLFxuICAgICAgICBkZWJ1Z01vZGU6IGZhbHNlXG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgc2lsZW50U2VydmljZS5pbml0aWFsaXplKCk7XG4gICAgICBhd2FpdCBzaWxlbnRTZXJ2aWNlLnNodXRkb3duKCk7XG5cbiAgICAgIC8vIFNob3VsZCBoYXZlIG1pbmltYWwgb3Igbm8gY29uc29sZSBvdXRwdXRcbiAgICAgIGNvbnN0IGRlYnVnQ2FsbHMgPSBjb25zb2xlU3B5Lm1vY2suY2FsbHMuZmlsdGVyKGNhbGwgPT4gXG4gICAgICAgIGNhbGwuc29tZShhcmcgPT4gdHlwZW9mIGFyZyA9PT0gJ3N0cmluZycgJiYgYXJnLmluY2x1ZGVzKCfwn6egJykpXG4gICAgICApO1xuICAgICAgZXhwZWN0KGRlYnVnQ2FsbHMubGVuZ3RoKS50b0JlKDApO1xuICAgICAgXG4gICAgICBjb25zb2xlU3B5Lm1vY2tSZXN0b3JlKCk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9