96a25dcd0cd0000bd4a89c4636287c35
"use strict";
/**
 * TDD Unit Tests for Agent Persistence Manager
 * Tests SQLite database operations with Phase 2A performance requirements
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
const perf_hooks_1 = require("perf_hooks");
const path = __importStar(require("path"));
const fs = __importStar(require("fs"));
const AgentPersistenceManager_1 = require("../../../src/persistence/AgentPersistenceManager");
describe('AgentPersistenceManager - TDD Implementation', () => {
    let persistenceManager;
    let testDbPath;
    beforeEach(async () => {
        // Create unique test database for each test
        testDbPath = path.join(__dirname, `test-${Date.now()}-${Math.random().toString(36).substr(2, 9)}.db`);
        persistenceManager = new AgentPersistenceManager_1.AgentPersistenceManager(testDbPath);
        await persistenceManager.initialize();
    });
    afterEach(async () => {
        // Clean up test database
        if (persistenceManager) {
            await persistenceManager.close();
        }
        if (fs.existsSync(testDbPath)) {
            fs.unlinkSync(testDbPath);
        }
    });
    describe('Database Initialization - TDD Red Phase', () => {
        test('should create all required tables with proper schema', async () => {
            // TDD: Testing database schema creation
            const tables = await persistenceManager.getTables();
            expect(tables).toContain('agents');
            expect(tables).toContain('neural_weights');
            expect(tables).toContain('agent_memory');
            expect(tables).toContain('agent_metrics');
            expect(tables).toContain('session_state');
        });
        test('should create all required indexes for performance', async () => {
            // TDD: Testing index creation for Phase 2A performance requirements
            const indexes = await persistenceManager.getIndexes();
            expect(indexes).toContain('idx_agents_status');
            expect(indexes).toContain('idx_agents_type');
            expect(indexes).toContain('idx_neural_weights_agent');
            expect(indexes).toContain('idx_agent_memory_type');
            expect(indexes).toContain('idx_metrics_agent_type');
        });
        test('should enable WAL mode for concurrent access', async () => {
            // TDD: Testing WAL mode configuration
            const journalMode = await persistenceManager.getJournalMode();
            expect(journalMode).toBe('wal');
        });
    });
    describe('Agent CRUD Operations - TDD Red Phase', () => {
        test('should save agent with all required fields within 50ms', async () => {
            // TDD Red: This test should fail initially
            const agentConfig = {
                id: 'test-agent-001',
                type: 'researcher',
                cognitivePattern: 'divergent',
                networkLayers: [64, 128, 64, 32],
                learningRate: 0.7,
                momentum: 0.3,
                status: 'spawning',
                createdAt: Date.now(),
                lastActive: Date.now(),
                memoryUsageMB: 0,
                performanceScore: 0,
                spawnTimeMs: null,
                configJson: JSON.stringify({
                    temperature: 0.8,
                    maxTokens: 2048
                }),
                metadataJson: JSON.stringify({
                    priority: 'high',
                    tags: ['research', 'analysis']
                })
            };
            const startTime = perf_hooks_1.performance.now();
            const savedAgent = await persistenceManager.saveAgent(agentConfig);
            const saveTime = perf_hooks_1.performance.now() - startTime;
            // Phase 2A requirement: database operations <50ms
            expect(saveTime).toBeLessThan(50);
            // Validate saved data
            expect(savedAgent.id).toBe(agentConfig.id);
            expect(savedAgent.type).toBe(agentConfig.type);
            expect(savedAgent.status).toBe('spawning');
            expect(savedAgent.createdAt).toBeGreaterThan(0);
        });
        test('should retrieve agent by ID within 50ms', async () => {
            // TDD Red: This test should fail initially
            const agentConfig = {
                id: 'test-agent-002',
                type: 'coder',
                cognitivePattern: 'convergent',
                networkLayers: [128, 256, 128, 64],
                learningRate: 0.5,
                momentum: 0.2,
                status: 'active',
                createdAt: Date.now(),
                lastActive: Date.now()
            };
            await persistenceManager.saveAgent(agentConfig);
            const startTime = perf_hooks_1.performance.now();
            const retrievedAgent = await persistenceManager.getAgent(agentConfig.id);
            const retrieveTime = perf_hooks_1.performance.now() - startTime;
            // Phase 2A requirement: database operations <50ms
            expect(retrieveTime).toBeLessThan(50);
            // Validate retrieved data
            expect(retrievedAgent).toBeDefined();
            expect(retrievedAgent.id).toBe(agentConfig.id);
            expect(retrievedAgent.type).toBe(agentConfig.type);
            expect(retrievedAgent.cognitivePattern).toBe(agentConfig.cognitivePattern);
        });
        test('should update agent status atomically within 50ms', async () => {
            // TDD Red: This test should fail initially
            const agentId = 'test-agent-003';
            await persistenceManager.saveAgent({
                id: agentId,
                type: 'analyst',
                cognitivePattern: 'critical',
                networkLayers: [96, 192, 96, 48],
                status: 'spawning',
                createdAt: Date.now(),
                lastActive: Date.now()
            });
            const startTime = perf_hooks_1.performance.now();
            await persistenceManager.updateAgentStatus(agentId, 'active');
            const updateTime = perf_hooks_1.performance.now() - startTime;
            // Phase 2A requirement: database operations <50ms
            expect(updateTime).toBeLessThan(50);
            // Validate status change
            const updatedAgent = await persistenceManager.getAgent(agentId);
            expect(updatedAgent.status).toBe('active');
        });
        test('should handle concurrent agent saves without corruption', async () => {
            // TDD Red: This test should fail initially
            const concurrentSaves = Array.from({ length: 10 }, (_, i) => persistenceManager.saveAgent({
                id: `concurrent-agent-${i}`,
                type: 'optimizer',
                cognitivePattern: 'systems',
                networkLayers: [80, 160, 80, 40],
                status: 'spawning',
                createdAt: Date.now(),
                lastActive: Date.now()
            }));
            const startTime = perf_hooks_1.performance.now();
            const results = await Promise.all(concurrentSaves);
            const totalTime = perf_hooks_1.performance.now() - startTime;
            // All saves should succeed
            expect(results).toHaveLength(10);
            results.forEach(result => {
                expect(result).toBeDefined();
                expect(result.id).toMatch(/concurrent-agent-\d/);
            });
            // Average save time should be reasonable
            const avgSaveTime = totalTime / 10;
            expect(avgSaveTime).toBeLessThan(75); // Slightly higher threshold for concurrent operations
        });
        test('should prevent duplicate agent IDs', async () => {
            // TDD Red: This test should fail initially
            const agentConfig = {
                id: 'duplicate-test',
                type: 'coordinator',
                cognitivePattern: 'adaptive',
                networkLayers: [112, 224, 112, 56],
                status: 'spawning',
                createdAt: Date.now(),
                lastActive: Date.now()
            };
            // First save should succeed
            await persistenceManager.saveAgent(agentConfig);
            // Second save should fail
            await expect(persistenceManager.saveAgent(agentConfig))
                .rejects.toThrow(/UNIQUE constraint failed/);
        });
        test('should validate required fields', async () => {
            // TDD Red: This test should fail initially
            // Missing required fields should fail
            await expect(persistenceManager.saveAgent({}))
                .rejects.toThrow(/NOT NULL constraint failed/);
            await expect(persistenceManager.saveAgent({
                id: 'test',
                type: 'researcher'
            }))
                .rejects.toThrow(/NOT NULL constraint failed/);
        });
    });
    describe('Performance Metrics Tracking - TDD Red Phase', () => {
        test('should record agent spawn metrics', async () => {
            // TDD Red: This test should fail initially
            const agentId = 'metrics-test-agent';
            const spawnTime = 65; // ms
            await persistenceManager.saveAgent({
                id: agentId,
                type: 'researcher',
                cognitivePattern: 'divergent',
                networkLayers: [64, 128, 64],
                status: 'active',
                createdAt: Date.now(),
                lastActive: Date.now(),
                spawnTimeMs: spawnTime
            });
            await persistenceManager.recordMetric({
                agentId,
                metricType: 'spawn_time',
                value: spawnTime,
                unit: 'ms',
                recordedAt: Date.now(),
                context: { target: 75, status: 'pass' }
            });
            const metrics = await persistenceManager.getAgentMetrics(agentId, 'spawn_time');
            expect(metrics).toHaveLength(1);
            expect(metrics[0].value).toBe(spawnTime);
            expect(metrics[0].unit).toBe('ms');
        });
        test('should track memory usage metrics', async () => {
            // TDD Red: This test should fail initially
            const agentId = 'memory-test-agent';
            const memoryUsage = 35.5; // MB
            await persistenceManager.saveAgent({
                id: agentId,
                type: 'coder',
                cognitivePattern: 'convergent',
                networkLayers: [128, 256, 128],
                status: 'active',
                createdAt: Date.now(),
                lastActive: Date.now(),
                memoryUsageMB: memoryUsage
            });
            await persistenceManager.recordMetric({
                agentId,
                metricType: 'memory_usage',
                value: memoryUsage,
                unit: 'mb',
                recordedAt: Date.now(),
                context: { target: 50, status: 'pass' }
            });
            const metrics = await persistenceManager.getAgentMetrics(agentId, 'memory_usage');
            expect(metrics[0].value).toBe(memoryUsage);
            expect(metrics[0].unit).toBe('mb');
        });
    });
    describe('Batch Operations - TDD Red Phase', () => {
        test('should handle batch agent saves efficiently', async () => {
            // TDD Red: This test should fail initially
            const agents = Array.from({ length: 50 }, (_, i) => ({
                id: `batch-agent-${i}`,
                type: ['researcher', 'coder', 'analyst', 'optimizer', 'coordinator'][i % 5],
                cognitivePattern: ['convergent', 'divergent', 'critical', 'systems', 'adaptive'][i % 5],
                networkLayers: [64, 128, 64, 32],
                status: 'spawning',
                createdAt: Date.now(),
                lastActive: Date.now()
            }));
            const startTime = perf_hooks_1.performance.now();
            await persistenceManager.batchSaveAgents(agents);
            const batchTime = perf_hooks_1.performance.now() - startTime;
            // Batch operation should be more efficient than individual saves
            expect(batchTime).toBeLessThan(200); // 200ms for 50 agents = 4ms per agent
            // Verify all agents were saved
            const savedAgents = await persistenceManager.getAllAgents();
            expect(savedAgents).toHaveLength(50);
        });
    });
    describe('Data Integrity and Consistency - TDD Red Phase', () => {
        test('should maintain ACID properties during concurrent operations', async () => {
            // TDD Red: This test should fail initially
            const concurrentOperations = [];
            // Simulate concurrent read/write operations
            for (let i = 0; i < 20; i++) {
                concurrentOperations.push(persistenceManager.saveAgent({
                    id: `acid-test-${i}`,
                    type: 'researcher',
                    cognitivePattern: 'divergent',
                    networkLayers: [64, 128, 64],
                    status: 'spawning',
                    createdAt: Date.now(),
                    lastActive: Date.now()
                }));
                if (i > 5) {
                    // Add some read operations
                    concurrentOperations.push(persistenceManager.getAgent(`acid-test-${i - 5}`));
                }
            }
            const startTime = perf_hooks_1.performance.now();
            const results = await Promise.allSettled(concurrentOperations);
            const totalTime = perf_hooks_1.performance.now() - startTime;
            // All operations should complete successfully
            const failures = results.filter(r => r.status === 'rejected');
            expect(failures).toHaveLength(0);
            // Performance should still be reasonable
            expect(totalTime).toBeLessThan(500); // 500ms for mixed operations
        });
    });
    describe('Error Handling and Recovery - TDD Red Phase', () => {
        test('should handle database corruption gracefully', async () => {
            // TDD Red: This test should fail initially
            // Save some data first
            await persistenceManager.saveAgent({
                id: 'corruption-test',
                type: 'researcher',
                cognitivePattern: 'divergent',
                networkLayers: [64, 128, 64],
                status: 'active',
                createdAt: Date.now(),
                lastActive: Date.now()
            });
            // Close the database
            await persistenceManager.close();
            // Corrupt the database file (simulate corruption)
            fs.writeFileSync(testDbPath, 'corrupted data');
            // Try to initialize again - should handle corruption
            const corruptedManager = new AgentPersistenceManager_1.AgentPersistenceManager(testDbPath);
            await expect(corruptedManager.initialize()).rejects.toThrow();
        });
        test('should implement connection pooling for high concurrency', async () => {
            // TDD Red: This test should fail initially
            // Test connection pooling under high load
            const highConcurrencyOps = Array.from({ length: 100 }, (_, i) => persistenceManager.saveAgent({
                id: `pool-test-${i}`,
                type: 'researcher',
                cognitivePattern: 'divergent',
                networkLayers: [64, 128, 64],
                status: 'spawning',
                createdAt: Date.now(),
                lastActive: Date.now()
            }));
            const startTime = perf_hooks_1.performance.now();
            await Promise.all(highConcurrencyOps);
            const totalTime = perf_hooks_1.performance.now() - startTime;
            // Should handle high concurrency efficiently
            expect(totalTime).toBeLessThan(1000); // 1 second for 100 operations
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL3dvcmtzcGFjZXMvYWdlbnRpc3RzLXF1aWNrc3RhcnQtd29ya3NwYWNlLWJhc2ljL3Nhc2kvdGVzdHMvdW5pdC9wZXJzaXN0ZW5jZS9hZ2VudC1wZXJzaXN0ZW5jZS1tYW5hZ2VyLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFSCwyQ0FBeUM7QUFDekMsMkNBQTZCO0FBQzdCLHVDQUF5QjtBQUN6Qiw4RkFBMkY7QUFHM0YsUUFBUSxDQUFDLDhDQUE4QyxFQUFFLEdBQUcsRUFBRTtJQUM1RCxJQUFJLGtCQUEyQyxDQUFDO0lBQ2hELElBQUksVUFBa0IsQ0FBQztJQUV2QixVQUFVLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDcEIsNENBQTRDO1FBQzVDLFVBQVUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxRQUFRLElBQUksQ0FBQyxHQUFHLEVBQUUsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3RHLGtCQUFrQixHQUFHLElBQUksaURBQXVCLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDN0QsTUFBTSxrQkFBa0IsQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUN4QyxDQUFDLENBQUMsQ0FBQztJQUVILFNBQVMsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNuQix5QkFBeUI7UUFDekIsSUFBSSxrQkFBa0IsRUFBRSxDQUFDO1lBQ3ZCLE1BQU0sa0JBQWtCLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDbkMsQ0FBQztRQUNELElBQUksRUFBRSxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDO1lBQzlCLEVBQUUsQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDNUIsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLHlDQUF5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QUFJLEVBQUUsWUFBWTtnQkFDbEIsZ0JBQWdCLEVBQUUsV0FBVztnQkFDN0IsYUFBYSxFQUFFLENBQUMsRUFBRSxFQUFFLEdBQUcsRUFBRSxFQUFFLENBQUM7Z0JBQzVCLE1BQU0sRUFBRSxVQUF3QjtnQkFDaEMsU0FBUyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUU7Z0JBQ3JCLFVBQVUsRUFBRSxJQUFJLENBQUMsR0FBRyxFQUFFO2FBQ3ZCLENBQUMsQ0FDSCxDQUFDO1lBRUYsTUFBTSxTQUFTLEdBQUcsd0JBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUNwQyxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLENBQUMsQ0FBQztZQUN0QyxNQUFNLFNBQVMsR0FBRyx3QkFBVyxDQUFDLEdBQUcsRUFBRSxHQUFHLFNBQVMsQ0FBQztZQUVoRCw2Q0FBNkM7WUFDN0MsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLDhCQUE4QjtRQUN0RSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL3dvcmtzcGFjZXMvYWdlbnRpc3RzLXF1aWNrc3RhcnQtd29ya3NwYWNlLWJhc2ljL3Nhc2kvdGVzdHMvdW5pdC9wZXJzaXN0ZW5jZS9hZ2VudC1wZXJzaXN0ZW5jZS1tYW5hZ2VyLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUREQgVW5pdCBUZXN0cyBmb3IgQWdlbnQgUGVyc2lzdGVuY2UgTWFuYWdlclxuICogVGVzdHMgU1FMaXRlIGRhdGFiYXNlIG9wZXJhdGlvbnMgd2l0aCBQaGFzZSAyQSBwZXJmb3JtYW5jZSByZXF1aXJlbWVudHNcbiAqL1xuXG5pbXBvcnQgeyBwZXJmb3JtYW5jZSB9IGZyb20gJ3BlcmZfaG9va3MnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcbmltcG9ydCB7IEFnZW50UGVyc2lzdGVuY2VNYW5hZ2VyIH0gZnJvbSAnLi4vLi4vLi4vc3JjL3BlcnNpc3RlbmNlL0FnZW50UGVyc2lzdGVuY2VNYW5hZ2VyJztcbmltcG9ydCB0eXBlIHsgQWdlbnRDb25maWcsIEFnZW50U3RhdGUgfSBmcm9tICcuLi8uLi8uLi9zcmMvdHlwZXMvYWdlbnQnO1xuXG5kZXNjcmliZSgnQWdlbnRQZXJzaXN0ZW5jZU1hbmFnZXIgLSBUREQgSW1wbGVtZW50YXRpb24nLCAoKSA9PiB7XG4gIGxldCBwZXJzaXN0ZW5jZU1hbmFnZXI6IEFnZW50UGVyc2lzdGVuY2VNYW5hZ2VyO1xuICBsZXQgdGVzdERiUGF0aDogc3RyaW5nO1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIC8vIENyZWF0ZSB1bmlxdWUgdGVzdCBkYXRhYmFzZSBmb3IgZWFjaCB0ZXN0XG4gICAgdGVzdERiUGF0aCA9IHBhdGguam9pbihfX2Rpcm5hbWUsIGB0ZXN0LSR7RGF0ZS5ub3coKX0tJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9LmRiYCk7XG4gICAgcGVyc2lzdGVuY2VNYW5hZ2VyID0gbmV3IEFnZW50UGVyc2lzdGVuY2VNYW5hZ2VyKHRlc3REYlBhdGgpO1xuICAgIGF3YWl0IHBlcnNpc3RlbmNlTWFuYWdlci5pbml0aWFsaXplKCk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaChhc3luYyAoKSA9PiB7XG4gICAgLy8gQ2xlYW4gdXAgdGVzdCBkYXRhYmFzZVxuICAgIGlmIChwZXJzaXN0ZW5jZU1hbmFnZXIpIHtcbiAgICAgIGF3YWl0IHBlcnNpc3RlbmNlTWFuYWdlci5jbG9zZSgpO1xuICAgIH1cbiAgICBpZiAoZnMuZXhpc3RzU3luYyh0ZXN0RGJQYXRoKSkge1xuICAgICAgZnMudW5saW5rU3luYyh0ZXN0RGJQYXRoKTtcbiAgICB9XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdEYXRhYmFzZSBJbml0aWFsaXphdGlvbiAtIFRERCBSZWQgUGhhc2UnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGNyZWF0ZSBhbGwgcmVxdWlyZWQgdGFibGVzIHdpdGggcHJvcGVyIHNjaGVtYScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFRERDogVGVzdGluZyBkYXRhYmFzZSBzY2hlbWEgY3JlYXRpb25cbiAgICAgIGNvbnN0IHRhYmxlcyA9IGF3YWl0IHBlcnNpc3RlbmNlTWFuYWdlci5nZXRUYWJsZXMoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHRhYmxlcykudG9Db250YWluKCdhZ2VudHMnKTtcbiAgICAgIGV4cGVjdCh0YWJsZXMpLnRvQ29udGFpbignbmV1cmFsX3dlaWdodHMnKTtcbiAgICAgIGV4cGVjdCh0YWJsZXMpLnRvQ29udGFpbignYWdlbnRfbWVtb3J5Jyk7XG4gICAgICBleHBlY3QodGFibGVzKS50b0NvbnRhaW4oJ2FnZW50X21ldHJpY3MnKTtcbiAgICAgIGV4cGVjdCh0YWJsZXMpLnRvQ29udGFpbignc2Vzc2lvbl9zdGF0ZScpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGNyZWF0ZSBhbGwgcmVxdWlyZWQgaW5kZXhlcyBmb3IgcGVyZm9ybWFuY2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUREQ6IFRlc3RpbmcgaW5kZXggY3JlYXRpb24gZm9yIFBoYXNlIDJBIHBlcmZvcm1hbmNlIHJlcXVpcmVtZW50c1xuICAgICAgY29uc3QgaW5kZXhlcyA9IGF3YWl0IHBlcnNpc3RlbmNlTWFuYWdlci5nZXRJbmRleGVzKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChpbmRleGVzKS50b0NvbnRhaW4oJ2lkeF9hZ2VudHNfc3RhdHVzJyk7XG4gICAgICBleHBlY3QoaW5kZXhlcykudG9Db250YWluKCdpZHhfYWdlbnRzX3R5cGUnKTtcbiAgICAgIGV4cGVjdChpbmRleGVzKS50b0NvbnRhaW4oJ2lkeF9uZXVyYWxfd2VpZ2h0c19hZ2VudCcpO1xuICAgICAgZXhwZWN0KGluZGV4ZXMpLnRvQ29udGFpbignaWR4X2FnZW50X21lbW9yeV90eXBlJyk7XG4gICAgICBleHBlY3QoaW5kZXhlcykudG9Db250YWluKCdpZHhfbWV0cmljc19hZ2VudF90eXBlJyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgZW5hYmxlIFdBTCBtb2RlIGZvciBjb25jdXJyZW50IGFjY2VzcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFRERDogVGVzdGluZyBXQUwgbW9kZSBjb25maWd1cmF0aW9uXG4gICAgICBjb25zdCBqb3VybmFsTW9kZSA9IGF3YWl0IHBlcnNpc3RlbmNlTWFuYWdlci5nZXRKb3VybmFsTW9kZSgpO1xuICAgICAgZXhwZWN0KGpvdXJuYWxNb2RlKS50b0JlKCd3YWwnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0FnZW50IENSVUQgT3BlcmF0aW9ucyAtIFRERCBSZWQgUGhhc2UnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIHNhdmUgYWdlbnQgd2l0aCBhbGwgcmVxdWlyZWQgZmllbGRzIHdpdGhpbiA1MG1zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gVEREIFJlZDogVGhpcyB0ZXN0IHNob3VsZCBmYWlsIGluaXRpYWxseVxuICAgICAgY29uc3QgYWdlbnRDb25maWc6IEFnZW50Q29uZmlnID0ge1xuICAgICAgICBpZDogJ3Rlc3QtYWdlbnQtMDAxJyxcbiAgICAgICAgdHlwZTogJ3Jlc2VhcmNoZXInLFxuICAgICAgICBjb2duaXRpdmVQYXR0ZXJuOiAnZGl2ZXJnZW50JyxcbiAgICAgICAgbmV0d29ya0xheWVyczogWzY0LCAxMjgsIDY0LCAzMl0sXG4gICAgICAgIGxlYXJuaW5nUmF0ZTogMC43LFxuICAgICAgICBtb21lbnR1bTogMC4zLFxuICAgICAgICBzdGF0dXM6ICdzcGF3bmluZycgYXMgQWdlbnRTdGF0ZSxcbiAgICAgICAgY3JlYXRlZEF0OiBEYXRlLm5vdygpLFxuICAgICAgICBsYXN0QWN0aXZlOiBEYXRlLm5vdygpLFxuICAgICAgICBtZW1vcnlVc2FnZU1COiAwLFxuICAgICAgICBwZXJmb3JtYW5jZVNjb3JlOiAwLFxuICAgICAgICBzcGF3blRpbWVNczogbnVsbCxcbiAgICAgICAgY29uZmlnSnNvbjogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIHRlbXBlcmF0dXJlOiAwLjgsXG4gICAgICAgICAgbWF4VG9rZW5zOiAyMDQ4XG4gICAgICAgIH0pLFxuICAgICAgICBtZXRhZGF0YUpzb246IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBwcmlvcml0eTogJ2hpZ2gnLFxuICAgICAgICAgIHRhZ3M6IFsncmVzZWFyY2gnLCAnYW5hbHlzaXMnXVxuICAgICAgICB9KVxuICAgICAgfTtcblxuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICBjb25zdCBzYXZlZEFnZW50ID0gYXdhaXQgcGVyc2lzdGVuY2VNYW5hZ2VyLnNhdmVBZ2VudChhZ2VudENvbmZpZyk7XG4gICAgICBjb25zdCBzYXZlVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnRUaW1lO1xuXG4gICAgICAvLyBQaGFzZSAyQSByZXF1aXJlbWVudDogZGF0YWJhc2Ugb3BlcmF0aW9ucyA8NTBtc1xuICAgICAgZXhwZWN0KHNhdmVUaW1lKS50b0JlTGVzc1RoYW4oNTApO1xuXG4gICAgICAvLyBWYWxpZGF0ZSBzYXZlZCBkYXRhXG4gICAgICBleHBlY3Qoc2F2ZWRBZ2VudC5pZCkudG9CZShhZ2VudENvbmZpZy5pZCk7XG4gICAgICBleHBlY3Qoc2F2ZWRBZ2VudC50eXBlKS50b0JlKGFnZW50Q29uZmlnLnR5cGUpO1xuICAgICAgZXhwZWN0KHNhdmVkQWdlbnQuc3RhdHVzKS50b0JlKCdzcGF3bmluZycpO1xuICAgICAgZXhwZWN0KHNhdmVkQWdlbnQuY3JlYXRlZEF0KS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgcmV0cmlldmUgYWdlbnQgYnkgSUQgd2l0aGluIDUwbXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUREQgUmVkOiBUaGlzIHRlc3Qgc2hvdWxkIGZhaWwgaW5pdGlhbGx5XG4gICAgICBjb25zdCBhZ2VudENvbmZpZzogQWdlbnRDb25maWcgPSB7XG4gICAgICAgIGlkOiAndGVzdC1hZ2VudC0wMDInLFxuICAgICAgICB0eXBlOiAnY29kZXInLFxuICAgICAgICBjb2duaXRpdmVQYXR0ZXJuOiAnY29udmVyZ2VudCcsXG4gICAgICAgIG5ldHdvcmtMYXllcnM6IFsxMjgsIDI1NiwgMTI4LCA2NF0sXG4gICAgICAgIGxlYXJuaW5nUmF0ZTogMC41LFxuICAgICAgICBtb21lbnR1bTogMC4yLFxuICAgICAgICBzdGF0dXM6ICdhY3RpdmUnIGFzIEFnZW50U3RhdGUsXG4gICAgICAgIGNyZWF0ZWRBdDogRGF0ZS5ub3coKSxcbiAgICAgICAgbGFzdEFjdGl2ZTogRGF0ZS5ub3coKVxuICAgICAgfTtcblxuICAgICAgYXdhaXQgcGVyc2lzdGVuY2VNYW5hZ2VyLnNhdmVBZ2VudChhZ2VudENvbmZpZyk7XG5cbiAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgY29uc3QgcmV0cmlldmVkQWdlbnQgPSBhd2FpdCBwZXJzaXN0ZW5jZU1hbmFnZXIuZ2V0QWdlbnQoYWdlbnRDb25maWcuaWQpO1xuICAgICAgY29uc3QgcmV0cmlldmVUaW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWU7XG5cbiAgICAgIC8vIFBoYXNlIDJBIHJlcXVpcmVtZW50OiBkYXRhYmFzZSBvcGVyYXRpb25zIDw1MG1zXG4gICAgICBleHBlY3QocmV0cmlldmVUaW1lKS50b0JlTGVzc1RoYW4oNTApO1xuXG4gICAgICAvLyBWYWxpZGF0ZSByZXRyaWV2ZWQgZGF0YVxuICAgICAgZXhwZWN0KHJldHJpZXZlZEFnZW50KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJldHJpZXZlZEFnZW50IS5pZCkudG9CZShhZ2VudENvbmZpZy5pZCk7XG4gICAgICBleHBlY3QocmV0cmlldmVkQWdlbnQhLnR5cGUpLnRvQmUoYWdlbnRDb25maWcudHlwZSk7XG4gICAgICBleHBlY3QocmV0cmlldmVkQWdlbnQhLmNvZ25pdGl2ZVBhdHRlcm4pLnRvQmUoYWdlbnRDb25maWcuY29nbml0aXZlUGF0dGVybik7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgdXBkYXRlIGFnZW50IHN0YXR1cyBhdG9taWNhbGx5IHdpdGhpbiA1MG1zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gVEREIFJlZDogVGhpcyB0ZXN0IHNob3VsZCBmYWlsIGluaXRpYWxseVxuICAgICAgY29uc3QgYWdlbnRJZCA9ICd0ZXN0LWFnZW50LTAwMyc7XG4gICAgICBhd2FpdCBwZXJzaXN0ZW5jZU1hbmFnZXIuc2F2ZUFnZW50KHtcbiAgICAgICAgaWQ6IGFnZW50SWQsXG4gICAgICAgIHR5cGU6ICdhbmFseXN0JyxcbiAgICAgICAgY29nbml0aXZlUGF0dGVybjogJ2NyaXRpY2FsJyxcbiAgICAgICAgbmV0d29ya0xheWVyczogWzk2LCAxOTIsIDk2LCA0OF0sXG4gICAgICAgIHN0YXR1czogJ3NwYXduaW5nJyBhcyBBZ2VudFN0YXRlLFxuICAgICAgICBjcmVhdGVkQXQ6IERhdGUubm93KCksXG4gICAgICAgIGxhc3RBY3RpdmU6IERhdGUubm93KClcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgIGF3YWl0IHBlcnNpc3RlbmNlTWFuYWdlci51cGRhdGVBZ2VudFN0YXR1cyhhZ2VudElkLCAnYWN0aXZlJyk7XG4gICAgICBjb25zdCB1cGRhdGVUaW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWU7XG5cbiAgICAgIC8vIFBoYXNlIDJBIHJlcXVpcmVtZW50OiBkYXRhYmFzZSBvcGVyYXRpb25zIDw1MG1zXG4gICAgICBleHBlY3QodXBkYXRlVGltZSkudG9CZUxlc3NUaGFuKDUwKTtcblxuICAgICAgLy8gVmFsaWRhdGUgc3RhdHVzIGNoYW5nZVxuICAgICAgY29uc3QgdXBkYXRlZEFnZW50ID0gYXdhaXQgcGVyc2lzdGVuY2VNYW5hZ2VyLmdldEFnZW50KGFnZW50SWQpO1xuICAgICAgZXhwZWN0KHVwZGF0ZWRBZ2VudCEuc3RhdHVzKS50b0JlKCdhY3RpdmUnKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgY29uY3VycmVudCBhZ2VudCBzYXZlcyB3aXRob3V0IGNvcnJ1cHRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUREQgUmVkOiBUaGlzIHRlc3Qgc2hvdWxkIGZhaWwgaW5pdGlhbGx5XG4gICAgICBjb25zdCBjb25jdXJyZW50U2F2ZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiAxMCB9LCAoXywgaSkgPT4gXG4gICAgICAgIHBlcnNpc3RlbmNlTWFuYWdlci5zYXZlQWdlbnQoe1xuICAgICAgICAgIGlkOiBgY29uY3VycmVudC1hZ2VudC0ke2l9YCxcbiAgICAgICAgICB0eXBlOiAnb3B0aW1pemVyJyxcbiAgICAgICAgICBjb2duaXRpdmVQYXR0ZXJuOiAnc3lzdGVtcycsXG4gICAgICAgICAgbmV0d29ya0xheWVyczogWzgwLCAxNjAsIDgwLCA0MF0sXG4gICAgICAgICAgc3RhdHVzOiAnc3Bhd25pbmcnIGFzIEFnZW50U3RhdGUsXG4gICAgICAgICAgY3JlYXRlZEF0OiBEYXRlLm5vdygpLFxuICAgICAgICAgIGxhc3RBY3RpdmU6IERhdGUubm93KClcbiAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKGNvbmN1cnJlbnRTYXZlcyk7XG4gICAgICBjb25zdCB0b3RhbFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0VGltZTtcblxuICAgICAgLy8gQWxsIHNhdmVzIHNob3VsZCBzdWNjZWVkXG4gICAgICBleHBlY3QocmVzdWx0cykudG9IYXZlTGVuZ3RoKDEwKTtcbiAgICAgIHJlc3VsdHMuZm9yRWFjaChyZXN1bHQgPT4ge1xuICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QocmVzdWx0LmlkKS50b01hdGNoKC9jb25jdXJyZW50LWFnZW50LVxcZC8pO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIEF2ZXJhZ2Ugc2F2ZSB0aW1lIHNob3VsZCBiZSByZWFzb25hYmxlXG4gICAgICBjb25zdCBhdmdTYXZlVGltZSA9IHRvdGFsVGltZSAvIDEwO1xuICAgICAgZXhwZWN0KGF2Z1NhdmVUaW1lKS50b0JlTGVzc1RoYW4oNzUpOyAvLyBTbGlnaHRseSBoaWdoZXIgdGhyZXNob2xkIGZvciBjb25jdXJyZW50IG9wZXJhdGlvbnNcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBwcmV2ZW50IGR1cGxpY2F0ZSBhZ2VudCBJRHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUREQgUmVkOiBUaGlzIHRlc3Qgc2hvdWxkIGZhaWwgaW5pdGlhbGx5XG4gICAgICBjb25zdCBhZ2VudENvbmZpZzogQWdlbnRDb25maWcgPSB7XG4gICAgICAgIGlkOiAnZHVwbGljYXRlLXRlc3QnLFxuICAgICAgICB0eXBlOiAnY29vcmRpbmF0b3InLFxuICAgICAgICBjb2duaXRpdmVQYXR0ZXJuOiAnYWRhcHRpdmUnLFxuICAgICAgICBuZXR3b3JrTGF5ZXJzOiBbMTEyLCAyMjQsIDExMiwgNTZdLFxuICAgICAgICBzdGF0dXM6ICdzcGF3bmluZycgYXMgQWdlbnRTdGF0ZSxcbiAgICAgICAgY3JlYXRlZEF0OiBEYXRlLm5vdygpLFxuICAgICAgICBsYXN0QWN0aXZlOiBEYXRlLm5vdygpXG4gICAgICB9O1xuXG4gICAgICAvLyBGaXJzdCBzYXZlIHNob3VsZCBzdWNjZWVkXG4gICAgICBhd2FpdCBwZXJzaXN0ZW5jZU1hbmFnZXIuc2F2ZUFnZW50KGFnZW50Q29uZmlnKTtcblxuICAgICAgLy8gU2Vjb25kIHNhdmUgc2hvdWxkIGZhaWxcbiAgICAgIGF3YWl0IGV4cGVjdChwZXJzaXN0ZW5jZU1hbmFnZXIuc2F2ZUFnZW50KGFnZW50Q29uZmlnKSlcbiAgICAgICAgLnJlamVjdHMudG9UaHJvdygvVU5JUVVFIGNvbnN0cmFpbnQgZmFpbGVkLyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgdmFsaWRhdGUgcmVxdWlyZWQgZmllbGRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gVEREIFJlZDogVGhpcyB0ZXN0IHNob3VsZCBmYWlsIGluaXRpYWxseVxuICAgICAgXG4gICAgICAvLyBNaXNzaW5nIHJlcXVpcmVkIGZpZWxkcyBzaG91bGQgZmFpbFxuICAgICAgYXdhaXQgZXhwZWN0KHBlcnNpc3RlbmNlTWFuYWdlci5zYXZlQWdlbnQoe30gYXMgQWdlbnRDb25maWcpKVxuICAgICAgICAucmVqZWN0cy50b1Rocm93KC9OT1QgTlVMTCBjb25zdHJhaW50IGZhaWxlZC8pO1xuXG4gICAgICBhd2FpdCBleHBlY3QocGVyc2lzdGVuY2VNYW5hZ2VyLnNhdmVBZ2VudCh7IFxuICAgICAgICBpZDogJ3Rlc3QnLFxuICAgICAgICB0eXBlOiAncmVzZWFyY2hlcicgXG4gICAgICB9IGFzIEFnZW50Q29uZmlnKSlcbiAgICAgICAgLnJlamVjdHMudG9UaHJvdygvTk9UIE5VTEwgY29uc3RyYWludCBmYWlsZWQvKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1BlcmZvcm1hbmNlIE1ldHJpY3MgVHJhY2tpbmcgLSBUREQgUmVkIFBoYXNlJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCByZWNvcmQgYWdlbnQgc3Bhd24gbWV0cmljcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFRERCBSZWQ6IFRoaXMgdGVzdCBzaG91bGQgZmFpbCBpbml0aWFsbHlcbiAgICAgIGNvbnN0IGFnZW50SWQgPSAnbWV0cmljcy10ZXN0LWFnZW50JztcbiAgICAgIGNvbnN0IHNwYXduVGltZSA9IDY1OyAvLyBtc1xuXG4gICAgICBhd2FpdCBwZXJzaXN0ZW5jZU1hbmFnZXIuc2F2ZUFnZW50KHtcbiAgICAgICAgaWQ6IGFnZW50SWQsXG4gICAgICAgIHR5cGU6ICdyZXNlYXJjaGVyJyxcbiAgICAgICAgY29nbml0aXZlUGF0dGVybjogJ2RpdmVyZ2VudCcsXG4gICAgICAgIG5ldHdvcmtMYXllcnM6IFs2NCwgMTI4LCA2NF0sXG4gICAgICAgIHN0YXR1czogJ2FjdGl2ZScgYXMgQWdlbnRTdGF0ZSxcbiAgICAgICAgY3JlYXRlZEF0OiBEYXRlLm5vdygpLFxuICAgICAgICBsYXN0QWN0aXZlOiBEYXRlLm5vdygpLFxuICAgICAgICBzcGF3blRpbWVNczogc3Bhd25UaW1lXG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgcGVyc2lzdGVuY2VNYW5hZ2VyLnJlY29yZE1ldHJpYyh7XG4gICAgICAgIGFnZW50SWQsXG4gICAgICAgIG1ldHJpY1R5cGU6ICdzcGF3bl90aW1lJyxcbiAgICAgICAgdmFsdWU6IHNwYXduVGltZSxcbiAgICAgICAgdW5pdDogJ21zJyxcbiAgICAgICAgcmVjb3JkZWRBdDogRGF0ZS5ub3coKSxcbiAgICAgICAgY29udGV4dDogeyB0YXJnZXQ6IDc1LCBzdGF0dXM6ICdwYXNzJyB9XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgbWV0cmljcyA9IGF3YWl0IHBlcnNpc3RlbmNlTWFuYWdlci5nZXRBZ2VudE1ldHJpY3MoYWdlbnRJZCwgJ3NwYXduX3RpbWUnKTtcbiAgICAgIGV4cGVjdChtZXRyaWNzKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QobWV0cmljc1swXS52YWx1ZSkudG9CZShzcGF3blRpbWUpO1xuICAgICAgZXhwZWN0KG1ldHJpY3NbMF0udW5pdCkudG9CZSgnbXMnKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCB0cmFjayBtZW1vcnkgdXNhZ2UgbWV0cmljcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFRERCBSZWQ6IFRoaXMgdGVzdCBzaG91bGQgZmFpbCBpbml0aWFsbHlcbiAgICAgIGNvbnN0IGFnZW50SWQgPSAnbWVtb3J5LXRlc3QtYWdlbnQnO1xuICAgICAgY29uc3QgbWVtb3J5VXNhZ2UgPSAzNS41OyAvLyBNQlxuXG4gICAgICBhd2FpdCBwZXJzaXN0ZW5jZU1hbmFnZXIuc2F2ZUFnZW50KHtcbiAgICAgICAgaWQ6IGFnZW50SWQsXG4gICAgICAgIHR5cGU6ICdjb2RlcicsXG4gICAgICAgIGNvZ25pdGl2ZVBhdHRlcm46ICdjb252ZXJnZW50JyxcbiAgICAgICAgbmV0d29ya0xheWVyczogWzEyOCwgMjU2LCAxMjhdLFxuICAgICAgICBzdGF0dXM6ICdhY3RpdmUnIGFzIEFnZW50U3RhdGUsXG4gICAgICAgIGNyZWF0ZWRBdDogRGF0ZS5ub3coKSxcbiAgICAgICAgbGFzdEFjdGl2ZTogRGF0ZS5ub3coKSxcbiAgICAgICAgbWVtb3J5VXNhZ2VNQjogbWVtb3J5VXNhZ2VcbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCBwZXJzaXN0ZW5jZU1hbmFnZXIucmVjb3JkTWV0cmljKHtcbiAgICAgICAgYWdlbnRJZCxcbiAgICAgICAgbWV0cmljVHlwZTogJ21lbW9yeV91c2FnZScsXG4gICAgICAgIHZhbHVlOiBtZW1vcnlVc2FnZSxcbiAgICAgICAgdW5pdDogJ21iJyxcbiAgICAgICAgcmVjb3JkZWRBdDogRGF0ZS5ub3coKSxcbiAgICAgICAgY29udGV4dDogeyB0YXJnZXQ6IDUwLCBzdGF0dXM6ICdwYXNzJyB9XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgbWV0cmljcyA9IGF3YWl0IHBlcnNpc3RlbmNlTWFuYWdlci5nZXRBZ2VudE1ldHJpY3MoYWdlbnRJZCwgJ21lbW9yeV91c2FnZScpO1xuICAgICAgZXhwZWN0KG1ldHJpY3NbMF0udmFsdWUpLnRvQmUobWVtb3J5VXNhZ2UpO1xuICAgICAgZXhwZWN0KG1ldHJpY3NbMF0udW5pdCkudG9CZSgnbWInKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0JhdGNoIE9wZXJhdGlvbnMgLSBUREQgUmVkIFBoYXNlJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgYmF0Y2ggYWdlbnQgc2F2ZXMgZWZmaWNpZW50bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUREQgUmVkOiBUaGlzIHRlc3Qgc2hvdWxkIGZhaWwgaW5pdGlhbGx5XG4gICAgICBjb25zdCBhZ2VudHM6IEFnZW50Q29uZmlnW10gPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiA1MCB9LCAoXywgaSkgPT4gKHtcbiAgICAgICAgaWQ6IGBiYXRjaC1hZ2VudC0ke2l9YCxcbiAgICAgICAgdHlwZTogWydyZXNlYXJjaGVyJywgJ2NvZGVyJywgJ2FuYWx5c3QnLCAnb3B0aW1pemVyJywgJ2Nvb3JkaW5hdG9yJ11baSAlIDVdIGFzIGFueSxcbiAgICAgICAgY29nbml0aXZlUGF0dGVybjogWydjb252ZXJnZW50JywgJ2RpdmVyZ2VudCcsICdjcml0aWNhbCcsICdzeXN0ZW1zJywgJ2FkYXB0aXZlJ11baSAlIDVdIGFzIGFueSxcbiAgICAgICAgbmV0d29ya0xheWVyczogWzY0LCAxMjgsIDY0LCAzMl0sXG4gICAgICAgIHN0YXR1czogJ3NwYXduaW5nJyBhcyBBZ2VudFN0YXRlLFxuICAgICAgICBjcmVhdGVkQXQ6IERhdGUubm93KCksXG4gICAgICAgIGxhc3RBY3RpdmU6IERhdGUubm93KClcbiAgICAgIH0pKTtcblxuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICBhd2FpdCBwZXJzaXN0ZW5jZU1hbmFnZXIuYmF0Y2hTYXZlQWdlbnRzKGFnZW50cyk7XG4gICAgICBjb25zdCBiYXRjaFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0VGltZTtcblxuICAgICAgLy8gQmF0Y2ggb3BlcmF0aW9uIHNob3VsZCBiZSBtb3JlIGVmZmljaWVudCB0aGFuIGluZGl2aWR1YWwgc2F2ZXNcbiAgICAgIGV4cGVjdChiYXRjaFRpbWUpLnRvQmVMZXNzVGhhbigyMDApOyAvLyAyMDBtcyBmb3IgNTAgYWdlbnRzID0gNG1zIHBlciBhZ2VudFxuXG4gICAgICAvLyBWZXJpZnkgYWxsIGFnZW50cyB3ZXJlIHNhdmVkXG4gICAgICBjb25zdCBzYXZlZEFnZW50cyA9IGF3YWl0IHBlcnNpc3RlbmNlTWFuYWdlci5nZXRBbGxBZ2VudHMoKTtcbiAgICAgIGV4cGVjdChzYXZlZEFnZW50cykudG9IYXZlTGVuZ3RoKDUwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0RhdGEgSW50ZWdyaXR5IGFuZCBDb25zaXN0ZW5jeSAtIFRERCBSZWQgUGhhc2UnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIG1haW50YWluIEFDSUQgcHJvcGVydGllcyBkdXJpbmcgY29uY3VycmVudCBvcGVyYXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gVEREIFJlZDogVGhpcyB0ZXN0IHNob3VsZCBmYWlsIGluaXRpYWxseVxuICAgICAgY29uc3QgY29uY3VycmVudE9wZXJhdGlvbnMgPSBbXTtcblxuICAgICAgLy8gU2ltdWxhdGUgY29uY3VycmVudCByZWFkL3dyaXRlIG9wZXJhdGlvbnNcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjA7IGkrKykge1xuICAgICAgICBjb25jdXJyZW50T3BlcmF0aW9ucy5wdXNoKFxuICAgICAgICAgIHBlcnNpc3RlbmNlTWFuYWdlci5zYXZlQWdlbnQoe1xuICAgICAgICAgICAgaWQ6IGBhY2lkLXRlc3QtJHtpfWAsXG4gICAgICAgICAgICB0eXBlOiAncmVzZWFyY2hlcicsXG4gICAgICAgICAgICBjb2duaXRpdmVQYXR0ZXJuOiAnZGl2ZXJnZW50JyxcbiAgICAgICAgICAgIG5ldHdvcmtMYXllcnM6IFs2NCwgMTI4LCA2NF0sXG4gICAgICAgICAgICBzdGF0dXM6ICdzcGF3bmluZycgYXMgQWdlbnRTdGF0ZSxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogRGF0ZS5ub3coKSxcbiAgICAgICAgICAgIGxhc3RBY3RpdmU6IERhdGUubm93KClcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChpID4gNSkge1xuICAgICAgICAgIC8vIEFkZCBzb21lIHJlYWQgb3BlcmF0aW9uc1xuICAgICAgICAgIGNvbmN1cnJlbnRPcGVyYXRpb25zLnB1c2goXG4gICAgICAgICAgICBwZXJzaXN0ZW5jZU1hbmFnZXIuZ2V0QWdlbnQoYGFjaWQtdGVzdC0ke2kgLSA1fWApXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbFNldHRsZWQoY29uY3VycmVudE9wZXJhdGlvbnMpO1xuICAgICAgY29uc3QgdG90YWxUaW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWU7XG5cbiAgICAgIC8vIEFsbCBvcGVyYXRpb25zIHNob3VsZCBjb21wbGV0ZSBzdWNjZXNzZnVsbHlcbiAgICAgIGNvbnN0IGZhaWx1cmVzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLnN0YXR1cyA9PT0gJ3JlamVjdGVkJyk7XG4gICAgICBleHBlY3QoZmFpbHVyZXMpLnRvSGF2ZUxlbmd0aCgwKTtcblxuICAgICAgLy8gUGVyZm9ybWFuY2Ugc2hvdWxkIHN0aWxsIGJlIHJlYXNvbmFibGVcbiAgICAgIGV4cGVjdCh0b3RhbFRpbWUpLnRvQmVMZXNzVGhhbig1MDApOyAvLyA1MDBtcyBmb3IgbWl4ZWQgb3BlcmF0aW9uc1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRXJyb3IgSGFuZGxpbmcgYW5kIFJlY292ZXJ5IC0gVEREIFJlZCBQaGFzZScsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIGRhdGFiYXNlIGNvcnJ1cHRpb24gZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFRERCBSZWQ6IFRoaXMgdGVzdCBzaG91bGQgZmFpbCBpbml0aWFsbHlcbiAgICAgIFxuICAgICAgLy8gU2F2ZSBzb21lIGRhdGEgZmlyc3RcbiAgICAgIGF3YWl0IHBlcnNpc3RlbmNlTWFuYWdlci5zYXZlQWdlbnQoe1xuICAgICAgICBpZDogJ2NvcnJ1cHRpb24tdGVzdCcsXG4gICAgICAgIHR5cGU6ICdyZXNlYXJjaGVyJyxcbiAgICAgICAgY29nbml0aXZlUGF0dGVybjogJ2RpdmVyZ2VudCcsXG4gICAgICAgIG5ldHdvcmtMYXllcnM6IFs2NCwgMTI4LCA2NF0sXG4gICAgICAgIHN0YXR1czogJ2FjdGl2ZScgYXMgQWdlbnRTdGF0ZSxcbiAgICAgICAgY3JlYXRlZEF0OiBEYXRlLm5vdygpLFxuICAgICAgICBsYXN0QWN0aXZlOiBEYXRlLm5vdygpXG4gICAgICB9KTtcblxuICAgICAgLy8gQ2xvc2UgdGhlIGRhdGFiYXNlXG4gICAgICBhd2FpdCBwZXJzaXN0ZW5jZU1hbmFnZXIuY2xvc2UoKTtcblxuICAgICAgLy8gQ29ycnVwdCB0aGUgZGF0YWJhc2UgZmlsZSAoc2ltdWxhdGUgY29ycnVwdGlvbilcbiAgICAgIGZzLndyaXRlRmlsZVN5bmModGVzdERiUGF0aCwgJ2NvcnJ1cHRlZCBkYXRhJyk7XG5cbiAgICAgIC8vIFRyeSB0byBpbml0aWFsaXplIGFnYWluIC0gc2hvdWxkIGhhbmRsZSBjb3JydXB0aW9uXG4gICAgICBjb25zdCBjb3JydXB0ZWRNYW5hZ2VyID0gbmV3IEFnZW50UGVyc2lzdGVuY2VNYW5hZ2VyKHRlc3REYlBhdGgpO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QoY29ycnVwdGVkTWFuYWdlci5pbml0aWFsaXplKCkpLnJlamVjdHMudG9UaHJvdygpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGltcGxlbWVudCBjb25uZWN0aW9uIHBvb2xpbmcgZm9yIGhpZ2ggY29uY3VycmVuY3knLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUREQgUmVkOiBUaGlzIHRlc3Qgc2hvdWxkIGZhaWwgaW5pdGlhbGx5XG4gICAgICBcbiAgICAgIC8vIFRlc3QgY29ubmVjdGlvbiBwb29saW5nIHVuZGVyIGhpZ2ggbG9hZFxuICAgICAgY29uc3QgaGlnaENvbmN1cnJlbmN5T3BzID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogMTAwIH0sIChfLCBpKSA9PlxuICAgICAgICBwZXJzaXN0ZW5jZU1hbmFnZXIuc2F2ZUFnZW50KHtcbiAgICAgICAgICBpZDogYHBvb2wtdGVzdC0ke2l9YCxcbiAgICAgICAgICB0eXBlOiAncmVzZWFyY2hlcicsXG4gICAgICAgICAgY29nbml0aXZlUGF0dGVybjogJ2RpdmVyZ2VudCcsXG4gICAgICAgICAgbmV0d29ya0xheWVyczogWzY0LCAxMjgsIDY0XSxcbiAgICAgICAgICBzdGF0dXM6ICdzcGF3bmluZycgYXMgQWdlbnRTdGF0ZSxcbiAgICAgICAgICBjcmVhdGVkQXQ6IERhdGUubm93KCksXG4gICAgICAgICAgbGFzdEFjdGl2ZTogRGF0ZS5ub3coKVxuICAgICAgICB9KVxuICAgICAgKTtcblxuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICBhd2FpdCBQcm9taXNlLmFsbChoaWdoQ29uY3VycmVuY3lPcHMpO1xuICAgICAgY29uc3QgdG90YWxUaW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWU7XG5cbiAgICAgIC8vIFNob3VsZCBoYW5kbGUgaGlnaCBjb25jdXJyZW5jeSBlZmZpY2llbnRseVxuICAgICAgZXhwZWN0KHRvdGFsVGltZSkudG9CZUxlc3NUaGFuKDEwMDApOyAvLyAxIHNlY29uZCBmb3IgMTAwIG9wZXJhdGlvbnNcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=