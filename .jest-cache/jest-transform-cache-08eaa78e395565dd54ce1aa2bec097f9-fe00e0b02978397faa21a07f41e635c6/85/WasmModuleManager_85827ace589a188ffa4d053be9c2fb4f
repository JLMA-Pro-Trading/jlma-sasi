20d39a18991eb86e95ff3504f3a6df44
"use strict";
/**
 * WASM Module Manager - Issue #19
 *
 * This module provides comprehensive WASM module loading and management
 * with automatic fallback and performance optimization.
 *
 * Features:
 * - Dynamic WASM module loading
 * - Automatic fallback management
 * - Performance optimization
 * - Module lifecycle management
 * - Resource cleanup
 * - Error handling and recovery
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.WasmModuleManager = void 0;
const WasmPerformanceLayer_1 = require("./WasmPerformanceLayer");
const SIMDAccelerationLayer_1 = require("./SIMDAccelerationLayer");
class WasmModuleManager {
    constructor(config = {}) {
        Object.defineProperty(this, "config", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        Object.defineProperty(this, "performanceLayer", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        Object.defineProperty(this, "simdLayer", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        Object.defineProperty(this, "moduleStatus", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        Object.defineProperty(this, "moduleMetrics", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        Object.defineProperty(this, "availableModules", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: new Map()
        });
        Object.defineProperty(this, "isInitialized", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: false
        });
        Object.defineProperty(this, "startTime", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: 0
        });
        Object.defineProperty(this, "performanceHistory", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: []
        });
        Object.defineProperty(this, "errorHistory", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: []
        });
        Object.defineProperty(this, "monitoringIntervalId", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: null
        });
        this.config = {
            preferredModule: 'ruv-swarm',
            enableSIMD: true,
            memoryLimit: 50 * 1024 * 1024, // 50MB
            loadTimeout: 10000, // 10 seconds
            retryAttempts: 3,
            enableProfiling: true,
            enableAutoFallback: true,
            ...config
        };
        this.performanceLayer = new WasmPerformanceLayer_1.WasmPerformanceLayer();
        this.simdLayer = new SIMDAccelerationLayer_1.SIMDAccelerationLayer();
        this.moduleStatus = this.initializeModuleStatus();
        this.moduleMetrics = this.initializeModuleMetrics();
        this.initializeAvailableModules();
    }
    /**
     * Initialize the WASM module manager
     */
    async initialize() {
        this.startTime = Date.now();
        try {
            console.log('üöÄ Initializing WASM Module Manager...');
            console.log('‚öôÔ∏è Configuration:', this.config);
            // Initialize SIMD layer first
            if (this.config.enableSIMD) {
                await this.simdLayer.initialize();
            }
            // Attempt to load preferred module
            let success = false;
            if (this.config.preferredModule === 'ruv-swarm') {
                success = await this.loadRuvSwarmModule();
            }
            else if (this.config.preferredModule === 'production') {
                success = await this.loadProductionModule();
            }
            else {
                success = await this.loadFallbackModule();
            }
            // Auto-fallback if enabled and preferred module failed
            if (!success && this.config.enableAutoFallback) {
                success = await this.attemptAutoFallback();
            }
            if (!success) {
                throw new Error('Failed to load any WASM module');
            }
            // Initialize performance layer
            await this.performanceLayer.initialize();
            // Start performance monitoring
            if (this.config.enableProfiling) {
                this.startPerformanceMonitoring();
            }
            this.isInitialized = true;
            this.moduleMetrics.loadTime = Date.now() - this.startTime;
            console.log('‚úÖ WASM Module Manager initialized successfully');
            console.log(`üìä Status: ${this.moduleStatus.module} loaded in ${this.moduleMetrics.loadTime}ms`);
            return true;
        }
        catch (error) {
            console.error('‚ùå WASM Module Manager initialization failed:', error);
            this.handleError(error.message);
            return false;
        }
    }
    /**
     * Initialize available modules registry
     */
    initializeAvailableModules() {
        this.availableModules.set('ruv-swarm', {
            name: 'ruv-swarm',
            description: 'High-performance neural network swarm orchestration',
            version: '1.0.18',
            capabilities: ['SIMD', 'neural-networks', 'swarm-orchestration', 'memory-pool'],
            memoryRequirement: 16 * 1024 * 1024, // 16MB
            loadPriority: 1,
            available: true
        });
        this.availableModules.set('production', {
            name: 'production',
            description: 'Production-ready WASM neural runtime',
            version: '1.0.0',
            capabilities: ['SIMD', 'neural-networks', 'performance-monitoring'],
            memoryRequirement: 8 * 1024 * 1024, // 8MB
            loadPriority: 2,
            available: true
        });
        this.availableModules.set('fallback', {
            name: 'fallback',
            description: 'Development fallback WASM bridge',
            version: '1.0.0',
            capabilities: ['neural-networks', 'basic-operations'],
            memoryRequirement: 4 * 1024 * 1024, // 4MB
            loadPriority: 3,
            available: true
        });
    }
    /**
     * Initialize module status
     */
    initializeModuleStatus() {
        return {
            loaded: false,
            module: 'none',
            version: '0.0.0',
            capabilities: [],
            memoryUsage: 0,
            loadTime: 0,
            errorCount: 0
        };
    }
    /**
     * Initialize module metrics
     */
    initializeModuleMetrics() {
        return {
            loadTime: 0,
            memoryUsage: 0,
            operationsPerSecond: 0,
            errorRate: 0,
            uptime: 0,
            performanceScore: 0
        };
    }
    /**
     * Load ruv-swarm WASM module
     */
    async loadRuvSwarmModule() {
        try {
            console.log('üîÑ Loading ruv-swarm WASM module...');
            const moduleInfo = this.availableModules.get('ruv-swarm');
            // Check memory requirements
            if (moduleInfo.memoryRequirement > this.config.memoryLimit) {
                console.warn(`‚ö†Ô∏è ruv-swarm requires ${moduleInfo.memoryRequirement} bytes, limit is ${this.config.memoryLimit}`);
            }
            // Load with timeout
            const loadPromise = this.performanceLayer.initialize();
            const timeoutPromise = new Promise((_, reject) => {
                setTimeout(() => reject(new Error('Load timeout')), this.config.loadTimeout);
            });
            await Promise.race([loadPromise, timeoutPromise]);
            if (this.performanceLayer.isUsingRuvSwarm()) {
                this.updateModuleStatus('ruv-swarm', moduleInfo);
                console.log('‚úÖ ruv-swarm WASM module loaded successfully');
                return true;
            }
            return false;
        }
        catch (error) {
            console.warn('‚ö†Ô∏è Failed to load ruv-swarm WASM module:', error.message);
            this.handleError(error.message);
            return false;
        }
    }
    /**
     * Load production WASM module
     */
    async loadProductionModule() {
        try {
            console.log('üîÑ Loading production WASM module...');
            const moduleInfo = this.availableModules.get('production');
            // Initialize performance layer (will use production bridge)
            await this.performanceLayer.initialize();
            if (this.performanceLayer.isWasmInitialized()) {
                this.updateModuleStatus('production', moduleInfo);
                console.log('‚úÖ Production WASM module loaded successfully');
                return true;
            }
            return false;
        }
        catch (error) {
            console.warn('‚ö†Ô∏è Failed to load production WASM module:', error.message);
            this.handleError(error.message);
            return false;
        }
    }
    /**
     * Load fallback WASM module
     */
    async loadFallbackModule() {
        try {
            console.log('üîÑ Loading fallback WASM module...');
            const moduleInfo = this.availableModules.get('fallback');
            // Initialize performance layer (will use fallback bridge)
            await this.performanceLayer.initialize();
            if (this.performanceLayer.isWasmInitialized()) {
                this.updateModuleStatus('fallback', moduleInfo);
                console.log('‚úÖ Fallback WASM module loaded successfully');
                return true;
            }
            return false;
        }
        catch (error) {
            console.error('‚ùå Failed to load fallback WASM module:', error.message);
            this.handleError(error.message);
            return false;
        }
    }
    /**
     * Attempt automatic fallback
     */
    async attemptAutoFallback() {
        console.log('üîÑ Attempting automatic fallback...');
        const fallbackOrder = ['production', 'fallback'];
        for (const moduleName of fallbackOrder) {
            if (moduleName === this.config.preferredModule) {
                continue; // Skip already tried module
            }
            console.log(`üîÑ Trying ${moduleName} module...`);
            let success = false;
            if (moduleName === 'production') {
                success = await this.loadProductionModule();
            }
            else if (moduleName === 'fallback') {
                success = await this.loadFallbackModule();
            }
            if (success) {
                console.log(`‚úÖ Auto-fallback successful: ${moduleName}`);
                return true;
            }
        }
        console.error('‚ùå Auto-fallback failed: no modules available');
        return false;
    }
    /**
     * Update module status
     */
    updateModuleStatus(moduleName, moduleInfo) {
        this.moduleStatus.loaded = true;
        this.moduleStatus.module = moduleName;
        this.moduleStatus.version = moduleInfo.version;
        this.moduleStatus.capabilities = [...moduleInfo.capabilities];
        this.moduleStatus.memoryUsage = this.performanceLayer.getMemoryUsage();
        this.moduleStatus.loadTime = Date.now() - this.startTime;
    }
    /**
     * Start performance monitoring
     */
    startPerformanceMonitoring() {
        const monitoringInterval = setInterval(() => {
            this.updateMetrics();
            this.performanceHistory.push(this.moduleMetrics.performanceScore);
            // Keep only last 100 measurements
            if (this.performanceHistory.length > 100) {
                this.performanceHistory.shift();
            }
            // Check for performance degradation
            if (this.performanceHistory.length > 10) {
                const recent = this.performanceHistory.slice(-10);
                const older = this.performanceHistory.slice(-20, -10);
                if (older.length > 0) {
                    const recentAvg = recent.reduce((a, b) => a + b, 0) / recent.length;
                    const olderAvg = older.reduce((a, b) => a + b, 0) / older.length;
                    if (recentAvg < olderAvg * 0.8) {
                        console.warn('‚ö†Ô∏è Performance degradation detected');
                    }
                }
            }
        }, 5000); // Update every 5 seconds
        // Store interval ID for cleanup
        this.monitoringIntervalId = monitoringInterval;
    }
    /**
     * Update performance metrics
     */
    updateMetrics() {
        const performanceMetrics = this.performanceLayer.getPerformanceMetrics();
        const simdMetrics = this.simdLayer.getPerformanceMetrics();
        this.moduleMetrics.memoryUsage = performanceMetrics.memoryUsage;
        this.moduleMetrics.operationsPerSecond = performanceMetrics.operationsPerSecond;
        this.moduleMetrics.errorRate = performanceMetrics.errorRate || 0;
        this.moduleMetrics.uptime = Date.now() - this.startTime;
        // Calculate performance score (0-100)
        const memoryScore = Math.max(0, 100 - (this.moduleMetrics.memoryUsage / this.config.memoryLimit) * 100);
        const performanceScore = Math.min(100, this.moduleMetrics.operationsPerSecond / 1000);
        const errorScore = Math.max(0, 100 - this.moduleMetrics.errorRate * 100);
        const simdScore = simdMetrics.simdUtilization * 100;
        this.moduleMetrics.performanceScore = (memoryScore + performanceScore + errorScore + simdScore) / 4;
        // Update module status
        this.moduleStatus.memoryUsage = this.moduleMetrics.memoryUsage;
    }
    /**
     * Handle errors
     */
    handleError(errorMessage) {
        this.moduleStatus.errorCount++;
        this.moduleStatus.lastError = errorMessage;
        this.errorHistory.push(errorMessage);
        // Keep only last 50 errors
        if (this.errorHistory.length > 50) {
            this.errorHistory.shift();
        }
        // Update error rate
        this.moduleMetrics.errorRate = this.moduleStatus.errorCount / Math.max(1, this.moduleMetrics.uptime / 1000);
    }
    /**
     * Get module status
     */
    getModuleStatus() {
        return { ...this.moduleStatus };
    }
    /**
     * Get module metrics
     */
    getModuleMetrics() {
        this.updateMetrics();
        return { ...this.moduleMetrics };
    }
    /**
     * Get available modules
     */
    getAvailableModules() {
        return Array.from(this.availableModules.values());
    }
    /**
     * Get performance layer
     */
    getPerformanceLayer() {
        return this.performanceLayer;
    }
    /**
     * Get SIMD layer
     */
    getSIMDLayer() {
        return this.simdLayer;
    }
    /**
     * Switch to different module
     */
    async switchModule(moduleName) {
        if (!this.availableModules.has(moduleName)) {
            console.error(`‚ùå Module ${moduleName} not available`);
            return false;
        }
        if (this.moduleStatus.module === moduleName) {
            console.log(`‚ÑπÔ∏è Already using ${moduleName} module`);
            return true;
        }
        console.log(`üîÑ Switching to ${moduleName} module...`);
        // Cleanup current module
        await this.cleanup();
        // Load new module
        let success = false;
        if (moduleName === 'ruv-swarm') {
            success = await this.loadRuvSwarmModule();
        }
        else if (moduleName === 'production') {
            success = await this.loadProductionModule();
        }
        else if (moduleName === 'fallback') {
            success = await this.loadFallbackModule();
        }
        if (success) {
            console.log(`‚úÖ Successfully switched to ${moduleName} module`);
            // Restart performance monitoring
            if (this.config.enableProfiling) {
                this.startPerformanceMonitoring();
            }
        }
        return success;
    }
    /**
     * Run health check
     */
    healthCheck() {
        const issues = [];
        let status = 'healthy';
        if (!this.isInitialized) {
            issues.push('WASM Module Manager not initialized');
            status = 'error';
        }
        if (!this.moduleStatus.loaded) {
            issues.push('No WASM module loaded');
            status = 'error';
        }
        if (this.moduleMetrics.memoryUsage > this.config.memoryLimit * 0.9) {
            issues.push(`Memory usage ${(this.moduleMetrics.memoryUsage / 1024 / 1024).toFixed(2)}MB near limit`);
            status = 'warning';
        }
        if (this.moduleMetrics.errorRate > 0.1) {
            issues.push(`Error rate ${(this.moduleMetrics.errorRate * 100).toFixed(1)}% too high`);
            status = 'warning';
        }
        if (this.moduleMetrics.performanceScore < 50) {
            issues.push(`Performance score ${this.moduleMetrics.performanceScore.toFixed(1)} below threshold`);
            status = 'warning';
        }
        return {
            status,
            module: this.getModuleStatus(),
            metrics: this.getModuleMetrics(),
            issues
        };
    }
    /**
     * Get performance report
     */
    getPerformanceReport() {
        const status = this.getModuleStatus();
        const metrics = this.getModuleMetrics();
        const simdMetrics = this.simdLayer.getPerformanceMetrics();
        return `WASM Module Manager Performance Report:

üìä Module Status:
   - Active Module: ${status.module} v${status.version}
   - Load Time: ${status.loadTime}ms
   - Memory Usage: ${(status.memoryUsage / 1024 / 1024).toFixed(2)}MB
   - Capabilities: ${status.capabilities.join(', ')}
   - Error Count: ${status.errorCount}

‚ö° Performance Metrics:
   - Operations/sec: ${metrics.operationsPerSecond.toFixed(0)}
   - Performance Score: ${metrics.performanceScore.toFixed(1)}/100
   - Error Rate: ${(metrics.errorRate * 100).toFixed(2)}%
   - Uptime: ${(metrics.uptime / 1000).toFixed(0)}s

üîß SIMD Performance:
   - SIMD Support: ${this.simdLayer.isSIMDSupported() ? '‚úÖ' : '‚ùå'}
   - Operations/sec: ${simdMetrics.operationsPerSecond.toFixed(0)}
   - Vectorization: ${(simdMetrics.vectorizationEfficiency * 100).toFixed(1)}%
   - Utilization: ${(simdMetrics.simdUtilization * 100).toFixed(1)}%

üí° Recent Performance: ${this.performanceHistory.slice(-5).map(s => s.toFixed(1)).join(', ')}
`;
    }
    /**
     * Export configuration
     */
    exportConfig() {
        return { ...this.config };
    }
    /**
     * Update configuration
     */
    updateConfig(newConfig) {
        this.config = { ...this.config, ...newConfig };
        console.log('‚öôÔ∏è Configuration updated:', this.config);
    }
    /**
     * Check if initialized
     */
    isModuleManagerInitialized() {
        return this.isInitialized;
    }
    /**
     * Cleanup resources
     */
    async cleanup() {
        console.log('üßπ Cleaning up WASM Module Manager...');
        // Stop performance monitoring
        if (this.monitoringIntervalId) {
            clearInterval(this.monitoringIntervalId);
            this.monitoringIntervalId = null;
        }
        // Cleanup performance layer
        if (this.performanceLayer) {
            this.performanceLayer.cleanup();
        }
        // Cleanup SIMD layer
        if (this.simdLayer) {
            this.simdLayer.cleanup();
        }
        // Reset status and metrics
        this.moduleStatus = this.initializeModuleStatus();
        this.moduleMetrics = this.initializeModuleMetrics();
        this.performanceHistory = [];
        this.errorHistory = [];
        this.isInitialized = false;
        console.log('‚úÖ WASM Module Manager cleanup completed');
    }
}
exports.WasmModuleManager = WasmModuleManager;
exports.default = WasmModuleManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL3dvcmtzcGFjZXMvYWdlbnRpc3RzLXF1aWNrc3RhcnQtd29ya3NwYWNlLWJhc2ljL3Nhc2kvc3JjL3BlcmZvcm1hbmNlL1dhc21Nb2R1bGVNYW5hZ2VyLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7OztHQWFHOzs7QUFFSCxpRUFBNkQ7QUFDN0QsbUVBQStEO0FBMEMvRCxNQUFhLGlCQUFpQjtJQVk1QixZQUFZLFNBQW9DLEVBQUU7UUFYMUM7Ozs7O1dBQXdCO1FBQ3hCOzs7OztXQUFzQztRQUN0Qzs7Ozs7V0FBZ0M7UUFDaEM7Ozs7O1dBQThCO1FBQzlCOzs7OztXQUFnQztRQUNoQzs7OzttQkFBZ0QsSUFBSSxHQUFHLEVBQUU7V0FBQTtRQUN6RDs7OzttQkFBZ0IsS0FBSztXQUFBO1FBQ3JCOzs7O21CQUFZLENBQUM7V0FBQTtRQUNiOzs7O21CQUErQixFQUFFO1dBQUE7UUFDakM7Ozs7bUJBQXlCLEVBQUU7V0FBQTtRQTBUM0I7Ozs7bUJBQThDLElBQUk7V0FBQTtRQXZUeEQsSUFBSSxDQUFDLE1BQU0sR0FBRztZQUNaLGVBQWUsRUFBRSxXQUFXO1lBQzVCLFVBQVUsRUFBRSxJQUFJO1lBQ2hCLFdBQVcsRUFBRSxFQUFFLEdBQUcsSUFBSSxHQUFHLElBQUksRUFBRSxPQUFPO1lBQ3RDLFdBQVcsRUFBRSxLQUFLLEVBQUUsYUFBYTtZQUNqQyxhQUFhLEVBQUUsQ0FBQztZQUNoQixlQUFlLEVBQUUsSUFBSTtZQUNyQixrQkFBa0IsRUFBRSxJQUFJO1lBQ3hCLEdBQUcsTUFBTTtTQUNWLENBQUE7UUFFRCxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSwyQ0FBb0IsRUFBRSxDQUFBO1FBQ2xELElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSw2Q0FBcUIsRUFBRSxDQUFBO1FBQzVDLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLHNCQUFzQixFQUFFLENBQUE7UUFDakQsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsdUJBQXVCLEVBQUUsQ0FBQTtRQUVuRCxJ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ZS1iYXNpYy9zYXNpL3NyYy9wZXJmb3JtYW5jZS9XYXNtTW9kdWxlTWFuYWdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFdBU00gTW9kdWxlIE1hbmFnZXIgLSBJc3N1ZSAjMTlcbiAqIFxuICogVGhpcyBtb2R1bGUgcHJvdmlkZXMgY29tcHJlaGVuc2l2ZSBXQVNNIG1vZHVsZSBsb2FkaW5nIGFuZCBtYW5hZ2VtZW50XG4gKiB3aXRoIGF1dG9tYXRpYyBmYWxsYmFjayBhbmQgcGVyZm9ybWFuY2Ugb3B0aW1pemF0aW9uLlxuICogXG4gKiBGZWF0dXJlczpcbiAqIC0gRHluYW1pYyBXQVNNIG1vZHVsZSBsb2FkaW5nXG4gKiAtIEF1dG9tYXRpYyBmYWxsYmFjayBtYW5hZ2VtZW50XG4gKiAtIFBlcmZvcm1hbmNlIG9wdGltaXphdGlvblxuICogLSBNb2R1bGUgbGlmZWN5Y2xlIG1hbmFnZW1lbnRcbiAqIC0gUmVzb3VyY2UgY2xlYW51cFxuICogLSBFcnJvciBoYW5kbGluZyBhbmQgcmVjb3ZlcnlcbiAqL1xuXG5pbXBvcnQgeyBXYXNtUGVyZm9ybWFuY2VMYXllciB9IGZyb20gJy4vV2FzbVBlcmZvcm1hbmNlTGF5ZXInXG5pbXBvcnQgeyBTSU1EQWNjZWxlcmF0aW9uTGF5ZXIgfSBmcm9tICcuL1NJTURBY2NlbGVyYXRpb25MYXllcidcblxuaW50ZXJmYWNlIFdhc21Nb2R1bGVDb25maWcge1xuICBwcmVmZXJyZWRNb2R1bGU6ICdydXYtc3dhcm0nIHwgJ3Byb2R1Y3Rpb24nIHwgJ2ZhbGxiYWNrJ1xuICBlbmFibGVTSU1EOiBib29sZWFuXG4gIG1lbW9yeUxpbWl0OiBudW1iZXJcbiAgbG9hZFRpbWVvdXQ6IG51bWJlclxuICByZXRyeUF0dGVtcHRzOiBudW1iZXJcbiAgZW5hYmxlUHJvZmlsaW5nOiBib29sZWFuXG4gIGVuYWJsZUF1dG9GYWxsYmFjazogYm9vbGVhblxufVxuXG5pbnRlcmZhY2UgV2FzbU1vZHVsZVN0YXR1cyB7XG4gIGxvYWRlZDogYm9vbGVhblxuICBtb2R1bGU6IHN0cmluZ1xuICB2ZXJzaW9uOiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBzdHJpbmdbXVxuICBtZW1vcnlVc2FnZTogbnVtYmVyXG4gIGxvYWRUaW1lOiBudW1iZXJcbiAgZXJyb3JDb3VudDogbnVtYmVyXG4gIGxhc3RFcnJvcj86IHN0cmluZ1xufVxuXG5pbnRlcmZhY2UgV2FzbU1vZHVsZU1ldHJpY3Mge1xuICBsb2FkVGltZTogbnVtYmVyXG4gIG1lbW9yeVVzYWdlOiBudW1iZXJcbiAgb3BlcmF0aW9uc1BlclNlY29uZDogbnVtYmVyXG4gIGVycm9yUmF0ZTogbnVtYmVyXG4gIHVwdGltZTogbnVtYmVyXG4gIHBlcmZvcm1hbmNlU2NvcmU6IG51bWJlclxufVxuXG5pbnRlcmZhY2UgV2FzbU1vZHVsZUluZm8ge1xuICBuYW1lOiBzdHJpbmdcbiAgZGVzY3JpcHRpb246IHN0cmluZ1xuICB2ZXJzaW9uOiBzdHJpbmdcbiAgY2FwYWJpbGl0aWVzOiBzdHJpbmdbXVxuICBtZW1vcnlSZXF1aXJlbWVudDogbnVtYmVyXG4gIGxvYWRQcmlvcml0eTogbnVtYmVyXG4gIGF2YWlsYWJsZTogYm9vbGVhblxufVxuXG5leHBvcnQgY2xhc3MgV2FzbU1vZHVsZU1hbmFnZXIge1xuICBwcml2YXRlIGNvbmZpZzogV2FzbU1vZHVsZUNvbmZpZ1xuICBwcml2YXRlIHBlcmZvcm1hbmNlTGF5ZXI6IFdhc21QZXJmb3JtYW5jZUxheWVyXG4gIHByaXZhdGUgc2ltZExheWVyOiBTSU1EQWNjZWxlcmF0aW9uTGF5ZXJcbiAgcHJpdmF0ZSBtb2R1bGVTdGF0dXM6IFdhc21Nb2R1bGVTdGF0dXNcbiAgcHJpdmF0ZSBtb2R1bGVNZXRyaWNzOiBXYXNtTW9kdWxlTWV0cmljc1xuICBwcml2YXRlIGF2YWlsYWJsZU1vZHVsZXM6IE1hcDxzdHJpbmcsIFdhc21Nb2R1bGVJbmZvPiA9IG5ldyBNYXAoKVxuICBwcml2YXRlIGlzSW5pdGlhbGl6ZWQgPSBmYWxzZVxuICBwcml2YXRlIHN0YXJ0VGltZSA9IDBcbiAgcHJpdmF0ZSBwZXJmb3JtYW5jZUhpc3Rvcnk6IG51bWJlcltdID0gW11cbiAgcHJpdmF0ZSBlcnJvckhpc3Rvcnk6IHN0cmluZ1tdID0gW11cblxuICBjb25zdHJ1Y3Rvcihjb25maWc6IFBhcnRpYWw8V2FzbU1vZHVsZUNvbmZpZz4gPSB7fSkge1xuICAgIHRoaXMuY29uZmlnID0ge1xuICAgICAgcHJlZmVycmVkTW9kdWxlOiAncnV2LXN3YXJtJyxcbiAgICAgIGVuYWJsZVNJTUQ6IHRydWUsXG4gICAgICBtZW1vcnlMaW1pdDogNTAgKiAxMDI0ICogMTAyNCwgLy8gNTBNQlxuICAgICAgbG9hZFRpbWVvdXQ6IDEwMDAwLCAvLyAxMCBzZWNvbmRzXG4gICAgICByZXRyeUF0dGVtcHRzOiAzLFxuICAgICAgZW5hYmxlUHJvZmlsaW5nOiB0cnVlLFxuICAgICAgZW5hYmxlQXV0b0ZhbGxiYWNrOiB0cnVlLFxuICAgICAgLi4uY29uZmlnXG4gICAgfVxuICAgIFxuICAgIHRoaXMucGVyZm9ybWFuY2VMYXllciA9IG5ldyBXYXNtUGVyZm9ybWFuY2VMYXllcigpXG4gICAgdGhpcy5zaW1kTGF5ZXIgPSBuZXcgU0lNREFjY2VsZXJhdGlvbkxheWVyKClcbiAgICB0aGlzLm1vZHVsZVN0YXR1cyA9IHRoaXMuaW5pdGlhbGl6ZU1vZHVsZVN0YXR1cygpXG4gICAgdGhpcy5tb2R1bGVNZXRyaWNzID0gdGhpcy5pbml0aWFsaXplTW9kdWxlTWV0cmljcygpXG4gICAgXG4gICAgdGhpcy5pbml0aWFsaXplQXZhaWxhYmxlTW9kdWxlcygpXG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZSB0aGUgV0FTTSBtb2R1bGUgbWFuYWdlclxuICAgKi9cbiAgYXN5bmMgaW5pdGlhbGl6ZSgpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0aGlzLnN0YXJ0VGltZSA9IERhdGUubm93KClcbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coJ/CfmoAgSW5pdGlhbGl6aW5nIFdBU00gTW9kdWxlIE1hbmFnZXIuLi4nKVxuICAgICAgY29uc29sZS5sb2coJ+Kame+4jyBDb25maWd1cmF0aW9uOicsIHRoaXMuY29uZmlnKVxuICAgICAgXG4gICAgICAvLyBJbml0aWFsaXplIFNJTUQgbGF5ZXIgZmlyc3RcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5lbmFibGVTSU1EKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuc2ltZExheWVyLmluaXRpYWxpemUoKVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBBdHRlbXB0IHRvIGxvYWQgcHJlZmVycmVkIG1vZHVsZVxuICAgICAgbGV0IHN1Y2Nlc3MgPSBmYWxzZVxuICAgICAgXG4gICAgICBpZiAodGhpcy5jb25maWcucHJlZmVycmVkTW9kdWxlID09PSAncnV2LXN3YXJtJykge1xuICAgICAgICBzdWNjZXNzID0gYXdhaXQgdGhpcy5sb2FkUnV2U3dhcm1Nb2R1bGUoKVxuICAgICAgfSBlbHNlIGlmICh0aGlzLmNvbmZpZy5wcmVmZXJyZWRNb2R1bGUgPT09ICdwcm9kdWN0aW9uJykge1xuICAgICAgICBzdWNjZXNzID0gYXdhaXQgdGhpcy5sb2FkUHJvZHVjdGlvbk1vZHVsZSgpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzdWNjZXNzID0gYXdhaXQgdGhpcy5sb2FkRmFsbGJhY2tNb2R1bGUoKVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBBdXRvLWZhbGxiYWNrIGlmIGVuYWJsZWQgYW5kIHByZWZlcnJlZCBtb2R1bGUgZmFpbGVkXG4gICAgICBpZiAoIXN1Y2Nlc3MgJiYgdGhpcy5jb25maWcuZW5hYmxlQXV0b0ZhbGxiYWNrKSB7XG4gICAgICAgIHN1Y2Nlc3MgPSBhd2FpdCB0aGlzLmF0dGVtcHRBdXRvRmFsbGJhY2soKVxuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAoIXN1Y2Nlc3MpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gbG9hZCBhbnkgV0FTTSBtb2R1bGUnKVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBJbml0aWFsaXplIHBlcmZvcm1hbmNlIGxheWVyXG4gICAgICBhd2FpdCB0aGlzLnBlcmZvcm1hbmNlTGF5ZXIuaW5pdGlhbGl6ZSgpXG4gICAgICBcbiAgICAgIC8vIFN0YXJ0IHBlcmZvcm1hbmNlIG1vbml0b3JpbmdcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5lbmFibGVQcm9maWxpbmcpIHtcbiAgICAgICAgdGhpcy5zdGFydFBlcmZvcm1hbmNlTW9uaXRvcmluZygpXG4gICAgICB9XG4gICAgICBcbiAgICAgIHRoaXMuaXNJbml0aWFsaXplZCA9IHRydWVcbiAgICAgIHRoaXMubW9kdWxlTWV0cmljcy5sb2FkVGltZSA9IERhdGUubm93KCkgLSB0aGlzLnN0YXJ0VGltZVxuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygn4pyFIFdBU00gTW9kdWxlIE1hbmFnZXIgaW5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5JylcbiAgICAgIGNvbnNvbGUubG9nKGDwn5OKIFN0YXR1czogJHt0aGlzLm1vZHVsZVN0YXR1cy5tb2R1bGV9IGxvYWRlZCBpbiAke3RoaXMubW9kdWxlTWV0cmljcy5sb2FkVGltZX1tc2ApXG4gICAgICBcbiAgICAgIHJldHVybiB0cnVlXG4gICAgICBcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIFdBU00gTW9kdWxlIE1hbmFnZXIgaW5pdGlhbGl6YXRpb24gZmFpbGVkOicsIGVycm9yKVxuICAgICAgdGhpcy5oYW5kbGVFcnJvcihlcnJvci5tZXNzYWdlKVxuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemUgYXZhaWxhYmxlIG1vZHVsZXMgcmVnaXN0cnlcbiAgICovXG4gIHByaXZhdGUgaW5pdGlhbGl6ZUF2YWlsYWJsZU1vZHVsZXMoKTogdm9pZCB7XG4gICAgdGhpcy5hdmFpbGFibGVNb2R1bGVzLnNldCgncnV2LXN3YXJtJywge1xuICAgICAgbmFtZTogJ3J1di1zd2FybScsXG4gICAgICBkZXNjcmlwdGlvbjogJ0hpZ2gtcGVyZm9ybWFuY2UgbmV1cmFsIG5ldHdvcmsgc3dhcm0gb3JjaGVzdHJhdGlvbicsXG4gICAgICB2ZXJzaW9uOiAnMS4wLjE4JyxcbiAgICAgIGNhcGFiaWxpdGllczogWydTSU1EJywgJ25ldXJhbC1uZXR3b3JrcycsICdzd2FybS1vcmNoZXN0cmF0aW9uJywgJ21lbW9yeS1wb29sJ10sXG4gICAgICBtZW1vcnlSZXF1aXJlbWVudDogMTYgKiAxMDI0ICogMTAyNCwgLy8gMTZNQlxuICAgICAgbG9hZFByaW9yaXR5OiAxLFxuICAgICAgYXZhaWxhYmxlOiB0cnVlXG4gICAgfSlcbiAgICBcbiAgICB0aGlzLmF2YWlsYWJsZU1vZHVsZXMuc2V0KCdwcm9kdWN0aW9uJywge1xuICAgICAgbmFtZTogJ3Byb2R1Y3Rpb24nLFxuICAgICAgZGVzY3JpcHRpb246ICdQcm9kdWN0aW9uLXJlYWR5IFdBU00gbmV1cmFsIHJ1bnRpbWUnLFxuICAgICAgdmVyc2lvbjogJzEuMC4wJyxcbiAgICAgIGNhcGFiaWxpdGllczogWydTSU1EJywgJ25ldXJhbC1uZXR3b3JrcycsICdwZXJmb3JtYW5jZS1tb25pdG9yaW5nJ10sXG4gICAgICBtZW1vcnlSZXF1aXJlbWVudDogOCAqIDEwMjQgKiAxMDI0LCAvLyA4TUJcbiAgICAgIGxvYWRQcmlvcml0eTogMixcbiAgICAgIGF2YWlsYWJsZTogdHJ1ZVxuICAgIH0pXG4gICAgXG4gICAgdGhpcy5hdmFpbGFibGVNb2R1bGVzLnNldCgnZmFsbGJhY2snLCB7XG4gICAgICBuYW1lOiAnZmFsbGJhY2snLFxuICAgICAgZGVzY3JpcHRpb246ICdEZXZlbG9wbWVudCBmYWxsYmFjayBXQVNNIGJyaWRnZScsXG4gICAgICB2ZXJzaW9uOiAnMS4wLjAnLFxuICAgICAgY2FwYWJpbGl0aWVzOiBbJ25ldXJhbC1uZXR3b3JrcycsICdiYXNpYy1vcGVyYXRpb25zJ10sXG4gICAgICBtZW1vcnlSZXF1aXJlbWVudDogNCAqIDEwMjQgKiAxMDI0LCAvLyA0TUJcbiAgICAgIGxvYWRQcmlvcml0eTogMyxcbiAgICAgIGF2YWlsYWJsZTogdHJ1ZVxuICAgIH0pXG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZSBtb2R1bGUgc3RhdHVzXG4gICAqL1xuICBwcml2YXRlIGluaXRpYWxpemVNb2R1bGVTdGF0dXMoKTogV2FzbU1vZHVsZVN0YXR1cyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxvYWRlZDogZmFsc2UsXG4gICAgICBtb2R1bGU6ICdub25lJyxcbiAgICAgIHZlcnNpb246ICcwLjAuMCcsXG4gICAgICBjYXBhYmlsaXRpZXM6IFtdLFxuICAgICAgbWVtb3J5VXNhZ2U6IDAsXG4gICAgICBsb2FkVGltZTogMCxcbiAgICAgIGVycm9yQ291bnQ6IDBcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZSBtb2R1bGUgbWV0cmljc1xuICAgKi9cbiAgcHJpdmF0ZSBpbml0aWFsaXplTW9kdWxlTWV0cmljcygpOiBXYXNtTW9kdWxlTWV0cmljcyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxvYWRUaW1lOiAwLFxuICAgICAgbWVtb3J5VXNhZ2U6IDAsXG4gICAgICBvcGVyYXRpb25zUGVyU2Vjb25kOiAwLFxuICAgICAgZXJyb3JSYXRlOiAwLFxuICAgICAgdXB0aW1lOiAwLFxuICAgICAgcGVyZm9ybWFuY2VTY29yZTogMFxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBMb2FkIHJ1di1zd2FybSBXQVNNIG1vZHVsZVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBsb2FkUnV2U3dhcm1Nb2R1bGUoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5SEIExvYWRpbmcgcnV2LXN3YXJtIFdBU00gbW9kdWxlLi4uJylcbiAgICAgIFxuICAgICAgY29uc3QgbW9kdWxlSW5mbyA9IHRoaXMuYXZhaWxhYmxlTW9kdWxlcy5nZXQoJ3J1di1zd2FybScpIVxuICAgICAgXG4gICAgICAvLyBDaGVjayBtZW1vcnkgcmVxdWlyZW1lbnRzXG4gICAgICBpZiAobW9kdWxlSW5mby5tZW1vcnlSZXF1aXJlbWVudCA+IHRoaXMuY29uZmlnLm1lbW9yeUxpbWl0KSB7XG4gICAgICAgIGNvbnNvbGUud2Fybihg4pqg77iPIHJ1di1zd2FybSByZXF1aXJlcyAke21vZHVsZUluZm8ubWVtb3J5UmVxdWlyZW1lbnR9IGJ5dGVzLCBsaW1pdCBpcyAke3RoaXMuY29uZmlnLm1lbW9yeUxpbWl0fWApXG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIExvYWQgd2l0aCB0aW1lb3V0XG4gICAgICBjb25zdCBsb2FkUHJvbWlzZSA9IHRoaXMucGVyZm9ybWFuY2VMYXllci5pbml0aWFsaXplKClcbiAgICAgIGNvbnN0IHRpbWVvdXRQcm9taXNlID0gbmV3IFByb21pc2UoKF8sIHJlamVjdCkgPT4ge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHJlamVjdChuZXcgRXJyb3IoJ0xvYWQgdGltZW91dCcpKSwgdGhpcy5jb25maWcubG9hZFRpbWVvdXQpXG4gICAgICB9KVxuICAgICAgXG4gICAgICBhd2FpdCBQcm9taXNlLnJhY2UoW2xvYWRQcm9taXNlLCB0aW1lb3V0UHJvbWlzZV0pXG4gICAgICBcbiAgICAgIGlmICh0aGlzLnBlcmZvcm1hbmNlTGF5ZXIuaXNVc2luZ1J1dlN3YXJtKCkpIHtcbiAgICAgICAgdGhpcy51cGRhdGVNb2R1bGVTdGF0dXMoJ3J1di1zd2FybScsIG1vZHVsZUluZm8pXG4gICAgICAgIGNvbnNvbGUubG9nKCfinIUgcnV2LXN3YXJtIFdBU00gbW9kdWxlIGxvYWRlZCBzdWNjZXNzZnVsbHknKVxuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gZmFsc2VcbiAgICAgIFxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ+KaoO+4jyBGYWlsZWQgdG8gbG9hZCBydXYtc3dhcm0gV0FTTSBtb2R1bGU6JywgZXJyb3IubWVzc2FnZSlcbiAgICAgIHRoaXMuaGFuZGxlRXJyb3IoZXJyb3IubWVzc2FnZSlcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBMb2FkIHByb2R1Y3Rpb24gV0FTTSBtb2R1bGVcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgbG9hZFByb2R1Y3Rpb25Nb2R1bGUoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5SEIExvYWRpbmcgcHJvZHVjdGlvbiBXQVNNIG1vZHVsZS4uLicpXG4gICAgICBcbiAgICAgIGNvbnN0IG1vZHVsZUluZm8gPSB0aGlzLmF2YWlsYWJsZU1vZHVsZXMuZ2V0KCdwcm9kdWN0aW9uJykhXG4gICAgICBcbiAgICAgIC8vIEluaXRpYWxpemUgcGVyZm9ybWFuY2UgbGF5ZXIgKHdpbGwgdXNlIHByb2R1Y3Rpb24gYnJpZGdlKVxuICAgICAgYXdhaXQgdGhpcy5wZXJmb3JtYW5jZUxheWVyLmluaXRpYWxpemUoKVxuICAgICAgXG4gICAgICBpZiAodGhpcy5wZXJmb3JtYW5jZUxheWVyLmlzV2FzbUluaXRpYWxpemVkKCkpIHtcbiAgICAgICAgdGhpcy51cGRhdGVNb2R1bGVTdGF0dXMoJ3Byb2R1Y3Rpb24nLCBtb2R1bGVJbmZvKVxuICAgICAgICBjb25zb2xlLmxvZygn4pyFIFByb2R1Y3Rpb24gV0FTTSBtb2R1bGUgbG9hZGVkIHN1Y2Nlc3NmdWxseScpXG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiBmYWxzZVxuICAgICAgXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2Fybign4pqg77iPIEZhaWxlZCB0byBsb2FkIHByb2R1Y3Rpb24gV0FTTSBtb2R1bGU6JywgZXJyb3IubWVzc2FnZSlcbiAgICAgIHRoaXMuaGFuZGxlRXJyb3IoZXJyb3IubWVzc2FnZSlcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBMb2FkIGZhbGxiYWNrIFdBU00gbW9kdWxlXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGxvYWRGYWxsYmFja01vZHVsZSgpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coJ/CflIQgTG9hZGluZyBmYWxsYmFjayBXQVNNIG1vZHVsZS4uLicpXG4gICAgICBcbiAgICAgIGNvbnN0IG1vZHVsZUluZm8gPSB0aGlzLmF2YWlsYWJsZU1vZHVsZXMuZ2V0KCdmYWxsYmFjaycpIVxuICAgICAgXG4gICAgICAvLyBJbml0aWFsaXplIHBlcmZvcm1hbmNlIGxheWVyICh3aWxsIHVzZSBmYWxsYmFjayBicmlkZ2UpXG4gICAgICBhd2FpdCB0aGlzLnBlcmZvcm1hbmNlTGF5ZXIuaW5pdGlhbGl6ZSgpXG4gICAgICBcbiAgICAgIGlmICh0aGlzLnBlcmZvcm1hbmNlTGF5ZXIuaXNXYXNtSW5pdGlhbGl6ZWQoKSkge1xuICAgICAgICB0aGlzLnVwZGF0ZU1vZHVsZVN0YXR1cygnZmFsbGJhY2snLCBtb2R1bGVJbmZvKVxuICAgICAgICBjb25zb2xlLmxvZygn4pyFIEZhbGxiYWNrIFdBU00gbW9kdWxlIGxvYWRlZCBzdWNjZXNzZnVsbHknKVxuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gZmFsc2VcbiAgICAgIFxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRmFpbGVkIHRvIGxvYWQgZmFsbGJhY2sgV0FTTSBtb2R1bGU6JywgZXJyb3IubWVzc2FnZSlcbiAgICAgIHRoaXMuaGFuZGxlRXJyb3IoZXJyb3IubWVzc2FnZSlcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBdHRlbXB0IGF1dG9tYXRpYyBmYWxsYmFja1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBhdHRlbXB0QXV0b0ZhbGxiYWNrKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnNvbGUubG9nKCfwn5SEIEF0dGVtcHRpbmcgYXV0b21hdGljIGZhbGxiYWNrLi4uJylcbiAgICBcbiAgICBjb25zdCBmYWxsYmFja09yZGVyID0gWydwcm9kdWN0aW9uJywgJ2ZhbGxiYWNrJ11cbiAgICBcbiAgICBmb3IgKGNvbnN0IG1vZHVsZU5hbWUgb2YgZmFsbGJhY2tPcmRlcikge1xuICAgICAgaWYgKG1vZHVsZU5hbWUgPT09IHRoaXMuY29uZmlnLnByZWZlcnJlZE1vZHVsZSkge1xuICAgICAgICBjb250aW51ZSAvLyBTa2lwIGFscmVhZHkgdHJpZWQgbW9kdWxlXG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKGDwn5SEIFRyeWluZyAke21vZHVsZU5hbWV9IG1vZHVsZS4uLmApXG4gICAgICBcbiAgICAgIGxldCBzdWNjZXNzID0gZmFsc2VcbiAgICAgIFxuICAgICAgaWYgKG1vZHVsZU5hbWUgPT09ICdwcm9kdWN0aW9uJykge1xuICAgICAgICBzdWNjZXNzID0gYXdhaXQgdGhpcy5sb2FkUHJvZHVjdGlvbk1vZHVsZSgpXG4gICAgICB9IGVsc2UgaWYgKG1vZHVsZU5hbWUgPT09ICdmYWxsYmFjaycpIHtcbiAgICAgICAgc3VjY2VzcyA9IGF3YWl0IHRoaXMubG9hZEZhbGxiYWNrTW9kdWxlKClcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgY29uc29sZS5sb2coYOKchSBBdXRvLWZhbGxiYWNrIHN1Y2Nlc3NmdWw6ICR7bW9kdWxlTmFtZX1gKVxuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBjb25zb2xlLmVycm9yKCfinYwgQXV0by1mYWxsYmFjayBmYWlsZWQ6IG5vIG1vZHVsZXMgYXZhaWxhYmxlJylcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgbW9kdWxlIHN0YXR1c1xuICAgKi9cbiAgcHJpdmF0ZSB1cGRhdGVNb2R1bGVTdGF0dXMobW9kdWxlTmFtZTogc3RyaW5nLCBtb2R1bGVJbmZvOiBXYXNtTW9kdWxlSW5mbyk6IHZvaWQge1xuICAgIHRoaXMubW9kdWxlU3RhdHVzLmxvYWRlZCA9IHRydWVcbiAgICB0aGlzLm1vZHVsZVN0YXR1cy5tb2R1bGUgPSBtb2R1bGVOYW1lXG4gICAgdGhpcy5tb2R1bGVTdGF0dXMudmVyc2lvbiA9IG1vZHVsZUluZm8udmVyc2lvblxuICAgIHRoaXMubW9kdWxlU3RhdHVzLmNhcGFiaWxpdGllcyA9IFsuLi5tb2R1bGVJbmZvLmNhcGFiaWxpdGllc11cbiAgICB0aGlzLm1vZHVsZVN0YXR1cy5tZW1vcnlVc2FnZSA9IHRoaXMucGVyZm9ybWFuY2VMYXllci5nZXRNZW1vcnlVc2FnZSgpXG4gICAgdGhpcy5tb2R1bGVTdGF0dXMubG9hZFRpbWUgPSBEYXRlLm5vdygpIC0gdGhpcy5zdGFydFRpbWVcbiAgfVxuXG4gIC8qKlxuICAgKiBTdGFydCBwZXJmb3JtYW5jZSBtb25pdG9yaW5nXG4gICAqL1xuICBwcml2YXRlIHN0YXJ0UGVyZm9ybWFuY2VNb25pdG9yaW5nKCk6IHZvaWQge1xuICAgIGNvbnN0IG1vbml0b3JpbmdJbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgIHRoaXMudXBkYXRlTWV0cmljcygpXG4gICAgICB0aGlzLnBlcmZvcm1hbmNlSGlzdG9yeS5wdXNoKHRoaXMubW9kdWxlTWV0cmljcy5wZXJmb3JtYW5jZVNjb3JlKVxuICAgICAgXG4gICAgICAvLyBLZWVwIG9ubHkgbGFzdCAxMDAgbWVhc3VyZW1lbnRzXG4gICAgICBpZiAodGhpcy5wZXJmb3JtYW5jZUhpc3RvcnkubGVuZ3RoID4gMTAwKSB7XG4gICAgICAgIHRoaXMucGVyZm9ybWFuY2VIaXN0b3J5LnNoaWZ0KClcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQ2hlY2sgZm9yIHBlcmZvcm1hbmNlIGRlZ3JhZGF0aW9uXG4gICAgICBpZiAodGhpcy5wZXJmb3JtYW5jZUhpc3RvcnkubGVuZ3RoID4gMTApIHtcbiAgICAgICAgY29uc3QgcmVjZW50ID0gdGhpcy5wZXJmb3JtYW5jZUhpc3Rvcnkuc2xpY2UoLTEwKVxuICAgICAgICBjb25zdCBvbGRlciA9IHRoaXMucGVyZm9ybWFuY2VIaXN0b3J5LnNsaWNlKC0yMCwgLTEwKVxuICAgICAgICBcbiAgICAgICAgaWYgKG9sZGVyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBjb25zdCByZWNlbnRBdmcgPSByZWNlbnQucmVkdWNlKChhLCBiKSA9PiBhICsgYiwgMCkgLyByZWNlbnQubGVuZ3RoXG4gICAgICAgICAgY29uc3Qgb2xkZXJBdmcgPSBvbGRlci5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKSAvIG9sZGVyLmxlbmd0aFxuICAgICAgICAgIFxuICAgICAgICAgIGlmIChyZWNlbnRBdmcgPCBvbGRlckF2ZyAqIDAuOCkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCfimqDvuI8gUGVyZm9ybWFuY2UgZGVncmFkYXRpb24gZGV0ZWN0ZWQnKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgfSwgNTAwMCkgLy8gVXBkYXRlIGV2ZXJ5IDUgc2Vjb25kc1xuICAgIFxuICAgIC8vIFN0b3JlIGludGVydmFsIElEIGZvciBjbGVhbnVwXG4gICAgdGhpcy5tb25pdG9yaW5nSW50ZXJ2YWxJZCA9IG1vbml0b3JpbmdJbnRlcnZhbFxuICB9XG4gIFxuICBwcml2YXRlIG1vbml0b3JpbmdJbnRlcnZhbElkOiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsXG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBwZXJmb3JtYW5jZSBtZXRyaWNzXG4gICAqL1xuICBwcml2YXRlIHVwZGF0ZU1ldHJpY3MoKTogdm9pZCB7XG4gICAgY29uc3QgcGVyZm9ybWFuY2VNZXRyaWNzID0gdGhpcy5wZXJmb3JtYW5jZUxheWVyLmdldFBlcmZvcm1hbmNlTWV0cmljcygpXG4gICAgY29uc3Qgc2ltZE1ldHJpY3MgPSB0aGlzLnNpbWRMYXllci5nZXRQZXJmb3JtYW5jZU1ldHJpY3MoKVxuICAgIFxuICAgIHRoaXMubW9kdWxlTWV0cmljcy5tZW1vcnlVc2FnZSA9IHBlcmZvcm1hbmNlTWV0cmljcy5tZW1vcnlVc2FnZVxuICAgIHRoaXMubW9kdWxlTWV0cmljcy5vcGVyYXRpb25zUGVyU2Vjb25kID0gcGVyZm9ybWFuY2VNZXRyaWNzLm9wZXJhdGlvbnNQZXJTZWNvbmRcbiAgICB0aGlzLm1vZHVsZU1ldHJpY3MuZXJyb3JSYXRlID0gcGVyZm9ybWFuY2VNZXRyaWNzLmVycm9yUmF0ZSB8fCAwXG4gICAgdGhpcy5tb2R1bGVNZXRyaWNzLnVwdGltZSA9IERhdGUubm93KCkgLSB0aGlzLnN0YXJ0VGltZVxuICAgIFxuICAgIC8vIENhbGN1bGF0ZSBwZXJmb3JtYW5jZSBzY29yZSAoMC0xMDApXG4gICAgY29uc3QgbWVtb3J5U2NvcmUgPSBNYXRoLm1heCgwLCAxMDAgLSAodGhpcy5tb2R1bGVNZXRyaWNzLm1lbW9yeVVzYWdlIC8gdGhpcy5jb25maWcubWVtb3J5TGltaXQpICogMTAwKVxuICAgIGNvbnN0IHBlcmZvcm1hbmNlU2NvcmUgPSBNYXRoLm1pbigxMDAsIHRoaXMubW9kdWxlTWV0cmljcy5vcGVyYXRpb25zUGVyU2Vjb25kIC8gMTAwMClcbiAgICBjb25zdCBlcnJvclNjb3JlID0gTWF0aC5tYXgoMCwgMTAwIC0gdGhpcy5tb2R1bGVNZXRyaWNzLmVycm9yUmF0ZSAqIDEwMClcbiAgICBjb25zdCBzaW1kU2NvcmUgPSBzaW1kTWV0cmljcy5zaW1kVXRpbGl6YXRpb24gKiAxMDBcbiAgICBcbiAgICB0aGlzLm1vZHVsZU1ldHJpY3MucGVyZm9ybWFuY2VTY29yZSA9IChtZW1vcnlTY29yZSArIHBlcmZvcm1hbmNlU2NvcmUgKyBlcnJvclNjb3JlICsgc2ltZFNjb3JlKSAvIDRcbiAgICBcbiAgICAvLyBVcGRhdGUgbW9kdWxlIHN0YXR1c1xuICAgIHRoaXMubW9kdWxlU3RhdHVzLm1lbW9yeVVzYWdlID0gdGhpcy5tb2R1bGVNZXRyaWNzLm1lbW9yeVVzYWdlXG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIGVycm9yc1xuICAgKi9cbiAgcHJpdmF0ZSBoYW5kbGVFcnJvcihlcnJvck1lc3NhZ2U6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMubW9kdWxlU3RhdHVzLmVycm9yQ291bnQrK1xuICAgIHRoaXMubW9kdWxlU3RhdHVzLmxhc3RFcnJvciA9IGVycm9yTWVzc2FnZVxuICAgIFxuICAgIHRoaXMuZXJyb3JIaXN0b3J5LnB1c2goZXJyb3JNZXNzYWdlKVxuICAgIFxuICAgIC8vIEtlZXAgb25seSBsYXN0IDUwIGVycm9yc1xuICAgIGlmICh0aGlzLmVycm9ySGlzdG9yeS5sZW5ndGggPiA1MCkge1xuICAgICAgdGhpcy5lcnJvckhpc3Rvcnkuc2hpZnQoKVxuICAgIH1cbiAgICBcbiAgICAvLyBVcGRhdGUgZXJyb3IgcmF0ZVxuICAgIHRoaXMubW9kdWxlTWV0cmljcy5lcnJvclJhdGUgPSB0aGlzLm1vZHVsZVN0YXR1cy5lcnJvckNvdW50IC8gTWF0aC5tYXgoMSwgdGhpcy5tb2R1bGVNZXRyaWNzLnVwdGltZSAvIDEwMDApXG4gIH1cblxuICAvKipcbiAgICogR2V0IG1vZHVsZSBzdGF0dXNcbiAgICovXG4gIGdldE1vZHVsZVN0YXR1cygpOiBXYXNtTW9kdWxlU3RhdHVzIHtcbiAgICByZXR1cm4geyAuLi50aGlzLm1vZHVsZVN0YXR1cyB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IG1vZHVsZSBtZXRyaWNzXG4gICAqL1xuICBnZXRNb2R1bGVNZXRyaWNzKCk6IFdhc21Nb2R1bGVNZXRyaWNzIHtcbiAgICB0aGlzLnVwZGF0ZU1ldHJpY3MoKVxuICAgIHJldHVybiB7IC4uLnRoaXMubW9kdWxlTWV0cmljcyB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IGF2YWlsYWJsZSBtb2R1bGVzXG4gICAqL1xuICBnZXRBdmFpbGFibGVNb2R1bGVzKCk6IFdhc21Nb2R1bGVJbmZvW10ge1xuICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuYXZhaWxhYmxlTW9kdWxlcy52YWx1ZXMoKSlcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgcGVyZm9ybWFuY2UgbGF5ZXJcbiAgICovXG4gIGdldFBlcmZvcm1hbmNlTGF5ZXIoKTogV2FzbVBlcmZvcm1hbmNlTGF5ZXIge1xuICAgIHJldHVybiB0aGlzLnBlcmZvcm1hbmNlTGF5ZXJcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgU0lNRCBsYXllclxuICAgKi9cbiAgZ2V0U0lNRExheWVyKCk6IFNJTURBY2NlbGVyYXRpb25MYXllciB7XG4gICAgcmV0dXJuIHRoaXMuc2ltZExheWVyXG4gIH1cblxuICAvKipcbiAgICogU3dpdGNoIHRvIGRpZmZlcmVudCBtb2R1bGVcbiAgICovXG4gIGFzeW5jIHN3aXRjaE1vZHVsZShtb2R1bGVOYW1lOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBpZiAoIXRoaXMuYXZhaWxhYmxlTW9kdWxlcy5oYXMobW9kdWxlTmFtZSkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBNb2R1bGUgJHttb2R1bGVOYW1lfSBub3QgYXZhaWxhYmxlYClcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgICBcbiAgICBpZiAodGhpcy5tb2R1bGVTdGF0dXMubW9kdWxlID09PSBtb2R1bGVOYW1lKSB7XG4gICAgICBjb25zb2xlLmxvZyhg4oS577iPIEFscmVhZHkgdXNpbmcgJHttb2R1bGVOYW1lfSBtb2R1bGVgKVxuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG4gICAgXG4gICAgY29uc29sZS5sb2coYPCflIQgU3dpdGNoaW5nIHRvICR7bW9kdWxlTmFtZX0gbW9kdWxlLi4uYClcbiAgICBcbiAgICAvLyBDbGVhbnVwIGN1cnJlbnQgbW9kdWxlXG4gICAgYXdhaXQgdGhpcy5jbGVhbnVwKClcbiAgICBcbiAgICAvLyBMb2FkIG5ldyBtb2R1bGVcbiAgICBsZXQgc3VjY2VzcyA9IGZhbHNlXG4gICAgXG4gICAgaWYgKG1vZHVsZU5hbWUgPT09ICdydXYtc3dhcm0nKSB7XG4gICAgICBzdWNjZXNzID0gYXdhaXQgdGhpcy5sb2FkUnV2U3dhcm1Nb2R1bGUoKVxuICAgIH0gZWxzZSBpZiAobW9kdWxlTmFtZSA9PT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgICBzdWNjZXNzID0gYXdhaXQgdGhpcy5sb2FkUHJvZHVjdGlvbk1vZHVsZSgpXG4gICAgfSBlbHNlIGlmIChtb2R1bGVOYW1lID09PSAnZmFsbGJhY2snKSB7XG4gICAgICBzdWNjZXNzID0gYXdhaXQgdGhpcy5sb2FkRmFsbGJhY2tNb2R1bGUoKVxuICAgIH1cbiAgICBcbiAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgY29uc29sZS5sb2coYOKchSBTdWNjZXNzZnVsbHkgc3dpdGNoZWQgdG8gJHttb2R1bGVOYW1lfSBtb2R1bGVgKVxuICAgICAgXG4gICAgICAvLyBSZXN0YXJ0IHBlcmZvcm1hbmNlIG1vbml0b3JpbmdcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5lbmFibGVQcm9maWxpbmcpIHtcbiAgICAgICAgdGhpcy5zdGFydFBlcmZvcm1hbmNlTW9uaXRvcmluZygpXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBzdWNjZXNzXG4gIH1cblxuICAvKipcbiAgICogUnVuIGhlYWx0aCBjaGVja1xuICAgKi9cbiAgaGVhbHRoQ2hlY2soKToge1xuICAgIHN0YXR1czogJ2hlYWx0aHknIHwgJ3dhcm5pbmcnIHwgJ2Vycm9yJ1xuICAgIG1vZHVsZTogV2FzbU1vZHVsZVN0YXR1c1xuICAgIG1ldHJpY3M6IFdhc21Nb2R1bGVNZXRyaWNzXG4gICAgaXNzdWVzOiBzdHJpbmdbXVxuICB9IHtcbiAgICBjb25zdCBpc3N1ZXM6IHN0cmluZ1tdID0gW11cbiAgICBsZXQgc3RhdHVzOiAnaGVhbHRoeScgfCAnd2FybmluZycgfCAnZXJyb3InID0gJ2hlYWx0aHknXG4gICAgXG4gICAgaWYgKCF0aGlzLmlzSW5pdGlhbGl6ZWQpIHtcbiAgICAgIGlzc3Vlcy5wdXNoKCdXQVNNIE1vZHVsZSBNYW5hZ2VyIG5vdCBpbml0aWFsaXplZCcpXG4gICAgICBzdGF0dXMgPSAnZXJyb3InXG4gICAgfVxuICAgIFxuICAgIGlmICghdGhpcy5tb2R1bGVTdGF0dXMubG9hZGVkKSB7XG4gICAgICBpc3N1ZXMucHVzaCgnTm8gV0FTTSBtb2R1bGUgbG9hZGVkJylcbiAgICAgIHN0YXR1cyA9ICdlcnJvcidcbiAgICB9XG4gICAgXG4gICAgaWYgKHRoaXMubW9kdWxlTWV0cmljcy5tZW1vcnlVc2FnZSA+IHRoaXMuY29uZmlnLm1lbW9yeUxpbWl0ICogMC45KSB7XG4gICAgICBpc3N1ZXMucHVzaChgTWVtb3J5IHVzYWdlICR7KHRoaXMubW9kdWxlTWV0cmljcy5tZW1vcnlVc2FnZSAvIDEwMjQgLyAxMDI0KS50b0ZpeGVkKDIpfU1CIG5lYXIgbGltaXRgKVxuICAgICAgc3RhdHVzID0gJ3dhcm5pbmcnXG4gICAgfVxuICAgIFxuICAgIGlmICh0aGlzLm1vZHVsZU1ldHJpY3MuZXJyb3JSYXRlID4gMC4xKSB7XG4gICAgICBpc3N1ZXMucHVzaChgRXJyb3IgcmF0ZSAkeyh0aGlzLm1vZHVsZU1ldHJpY3MuZXJyb3JSYXRlICogMTAwKS50b0ZpeGVkKDEpfSUgdG9vIGhpZ2hgKVxuICAgICAgc3RhdHVzID0gJ3dhcm5pbmcnXG4gICAgfVxuICAgIFxuICAgIGlmICh0aGlzLm1vZHVsZU1ldHJpY3MucGVyZm9ybWFuY2VTY29yZSA8IDUwKSB7XG4gICAgICBpc3N1ZXMucHVzaChgUGVyZm9ybWFuY2Ugc2NvcmUgJHt0aGlzLm1vZHVsZU1ldHJpY3MucGVyZm9ybWFuY2VTY29yZS50b0ZpeGVkKDEpfSBiZWxvdyB0aHJlc2hvbGRgKVxuICAgICAgc3RhdHVzID0gJ3dhcm5pbmcnXG4gICAgfVxuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBzdGF0dXMsXG4gICAgICBtb2R1bGU6IHRoaXMuZ2V0TW9kdWxlU3RhdHVzKCksXG4gICAgICBtZXRyaWNzOiB0aGlzLmdldE1vZHVsZU1ldHJpY3MoKSxcbiAgICAgIGlzc3Vlc1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgcGVyZm9ybWFuY2UgcmVwb3J0XG4gICAqL1xuICBnZXRQZXJmb3JtYW5jZVJlcG9ydCgpOiBzdHJpbmcge1xuICAgIGNvbnN0IHN0YXR1cyA9IHRoaXMuZ2V0TW9kdWxlU3RhdHVzKClcbiAgICBjb25zdCBtZXRyaWNzID0gdGhpcy5nZXRNb2R1bGVNZXRyaWNzKClcbiAgICBjb25zdCBzaW1kTWV0cmljcyA9IHRoaXMuc2ltZExheWVyLmdldFBlcmZvcm1hbmNlTWV0cmljcygpXG4gICAgXG4gICAgcmV0dXJuIGBXQVNNIE1vZHVsZSBNYW5hZ2VyIFBlcmZvcm1hbmNlIFJlcG9ydDpcblxu8J+TiiBNb2R1bGUgU3RhdHVzOlxuICAgLSBBY3RpdmUgTW9kdWxlOiAke3N0YXR1cy5tb2R1bGV9IHYke3N0YXR1cy52ZXJzaW9ufVxuICAgLSBMb2FkIFRpbWU6ICR7c3RhdHVzLmxvYWRUaW1lfW1zXG4gICAtIE1lbW9yeSBVc2FnZTogJHsoc3RhdHVzLm1lbW9yeVVzYWdlIC8gMTAyNCAvIDEwMjQpLnRvRml4ZWQoMil9TUJcbiAgIC0gQ2FwYWJpbGl0aWVzOiAke3N0YXR1cy5jYXBhYmlsaXRpZXMuam9pbignLCAnKX1cbiAgIC0gRXJyb3IgQ291bnQ6ICR7c3RhdHVzLmVycm9yQ291bnR9XG5cbuKaoSBQZXJmb3JtYW5jZSBNZXRyaWNzOlxuICAgLSBPcGVyYXRpb25zL3NlYzogJHttZXRyaWNzLm9wZXJhdGlvbnNQZXJTZWNvbmQudG9GaXhlZCgwKX1cbiAgIC0gUGVyZm9ybWFuY2UgU2NvcmU6ICR7bWV0cmljcy5wZXJmb3JtYW5jZVNjb3JlLnRvRml4ZWQoMSl9LzEwMFxuICAgLSBFcnJvciBSYXRlOiAkeyhtZXRyaWNzLmVycm9yUmF0ZSAqIDEwMCkudG9GaXhlZCgyKX0lXG4gICAtIFVwdGltZTogJHsobWV0cmljcy51cHRpbWUgLyAxMDAwKS50b0ZpeGVkKDApfXNcblxu8J+UpyBTSU1EIFBlcmZvcm1hbmNlOlxuICAgLSBTSU1EIFN1cHBvcnQ6ICR7dGhpcy5zaW1kTGF5ZXIuaXNTSU1EU3VwcG9ydGVkKCkgPyAn4pyFJyA6ICfinYwnfVxuICAgLSBPcGVyYXRpb25zL3NlYzogJHtzaW1kTWV0cmljcy5vcGVyYXRpb25zUGVyU2Vjb25kLnRvRml4ZWQoMCl9XG4gICAtIFZlY3Rvcml6YXRpb246ICR7KHNpbWRNZXRyaWNzLnZlY3Rvcml6YXRpb25FZmZpY2llbmN5ICogMTAwKS50b0ZpeGVkKDEpfSVcbiAgIC0gVXRpbGl6YXRpb246ICR7KHNpbWRNZXRyaWNzLnNpbWRVdGlsaXphdGlvbiAqIDEwMCkudG9GaXhlZCgxKX0lXG5cbvCfkqEgUmVjZW50IFBlcmZvcm1hbmNlOiAke3RoaXMucGVyZm9ybWFuY2VIaXN0b3J5LnNsaWNlKC01KS5tYXAocyA9PiBzLnRvRml4ZWQoMSkpLmpvaW4oJywgJyl9XG5gXG4gIH1cblxuICAvKipcbiAgICogRXhwb3J0IGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIGV4cG9ydENvbmZpZygpOiBXYXNtTW9kdWxlQ29uZmlnIHtcbiAgICByZXR1cm4geyAuLi50aGlzLmNvbmZpZyB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIHVwZGF0ZUNvbmZpZyhuZXdDb25maWc6IFBhcnRpYWw8V2FzbU1vZHVsZUNvbmZpZz4pOiB2b2lkIHtcbiAgICB0aGlzLmNvbmZpZyA9IHsgLi4udGhpcy5jb25maWcsIC4uLm5ld0NvbmZpZyB9XG4gICAgY29uc29sZS5sb2coJ+Kame+4jyBDb25maWd1cmF0aW9uIHVwZGF0ZWQ6JywgdGhpcy5jb25maWcpXG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgaW5pdGlhbGl6ZWRcbiAgICovXG4gIGlzTW9kdWxlTWFuYWdlckluaXRpYWxpemVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmlzSW5pdGlhbGl6ZWRcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhbnVwIHJlc291cmNlc1xuICAgKi9cbiAgYXN5bmMgY2xlYW51cCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zb2xlLmxvZygn8J+nuSBDbGVhbmluZyB1cCBXQVNNIE1vZHVsZSBNYW5hZ2VyLi4uJylcbiAgICBcbiAgICAvLyBTdG9wIHBlcmZvcm1hbmNlIG1vbml0b3JpbmdcbiAgICBpZiAodGhpcy5tb25pdG9yaW5nSW50ZXJ2YWxJZCkge1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLm1vbml0b3JpbmdJbnRlcnZhbElkKVxuICAgICAgdGhpcy5tb25pdG9yaW5nSW50ZXJ2YWxJZCA9IG51bGxcbiAgICB9XG4gICAgXG4gICAgLy8gQ2xlYW51cCBwZXJmb3JtYW5jZSBsYXllclxuICAgIGlmICh0aGlzLnBlcmZvcm1hbmNlTGF5ZXIpIHtcbiAgICAgIHRoaXMucGVyZm9ybWFuY2VMYXllci5jbGVhbnVwKClcbiAgICB9XG4gICAgXG4gICAgLy8gQ2xlYW51cCBTSU1EIGxheWVyXG4gICAgaWYgKHRoaXMuc2ltZExheWVyKSB7XG4gICAgICB0aGlzLnNpbWRMYXllci5jbGVhbnVwKClcbiAgICB9XG4gICAgXG4gICAgLy8gUmVzZXQgc3RhdHVzIGFuZCBtZXRyaWNzXG4gICAgdGhpcy5tb2R1bGVTdGF0dXMgPSB0aGlzLmluaXRpYWxpemVNb2R1bGVTdGF0dXMoKVxuICAgIHRoaXMubW9kdWxlTWV0cmljcyA9IHRoaXMuaW5pdGlhbGl6ZU1vZHVsZU1ldHJpY3MoKVxuICAgIHRoaXMucGVyZm9ybWFuY2VIaXN0b3J5ID0gW11cbiAgICB0aGlzLmVycm9ySGlzdG9yeSA9IFtdXG4gICAgdGhpcy5pc0luaXRpYWxpemVkID0gZmFsc2VcbiAgICBcbiAgICBjb25zb2xlLmxvZygn4pyFIFdBU00gTW9kdWxlIE1hbmFnZXIgY2xlYW51cCBjb21wbGV0ZWQnKVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFdhc21Nb2R1bGVNYW5hZ2VyIl0sInZlcnNpb24iOjN9