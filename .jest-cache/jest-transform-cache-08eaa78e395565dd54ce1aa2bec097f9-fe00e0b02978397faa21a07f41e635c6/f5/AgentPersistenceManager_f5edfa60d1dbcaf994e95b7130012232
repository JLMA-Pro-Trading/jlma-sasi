1c9f727b7e45a3c0b9b7e1b1bc880530
"use strict";
/**
 * AgentPersistenceManager - SQLite Database Layer for Phase 2A
 * Implements TDD-driven database operations with performance monitoring
 *
 * Performance Requirements:
 * - Agent spawn: <75ms
 * - Database operations: <50ms
 * - Memory usage: <50MB per agent
 * - Test coverage: >95%
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.AgentPersistenceManager = void 0;
const better_sqlite3_1 = __importDefault(require("better-sqlite3"));
const path = __importStar(require("path"));
const fs = __importStar(require("fs"));
const perf_hooks_1 = require("perf_hooks");
const SecurityValidator_1 = require("../security/SecurityValidator");
class AgentPersistenceManager {
    constructor(dbPath = './.swarm/agents.db') {
        Object.defineProperty(this, "db", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: null
        });
        Object.defineProperty(this, "dbPath", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        Object.defineProperty(this, "config", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        Object.defineProperty(this, "isInitialized", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: false
        });
        Object.defineProperty(this, "writeQueue", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: []
        });
        Object.defineProperty(this, "isProcessingQueue", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: false
        });
        Object.defineProperty(this, "securityValidator", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        this.dbPath = path.resolve(dbPath);
        this.securityValidator = new SecurityValidator_1.SecurityValidator({
            enableInputValidation: true,
            enableAuditLogging: true,
            maxInputSize: 1024 * 1024 // 1MB
        });
        this.config = {
            path: this.dbPath,
            timeout: 30000,
            maxConnections: 5,
            busyTimeout: 5000,
            cacheSize: 64000, // 64MB cache
            mmapSize: 268435456, // 256MB mmap
            walMode: true,
            synchronous: 'NORMAL'
        };
    }
    /**
     * Initialize SQLite database with Phase 2A schema and performance optimizations
     */
    async initialize() {
        try {
            // Ensure directory exists
            const dbDir = path.dirname(this.dbPath);
            if (!fs.existsSync(dbDir)) {
                fs.mkdirSync(dbDir, { recursive: true });
            }
            // Initialize database connection
            this.db = new better_sqlite3_1.default(this.dbPath, {
                timeout: this.config.timeout,
                verbose: process.env.NODE_ENV === 'development' ? console.log : undefined
            });
            // Configure SQLite for performance
            await this.configureSQLitePerformance();
            // Create schema
            await this.createSchema();
            // Create indexes for performance
            await this.createIndexes();
            this.isInitialized = true;
            console.log('✅ AgentPersistenceManager initialized successfully');
        }
        catch (error) {
            console.error('❌ Failed to initialize AgentPersistenceManager:', error);
            throw new Error(`Database initialization failed: ${error.message}`);
        }
    }
    /**
     * Configure SQLite for optimal performance
     */
    async configureSQLitePerformance() {
        if (!this.db)
            throw new Error('Database not initialized');
        // Enable WAL mode for concurrent reads
        this.db.pragma('journal_mode = WAL');
        // Set synchronous mode for balanced performance/safety
        this.db.pragma(`synchronous = ${this.config.synchronous}`);
        // Configure cache size
        this.db.pragma(`cache_size = -${this.config.cacheSize / 1024}`); // Negative = KB
        // Use memory for temporary storage
        this.db.pragma('temp_store = MEMORY');
        // Configure memory mapping
        this.db.pragma(`mmap_size = ${this.config.mmapSize}`);
        // Set busy timeout
        this.db.pragma(`busy_timeout = ${this.config.busyTimeout}`);
        // Enable foreign key constraints
        this.db.pragma('foreign_keys = ON');
        console.log('🔧 SQLite performance configuration applied');
    }
    /**
     * Create database schema for Phase 2A
     */
    async createSchema() {
        if (!this.db)
            throw new Error('Database not initialized');
        const schemas = [
            // Agent Lifecycle Management
            `CREATE TABLE IF NOT EXISTS agents (
        id TEXT PRIMARY KEY,
        type TEXT NOT NULL,
        status TEXT NOT NULL DEFAULT 'spawning',
        cognitive_pattern TEXT NOT NULL,
        network_layers TEXT NOT NULL,
        learning_rate REAL DEFAULT 0.01,
        momentum REAL DEFAULT 0.0,
        created_at INTEGER NOT NULL,
        last_active INTEGER NOT NULL,
        memory_usage_mb REAL DEFAULT 0,
        performance_score REAL DEFAULT 0,
        spawn_time_ms INTEGER DEFAULT NULL,
        config_json TEXT DEFAULT '{}',
        metadata_json TEXT DEFAULT '{}'
      )`,
            // Neural Network State Persistence
            `CREATE TABLE IF NOT EXISTS neural_weights (
        agent_id TEXT NOT NULL,
        layer_index INTEGER NOT NULL,
        weight_data BLOB NOT NULL,
        bias_data BLOB NOT NULL,
        updated_at INTEGER NOT NULL,
        checksum TEXT NOT NULL,
        compression_type TEXT DEFAULT 'gzip',
        PRIMARY KEY (agent_id, layer_index),
        FOREIGN KEY (agent_id) REFERENCES agents(id) ON DELETE CASCADE
      )`,
            // Agent Memory and Knowledge Base
            `CREATE TABLE IF NOT EXISTS agent_memory (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        agent_id TEXT NOT NULL,
        memory_type TEXT NOT NULL,
        key TEXT NOT NULL,
        value_data BLOB NOT NULL,
        importance_score REAL DEFAULT 0.5,
        access_count INTEGER DEFAULT 0,
        created_at INTEGER NOT NULL,
        last_accessed INTEGER NOT NULL,
        ttl_expires INTEGER DEFAULT NULL,
        FOREIGN KEY (agent_id) REFERENCES agents(id) ON DELETE CASCADE
      )`,
            // Performance Metrics and Monitoring
            `CREATE TABLE IF NOT EXISTS agent_metrics (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        agent_id TEXT NOT NULL,
        metric_type TEXT NOT NULL,
        value REAL NOT NULL,
        unit TEXT NOT NULL,
        recorded_at INTEGER NOT NULL,
        context_json TEXT DEFAULT '{}',
        FOREIGN KEY (agent_id) REFERENCES agents(id) ON DELETE CASCADE
      )`,
            // Cross-Session State Management
            `CREATE TABLE IF NOT EXISTS session_state (
        id TEXT PRIMARY KEY,
        swarm_topology TEXT NOT NULL,
        active_agents TEXT NOT NULL,
        coordination_state BLOB NOT NULL,
        created_at INTEGER NOT NULL,
        last_checkpoint INTEGER NOT NULL,
        is_active BOOLEAN DEFAULT TRUE
      )`
        ];
        for (const schema of schemas) {
            this.db.exec(schema);
        }
        console.log('📋 Database schema created successfully');
    }
    /**
     * Create indexes for Phase 2A performance requirements
     */
    async createIndexes() {
        if (!this.db)
            throw new Error('Database not initialized');
        const indexes = [
            'CREATE INDEX IF NOT EXISTS idx_agents_status ON agents(status, last_active)',
            'CREATE INDEX IF NOT EXISTS idx_agents_type ON agents(type, status)',
            'CREATE INDEX IF NOT EXISTS idx_neural_weights_agent ON neural_weights(agent_id)',
            'CREATE INDEX IF NOT EXISTS idx_agent_memory_type ON agent_memory(agent_id, memory_type)',
            'CREATE INDEX IF NOT EXISTS idx_agent_memory_importance ON agent_memory(importance_score DESC, last_accessed DESC)',
            'CREATE INDEX IF NOT EXISTS idx_metrics_agent_type ON agent_metrics(agent_id, metric_type, recorded_at)',
            'CREATE INDEX IF NOT EXISTS idx_session_active ON session_state(is_active, last_checkpoint)'
        ];
        for (const index of indexes) {
            this.db.exec(index);
        }
        console.log('🔍 Database indexes created successfully');
    }
    /**
     * Save agent configuration to database
     * Performance target: <50ms
     */
    async saveAgent(config) {
        if (!this.isInitialized || !this.db) {
            throw new Error('Database not initialized');
        }
        const startTime = perf_hooks_1.performance.now();
        try {
            const stmt = this.db.prepare(`
        INSERT INTO agents (
          id, type, status, cognitive_pattern, network_layers, learning_rate, momentum,
          created_at, last_active, memory_usage_mb, performance_score, spawn_time_ms,
          config_json, metadata_json
        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
      `);
            const result = stmt.run(config.id, config.type, config.status, config.cognitivePattern, JSON.stringify(config.networkLayers), config.learningRate || 0.01, config.momentum || 0.0, config.createdAt, config.lastActive, config.memoryUsageMB || 0, config.performanceScore || 0, config.spawnTimeMs, config.configJson || '{}', config.metadataJson || '{}');
            const saveTime = perf_hooks_1.performance.now() - startTime;
            // Log performance warning if exceeding threshold
            if (saveTime > 50) {
                console.warn(`⚠️ Agent save time exceeded threshold: ${saveTime.toFixed(2)}ms`);
            }
            return config;
        }
        catch (error) {
            const saveTime = perf_hooks_1.performance.now() - startTime;
            console.error(`❌ Failed to save agent ${config.id} (${saveTime.toFixed(2)}ms):`, error.message);
            throw error;
        }
    }
    /**
     * Retrieve agent by ID
     * Performance target: <50ms
     */
    async getAgent(id) {
        if (!this.isInitialized || !this.db) {
            throw new Error('Database not initialized');
        }
        // Security validation
        const validation = this.securityValidator.validateSQLParameters('SELECT * FROM agents WHERE id = ?', [id]);
        if (!validation.isValid) {
            throw new Error(`Security validation failed: ${validation.errors.join(', ')}`);
        }
        const startTime = perf_hooks_1.performance.now();
        try {
            const stmt = this.db.prepare(`
        SELECT * FROM agents WHERE id = ?
      `);
            const row = stmt.get(validation.sanitizedInput[0]);
            const retrieveTime = perf_hooks_1.performance.now() - startTime;
            // Log performance warning if exceeding threshold
            if (retrieveTime > 50) {
                console.warn(`⚠️ Agent retrieval time exceeded threshold: ${retrieveTime.toFixed(2)}ms`);
            }
            if (!row)
                return null;
            return {
                id: row.id,
                type: row.type,
                cognitivePattern: row.cognitive_pattern,
                networkLayers: JSON.parse(row.network_layers),
                learningRate: row.learning_rate,
                momentum: row.momentum,
                status: row.status,
                createdAt: row.created_at,
                lastActive: row.last_active,
                memoryUsageMB: row.memory_usage_mb,
                performanceScore: row.performance_score,
                spawnTimeMs: row.spawn_time_ms,
                configJson: row.config_json,
                metadataJson: row.metadata_json
            };
        }
        catch (error) {
            const retrieveTime = perf_hooks_1.performance.now() - startTime;
            console.error(`❌ Failed to retrieve agent ${id} (${retrieveTime.toFixed(2)}ms):`, error.message);
            throw error;
        }
    }
    /**
     * Update agent status atomically
     * Performance target: <50ms
     */
    async updateAgentStatus(id, status) {
        if (!this.isInitialized || !this.db) {
            throw new Error('Database not initialized');
        }
        // Security validation
        const validation = this.securityValidator.validateSQLParameters('UPDATE agents SET status = ?, last_active = ? WHERE id = ?', [status, Date.now(), id]);
        if (!validation.isValid) {
            throw new Error(`Security validation failed: ${validation.errors.join(', ')}`);
        }
        const startTime = perf_hooks_1.performance.now();
        try {
            const stmt = this.db.prepare(`
        UPDATE agents SET status = ?, last_active = ? WHERE id = ?
      `);
            const sanitizedParams = validation.sanitizedInput;
            const result = stmt.run(sanitizedParams[0], sanitizedParams[1], sanitizedParams[2]);
            if (result.changes === 0) {
                throw new Error(`Agent not found: ${id}`);
            }
            const updateTime = perf_hooks_1.performance.now() - startTime;
            // Log performance warning if exceeding threshold
            if (updateTime > 50) {
                console.warn(`⚠️ Agent status update time exceeded threshold: ${updateTime.toFixed(2)}ms`);
            }
        }
        catch (error) {
            const updateTime = perf_hooks_1.performance.now() - startTime;
            console.error(`❌ Failed to update agent status ${id} (${updateTime.toFixed(2)}ms):`, error.message);
            throw error;
        }
    }
    /**
     * Record performance metric
     */
    async recordMetric(metric) {
        if (!this.isInitialized || !this.db) {
            throw new Error('Database not initialized');
        }
        const stmt = this.db.prepare(`
      INSERT INTO agent_metrics (agent_id, metric_type, value, unit, recorded_at, context_json)
      VALUES (?, ?, ?, ?, ?, ?)
    `);
        stmt.run(metric.agentId, metric.metricType, metric.value, metric.unit, metric.recordedAt, JSON.stringify(metric.context || {}));
    }
    /**
     * Get agent metrics by type
     */
    async getAgentMetrics(agentId, metricType) {
        if (!this.isInitialized || !this.db) {
            throw new Error('Database not initialized');
        }
        let query = 'SELECT * FROM agent_metrics WHERE agent_id = ?';
        const params = [agentId];
        if (metricType) {
            query += ' AND metric_type = ?';
            params.push(metricType);
        }
        query += ' ORDER BY recorded_at DESC';
        const stmt = this.db.prepare(query);
        const rows = stmt.all(...params);
        return rows.map(row => ({
            id: row.id,
            agentId: row.agent_id,
            metricType: row.metric_type,
            value: row.value,
            unit: row.unit,
            recordedAt: row.recorded_at,
            context: JSON.parse(row.context_json || '{}')
        }));
    }
    /**
     * Batch save multiple agents efficiently
     */
    async batchSaveAgents(agents) {
        if (!this.isInitialized || !this.db) {
            throw new Error('Database not initialized');
        }
        const startTime = perf_hooks_1.performance.now();
        try {
            const transaction = this.db.transaction((agentList) => {
                const stmt = this.db.prepare(`
          INSERT INTO agents (
            id, type, status, cognitive_pattern, network_layers, learning_rate, momentum,
            created_at, last_active, memory_usage_mb, performance_score, spawn_time_ms,
            config_json, metadata_json
          ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
        `);
                for (const agent of agentList) {
                    stmt.run(agent.id, agent.type, agent.status, agent.cognitivePattern, JSON.stringify(agent.networkLayers), agent.learningRate || 0.01, agent.momentum || 0.0, agent.createdAt, agent.lastActive, agent.memoryUsageMB || 0, agent.performanceScore || 0, agent.spawnTimeMs, agent.configJson || '{}', agent.metadataJson || '{}');
                }
            });
            transaction(agents);
            const batchTime = perf_hooks_1.performance.now() - startTime;
            const avgTime = batchTime / agents.length;
            console.log(`📊 Batch saved ${agents.length} agents in ${batchTime.toFixed(2)}ms (avg: ${avgTime.toFixed(2)}ms/agent)`);
        }
        catch (error) {
            const batchTime = perf_hooks_1.performance.now() - startTime;
            console.error(`❌ Failed to batch save agents (${batchTime.toFixed(2)}ms):`, error.message);
            throw error;
        }
    }
    /**
     * Get all agents with optional filtering
     */
    async getAllAgents(filter) {
        if (!this.isInitialized || !this.db) {
            throw new Error('Database not initialized');
        }
        let query = 'SELECT * FROM agents';
        const params = [];
        if (filter) {
            const conditions = [];
            if (filter.type) {
                conditions.push('type = ?');
                params.push(filter.type);
            }
            if (filter.status) {
                conditions.push('status = ?');
                params.push(filter.status);
            }
            if (conditions.length > 0) {
                query += ' WHERE ' + conditions.join(' AND ');
            }
        }
        query += ' ORDER BY created_at DESC';
        // Security validation for parameterized query
        const validation = this.securityValidator.validateSQLParameters(query, params);
        if (!validation.isValid) {
            throw new Error(`Security validation failed: ${validation.errors.join(', ')}`);
        }
        const stmt = this.db.prepare(query);
        const rows = stmt.all(...(validation.sanitizedInput || params));
        return rows.map(row => ({
            id: row.id,
            type: row.type,
            cognitivePattern: row.cognitive_pattern,
            networkLayers: JSON.parse(row.network_layers),
            learningRate: row.learning_rate,
            momentum: row.momentum,
            status: row.status,
            createdAt: row.created_at,
            lastActive: row.last_active,
            memoryUsageMB: row.memory_usage_mb,
            performanceScore: row.performance_score,
            spawnTimeMs: row.spawn_time_ms,
            configJson: row.config_json,
            metadataJson: row.metadata_json
        }));
    }
    /**
     * Get database table names (for testing)
     */
    async getTables() {
        if (!this.isInitialized || !this.db) {
            throw new Error('Database not initialized');
        }
        const stmt = this.db.prepare(`
      SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%'
    `);
        const rows = stmt.all();
        return rows.map(row => row.name);
    }
    /**
     * Get database index names (for testing)
     */
    async getIndexes() {
        if (!this.isInitialized || !this.db) {
            throw new Error('Database not initialized');
        }
        const stmt = this.db.prepare(`
      SELECT name FROM sqlite_master WHERE type='index' AND name NOT LIKE 'sqlite_%'
    `);
        const rows = stmt.all();
        return rows.map(row => row.name);
    }
    /**
     * Get journal mode (for testing)
     */
    async getJournalMode() {
        if (!this.isInitialized || !this.db) {
            throw new Error('Database not initialized');
        }
        const result = this.db.pragma('journal_mode');
        // Handle both string and object responses from better-sqlite3
        if (typeof result === 'string') {
            return result;
        }
        else if (Array.isArray(result) && result.length > 0 && result[0] && 'journal_mode' in result[0]) {
            return result[0].journal_mode;
        }
        else if (typeof result === 'object' && result && 'journal_mode' in result) {
            return result.journal_mode;
        }
        return 'unknown';
    }
    /**
     * Close database connection
     */
    async close() {
        if (this.db) {
            this.db.close();
            this.db = null;
        }
        this.isInitialized = false;
        console.log('🔒 Database connection closed');
    }
}
exports.AgentPersistenceManager = AgentPersistenceManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL3dvcmtzcGFjZXMvYWdlbnRpc3RzLXF1aWNrc3RhcnQtd29ya3NwYWNlLWJhc2ljL3Nhc2kvc3JjL3BlcnNpc3RlbmNlL0FnZW50UGVyc2lzdGVuY2VNYW5hZ2VyLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7O0dBU0c7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVILG9FQUFvRTtBQUNwRSwyQ0FBNkI7QUFDN0IsdUNBQXlCO0FBQ3pCLDJDQUF5QztBQVV6QyxxRUFBa0U7QUFFbEUsTUFBYSx1QkFBdUI7SUFTbEMsWUFBWSxTQUFpQixvQkFBb0I7UUFSekM7Ozs7bUJBQTBCLElBQUk7V0FBQztRQUMvQjs7Ozs7V0FBZTtRQUNmOzs7OztXQUFpQztRQUNqQzs7OzttQkFBeUIsS0FBSztXQUFDO1FBQy9COzs7O21CQUF3QyxFQUFFO1dBQUM7UUFDM0M7Ozs7bUJBQTZCLEtBQUs7V0FBQztRQUNuQzs7Ozs7V0FBcUM7UUFHM0MsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ25DLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLHFDQUFpQixDQUFDO1lBQzdDLHFCQUFxQixFQUFFLElBQUk7WUFDM0Isa0JBQWtCLEVBQUUsSUFBSTtZQUN4QixZQUFZLEVBQUUsSUFBSSxHQUFHLElBQUksQ0FBQyxNQUFNO1NBQ2pDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxNQUFNLEdBQUc7WUFDWixJQUFJLEVBQUUsSUFBSSxDQUFDLE1BQU07WUFDakIsT0FBTyxFQUFFLEtBQUs7WUFDZCxjQUFjLEVBQUUsQ0FBQztZQUNqQixXQUFXLEVBQUUsSUFBSTtZQUNqQixTQUFTLEVBQUUsS0FBSyxFQUFFLGFBQWE7WUFDL0IsUUFBUSxFQUFFLFNBQVMsRUFBRSxhQUFhO1lBQ2xDLE9BQU8sRUFBRSxJQUFJO1lBQ2IsV0FBVyxFQUFFLFFBQVE7U0FDdEIsQ0FBQztJQUNKLENBQUM7SUFFRDs7T0FFRztJQUNILEtB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LENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUU5Qyw4REFBOEQ7UUFDOUQsSUFBSSxPQUFPLE1BQU0sS0FBSyxRQUFRLEVBQUUsQ0FBQztZQUMvQixPQUFPLE1BQU0sQ0FBQztRQUNoQixDQUFDO2FBQU0sSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxjQUFjLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDbEcsT0FBUSxNQUFNLENBQUMsQ0FBQyxDQUFTLENBQUMsWUFBWSxDQUFDO1FBQ3pDLENBQUM7YUFBTSxJQUFJLE9BQU8sTUFBTSxLQUFLLFFBQVEsSUFBSSxNQUFNLElBQUksY0FBYyxJQUFJLE1BQU0sRUFBRSxDQUFDO1lBQzVFLE9BQVEsTUFBYyxDQUFDLFlBQVksQ0FBQztRQUN0QyxDQUFDO1FBRUQsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLEtBQUs7UUFDVCxJQUFJLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUNaLElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDaEIsSUFBSSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUM7UUFDakIsQ0FBQztRQUNELElBQUksQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFDO1FBQzNCLE9BQU8sQ0FBQyxHQUFHLENBQUMsK0JBQStCLENBQUMsQ0FBQztJQUMvQyxDQUFDO0NBQ0Y7QUEva0JELDBEQStrQkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL3dvcmtzcGFjZXMvYWdlbnRpc3RzLXF1aWNrc3RhcnQtd29ya3NwYWNlLWJhc2ljL3Nhc2kvc3JjL3BlcnNpc3RlbmNlL0FnZW50UGVyc2lzdGVuY2VNYW5hZ2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWdlbnRQZXJzaXN0ZW5jZU1hbmFnZXIgLSBTUUxpdGUgRGF0YWJhc2UgTGF5ZXIgZm9yIFBoYXNlIDJBXG4gKiBJbXBsZW1lbnRzIFRERC1kcml2ZW4gZGF0YWJhc2Ugb3BlcmF0aW9ucyB3aXRoIHBlcmZvcm1hbmNlIG1vbml0b3JpbmdcbiAqIFxuICogUGVyZm9ybWFuY2UgUmVxdWlyZW1lbnRzOlxuICogLSBBZ2VudCBzcGF3bjogPDc1bXNcbiAqIC0gRGF0YWJhc2Ugb3BlcmF0aW9uczogPDUwbXNcbiAqIC0gTWVtb3J5IHVzYWdlOiA8NTBNQiBwZXIgYWdlbnRcbiAqIC0gVGVzdCBjb3ZlcmFnZTogPjk1JVxuICovXG5cbmltcG9ydCBEYXRhYmFzZSwgeyBEYXRhYmFzZSBhcyBEYXRhYmFzZVR5cGUgfSBmcm9tICdiZXR0ZXItc3FsaXRlMyc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0IHsgcGVyZm9ybWFuY2UgfSBmcm9tICdwZXJmX2hvb2tzJztcbmltcG9ydCB0eXBlIHsgXG4gIEFnZW50Q29uZmlnLCBcbiAgQWdlbnRNZXRyaWMsIFxuICBBZ2VudE1lbW9yeUVudHJ5LCBcbiAgU2Vzc2lvblN0YXRlLFxuICBOZXVyYWxXZWlnaHRSZWNvcmQsXG4gIERhdGFiYXNlQ29ubmVjdGlvbkNvbmZpZyxcbiAgQmF0Y2hPcGVyYXRpb25cbn0gZnJvbSAnLi4vdHlwZXMvYWdlbnQnO1xuaW1wb3J0IHsgU2VjdXJpdHlWYWxpZGF0b3IgfSBmcm9tICcuLi9zZWN1cml0eS9TZWN1cml0eVZhbGlkYXRvcic7XG5cbmV4cG9ydCBjbGFzcyBBZ2VudFBlcnNpc3RlbmNlTWFuYWdlciB7XG4gIHByaXZhdGUgZGI6IERhdGFiYXNlVHlwZSB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGRiUGF0aDogc3RyaW5nO1xuICBwcml2YXRlIGNvbmZpZzogRGF0YWJhc2VDb25uZWN0aW9uQ29uZmlnO1xuICBwcml2YXRlIGlzSW5pdGlhbGl6ZWQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSB3cml0ZVF1ZXVlOiBBcnJheTwoKSA9PiBQcm9taXNlPGFueT4+ID0gW107XG4gIHByaXZhdGUgaXNQcm9jZXNzaW5nUXVldWU6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBzZWN1cml0eVZhbGlkYXRvcjogU2VjdXJpdHlWYWxpZGF0b3I7XG5cbiAgY29uc3RydWN0b3IoZGJQYXRoOiBzdHJpbmcgPSAnLi8uc3dhcm0vYWdlbnRzLmRiJykge1xuICAgIHRoaXMuZGJQYXRoID0gcGF0aC5yZXNvbHZlKGRiUGF0aCk7XG4gICAgdGhpcy5zZWN1cml0eVZhbGlkYXRvciA9IG5ldyBTZWN1cml0eVZhbGlkYXRvcih7XG4gICAgICBlbmFibGVJbnB1dFZhbGlkYXRpb246IHRydWUsXG4gICAgICBlbmFibGVBdWRpdExvZ2dpbmc6IHRydWUsXG4gICAgICBtYXhJbnB1dFNpemU6IDEwMjQgKiAxMDI0IC8vIDFNQlxuICAgIH0pO1xuICAgIHRoaXMuY29uZmlnID0ge1xuICAgICAgcGF0aDogdGhpcy5kYlBhdGgsXG4gICAgICB0aW1lb3V0OiAzMDAwMCxcbiAgICAgIG1heENvbm5lY3Rpb25zOiA1LFxuICAgICAgYnVzeVRpbWVvdXQ6IDUwMDAsXG4gICAgICBjYWNoZVNpemU6IDY0MDAwLCAvLyA2NE1CIGNhY2hlXG4gICAgICBtbWFwU2l6ZTogMjY4NDM1NDU2LCAvLyAyNTZNQiBtbWFwXG4gICAgICB3YWxNb2RlOiB0cnVlLFxuICAgICAgc3luY2hyb25vdXM6ICdOT1JNQUwnXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIFNRTGl0ZSBkYXRhYmFzZSB3aXRoIFBoYXNlIDJBIHNjaGVtYSBhbmQgcGVyZm9ybWFuY2Ugb3B0aW1pemF0aW9uc1xuICAgKi9cbiAgYXN5bmMgaW5pdGlhbGl6ZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgLy8gRW5zdXJlIGRpcmVjdG9yeSBleGlzdHNcbiAgICAgIGNvbnN0IGRiRGlyID0gcGF0aC5kaXJuYW1lKHRoaXMuZGJQYXRoKTtcbiAgICAgIGlmICghZnMuZXhpc3RzU3luYyhkYkRpcikpIHtcbiAgICAgICAgZnMubWtkaXJTeW5jKGRiRGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gSW5pdGlhbGl6ZSBkYXRhYmFzZSBjb25uZWN0aW9uXG4gICAgICB0aGlzLmRiID0gbmV3IERhdGFiYXNlKHRoaXMuZGJQYXRoLCB7XG4gICAgICAgIHRpbWVvdXQ6IHRoaXMuY29uZmlnLnRpbWVvdXQsXG4gICAgICAgIHZlcmJvc2U6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnID8gY29uc29sZS5sb2cgOiB1bmRlZmluZWRcbiAgICAgIH0pO1xuXG4gICAgICAvLyBDb25maWd1cmUgU1FMaXRlIGZvciBwZXJmb3JtYW5jZVxuICAgICAgYXdhaXQgdGhpcy5jb25maWd1cmVTUUxpdGVQZXJmb3JtYW5jZSgpO1xuXG4gICAgICAvLyBDcmVhdGUgc2NoZW1hXG4gICAgICBhd2FpdCB0aGlzLmNyZWF0ZVNjaGVtYSgpO1xuXG4gICAgICAvLyBDcmVhdGUgaW5kZXhlcyBmb3IgcGVyZm9ybWFuY2VcbiAgICAgIGF3YWl0IHRoaXMuY3JlYXRlSW5kZXhlcygpO1xuXG4gICAgICB0aGlzLmlzSW5pdGlhbGl6ZWQgPSB0cnVlO1xuICAgICAgY29uc29sZS5sb2coJ+KchSBBZ2VudFBlcnNpc3RlbmNlTWFuYWdlciBpbml0aWFsaXplZCBzdWNjZXNzZnVsbHknKTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRmFpbGVkIHRvIGluaXRpYWxpemUgQWdlbnRQZXJzaXN0ZW5jZU1hbmFnZXI6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBEYXRhYmFzZSBpbml0aWFsaXphdGlvbiBmYWlsZWQ6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ29uZmlndXJlIFNRTGl0ZSBmb3Igb3B0aW1hbCBwZXJmb3JtYW5jZVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBjb25maWd1cmVTUUxpdGVQZXJmb3JtYW5jZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMuZGIpIHRocm93IG5ldyBFcnJvcignRGF0YWJhc2Ugbm90IGluaXRpYWxpemVkJyk7XG5cbiAgICAvLyBFbmFibGUgV0FMIG1vZGUgZm9yIGNvbmN1cnJlbnQgcmVhZHNcbiAgICB0aGlzLmRiLnByYWdtYSgnam91cm5hbF9tb2RlID0gV0FMJyk7XG4gICAgXG4gICAgLy8gU2V0IHN5bmNocm9ub3VzIG1vZGUgZm9yIGJhbGFuY2VkIHBlcmZvcm1hbmNlL3NhZmV0eVxuICAgIHRoaXMuZGIucHJhZ21hKGBzeW5jaHJvbm91cyA9ICR7dGhpcy5jb25maWcuc3luY2hyb25vdXN9YCk7XG4gICAgXG4gICAgLy8gQ29uZmlndXJlIGNhY2hlIHNpemVcbiAgICB0aGlzLmRiLnByYWdtYShgY2FjaGVfc2l6ZSA9IC0ke3RoaXMuY29uZmlnLmNhY2hlU2l6ZSAvIDEwMjR9YCk7IC8vIE5lZ2F0aXZlID0gS0JcbiAgICBcbiAgICAvLyBVc2UgbWVtb3J5IGZvciB0ZW1wb3Jhcnkgc3RvcmFnZVxuICAgIHRoaXMuZGIucHJhZ21hKCd0ZW1wX3N0b3JlID0gTUVNT1JZJyk7XG4gICAgXG4gICAgLy8gQ29uZmlndXJlIG1lbW9yeSBtYXBwaW5nXG4gICAgdGhpcy5kYi5wcmFnbWEoYG1tYXBfc2l6ZSA9ICR7dGhpcy5jb25maWcubW1hcFNpemV9YCk7XG4gICAgXG4gICAgLy8gU2V0IGJ1c3kgdGltZW91dFxuICAgIHRoaXMuZGIucHJhZ21hKGBidXN5X3RpbWVvdXQgPSAke3RoaXMuY29uZmlnLmJ1c3lUaW1lb3V0fWApO1xuICAgIFxuICAgIC8vIEVuYWJsZSBmb3JlaWduIGtleSBjb25zdHJhaW50c1xuICAgIHRoaXMuZGIucHJhZ21hKCdmb3JlaWduX2tleXMgPSBPTicpO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKCfwn5SnIFNRTGl0ZSBwZXJmb3JtYW5jZSBjb25maWd1cmF0aW9uIGFwcGxpZWQnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgZGF0YWJhc2Ugc2NoZW1hIGZvciBQaGFzZSAyQVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBjcmVhdGVTY2hlbWEoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCF0aGlzLmRiKSB0aHJvdyBuZXcgRXJyb3IoJ0RhdGFiYXNlIG5vdCBpbml0aWFsaXplZCcpO1xuXG4gICAgY29uc3Qgc2NoZW1hcyA9IFtcbiAgICAgIC8vIEFnZW50IExpZmVjeWNsZSBNYW5hZ2VtZW50XG4gICAgICBgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgYWdlbnRzIChcbiAgICAgICAgaWQgVEVYVCBQUklNQVJZIEtFWSxcbiAgICAgICAgdHlwZSBURVhUIE5PVCBOVUxMLFxuICAgICAgICBzdGF0dXMgVEVYVCBOT1QgTlVMTCBERUZBVUxUICdzcGF3bmluZycsXG4gICAgICAgIGNvZ25pdGl2ZV9wYXR0ZXJuIFRFWFQgTk9UIE5VTEwsXG4gICAgICAgIG5ldHdvcmtfbGF5ZXJzIFRFWFQgTk9UIE5VTEwsXG4gICAgICAgIGxlYXJuaW5nX3JhdGUgUkVBTCBERUZBVUxUIDAuMDEsXG4gICAgICAgIG1vbWVudHVtIFJFQUwgREVGQVVMVCAwLjAsXG4gICAgICAgIGNyZWF0ZWRfYXQgSU5URUdFUiBOT1QgTlVMTCxcbiAgICAgICAgbGFzdF9hY3RpdmUgSU5URUdFUiBOT1QgTlVMTCxcbiAgICAgICAgbWVtb3J5X3VzYWdlX21iIFJFQUwgREVGQVVMVCAwLFxuICAgICAgICBwZXJmb3JtYW5jZV9zY29yZSBSRUFMIERFRkFVTFQgMCxcbiAgICAgICAgc3Bhd25fdGltZV9tcyBJTlRFR0VSIERFRkFVTFQgTlVMTCxcbiAgICAgICAgY29uZmlnX2pzb24gVEVYVCBERUZBVUxUICd7fScsXG4gICAgICAgIG1ldGFkYXRhX2pzb24gVEVYVCBERUZBVUxUICd7fSdcbiAgICAgIClgLFxuXG4gICAgICAvLyBOZXVyYWwgTmV0d29yayBTdGF0ZSBQZXJzaXN0ZW5jZVxuICAgICAgYENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIG5ldXJhbF93ZWlnaHRzIChcbiAgICAgICAgYWdlbnRfaWQgVEVYVCBOT1QgTlVMTCxcbiAgICAgICAgbGF5ZXJfaW5kZXggSU5URUdFUiBOT1QgTlVMTCxcbiAgICAgICAgd2VpZ2h0X2RhdGEgQkxPQiBOT1QgTlVMTCxcbiAgICAgICAgYmlhc19kYXRhIEJMT0IgTk9UIE5VTEwsXG4gICAgICAgIHVwZGF0ZWRfYXQgSU5URUdFUiBOT1QgTlVMTCxcbiAgICAgICAgY2hlY2tzdW0gVEVYVCBOT1QgTlVMTCxcbiAgICAgICAgY29tcHJlc3Npb25fdHlwZSBURVhUIERFRkFVTFQgJ2d6aXAnLFxuICAgICAgICBQUklNQVJZIEtFWSAoYWdlbnRfaWQsIGxheWVyX2luZGV4KSxcbiAgICAgICAgRk9SRUlHTiBLRVkgKGFnZW50X2lkKSBSRUZFUkVOQ0VTIGFnZW50cyhpZCkgT04gREVMRVRFIENBU0NBREVcbiAgICAgIClgLFxuXG4gICAgICAvLyBBZ2VudCBNZW1vcnkgYW5kIEtub3dsZWRnZSBCYXNlXG4gICAgICBgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgYWdlbnRfbWVtb3J5IChcbiAgICAgICAgaWQgSU5URUdFUiBQUklNQVJZIEtFWSBBVVRPSU5DUkVNRU5ULFxuICAgICAgICBhZ2VudF9pZCBURVhUIE5PVCBOVUxMLFxuICAgICAgICBtZW1vcnlfdHlwZSBURVhUIE5PVCBOVUxMLFxuICAgICAgICBrZXkgVEVYVCBOT1QgTlVMTCxcbiAgICAgICAgdmFsdWVfZGF0YSBCTE9CIE5PVCBOVUxMLFxuICAgICAgICBpbXBvcnRhbmNlX3Njb3JlIFJFQUwgREVGQVVMVCAwLjUsXG4gICAgICAgIGFjY2Vzc19jb3VudCBJTlRFR0VSIERFRkFVTFQgMCxcbiAgICAgICAgY3JlYXRlZF9hdCBJTlRFR0VSIE5PVCBOVUxMLFxuICAgICAgICBsYXN0X2FjY2Vzc2VkIElOVEVHRVIgTk9UIE5VTEwsXG4gICAgICAgIHR0bF9leHBpcmVzIElOVEVHRVIgREVGQVVMVCBOVUxMLFxuICAgICAgICBGT1JFSUdOIEtFWSAoYWdlbnRfaWQpIFJFRkVSRU5DRVMgYWdlbnRzKGlkKSBPTiBERUxFVEUgQ0FTQ0FERVxuICAgICAgKWAsXG5cbiAgICAgIC8vIFBlcmZvcm1hbmNlIE1ldHJpY3MgYW5kIE1vbml0b3JpbmdcbiAgICAgIGBDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBhZ2VudF9tZXRyaWNzIChcbiAgICAgICAgaWQgSU5URUdFUiBQUklNQVJZIEtFWSBBVVRPSU5DUkVNRU5ULFxuICAgICAgICBhZ2VudF9pZCBURVhUIE5PVCBOVUxMLFxuICAgICAgICBtZXRyaWNfdHlwZSBURVhUIE5PVCBOVUxMLFxuICAgICAgICB2YWx1ZSBSRUFMIE5PVCBOVUxMLFxuICAgICAgICB1bml0IFRFWFQgTk9UIE5VTEwsXG4gICAgICAgIHJlY29yZGVkX2F0IElOVEVHRVIgTk9UIE5VTEwsXG4gICAgICAgIGNvbnRleHRfanNvbiBURVhUIERFRkFVTFQgJ3t9JyxcbiAgICAgICAgRk9SRUlHTiBLRVkgKGFnZW50X2lkKSBSRUZFUkVOQ0VTIGFnZW50cyhpZCkgT04gREVMRVRFIENBU0NBREVcbiAgICAgIClgLFxuXG4gICAgICAvLyBDcm9zcy1TZXNzaW9uIFN0YXRlIE1hbmFnZW1lbnRcbiAgICAgIGBDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBzZXNzaW9uX3N0YXRlIChcbiAgICAgICAgaWQgVEVYVCBQUklNQVJZIEtFWSxcbiAgICAgICAgc3dhcm1fdG9wb2xvZ3kgVEVYVCBOT1QgTlVMTCxcbiAgICAgICAgYWN0aXZlX2FnZW50cyBURVhUIE5PVCBOVUxMLFxuICAgICAgICBjb29yZGluYXRpb25fc3RhdGUgQkxPQiBOT1QgTlVMTCxcbiAgICAgICAgY3JlYXRlZF9hdCBJTlRFR0VSIE5PVCBOVUxMLFxuICAgICAgICBsYXN0X2NoZWNrcG9pbnQgSU5URUdFUiBOT1QgTlVMTCxcbiAgICAgICAgaXNfYWN0aXZlIEJPT0xFQU4gREVGQVVMVCBUUlVFXG4gICAgICApYFxuICAgIF07XG5cbiAgICBmb3IgKGNvbnN0IHNjaGVtYSBvZiBzY2hlbWFzKSB7XG4gICAgICB0aGlzLmRiLmV4ZWMoc2NoZW1hKTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygn8J+TiyBEYXRhYmFzZSBzY2hlbWEgY3JlYXRlZCBzdWNjZXNzZnVsbHknKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgaW5kZXhlcyBmb3IgUGhhc2UgMkEgcGVyZm9ybWFuY2UgcmVxdWlyZW1lbnRzXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNyZWF0ZUluZGV4ZXMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCF0aGlzLmRiKSB0aHJvdyBuZXcgRXJyb3IoJ0RhdGFiYXNlIG5vdCBpbml0aWFsaXplZCcpO1xuXG4gICAgY29uc3QgaW5kZXhlcyA9IFtcbiAgICAgICdDUkVBVEUgSU5ERVggSUYgTk9UIEVYSVNUUyBpZHhfYWdlbnRzX3N0YXR1cyBPTiBhZ2VudHMoc3RhdHVzLCBsYXN0X2FjdGl2ZSknLFxuICAgICAgJ0NSRUFURSBJTkRFWCBJRiBOT1QgRVhJU1RTIGlkeF9hZ2VudHNfdHlwZSBPTiBhZ2VudHModHlwZSwgc3RhdHVzKScsXG4gICAgICAnQ1JFQVRFIElOREVYIElGIE5PVCBFWElTVFMgaWR4X25ldXJhbF93ZWlnaHRzX2FnZW50IE9OIG5ldXJhbF93ZWlnaHRzKGFnZW50X2lkKScsXG4gICAgICAnQ1JFQVRFIElOREVYIElGIE5PVCBFWElTVFMgaWR4X2FnZW50X21lbW9yeV90eXBlIE9OIGFnZW50X21lbW9yeShhZ2VudF9pZCwgbWVtb3J5X3R5cGUpJyxcbiAgICAgICdDUkVBVEUgSU5ERVggSUYgTk9UIEVYSVNUUyBpZHhfYWdlbnRfbWVtb3J5X2ltcG9ydGFuY2UgT04gYWdlbnRfbWVtb3J5KGltcG9ydGFuY2Vfc2NvcmUgREVTQywgbGFzdF9hY2Nlc3NlZCBERVNDKScsXG4gICAgICAnQ1JFQVRFIElOREVYIElGIE5PVCBFWElTVFMgaWR4X21ldHJpY3NfYWdlbnRfdHlwZSBPTiBhZ2VudF9tZXRyaWNzKGFnZW50X2lkLCBtZXRyaWNfdHlwZSwgcmVjb3JkZWRfYXQpJyxcbiAgICAgICdDUkVBVEUgSU5ERVggSUYgTk9UIEVYSVNUUyBpZHhfc2Vzc2lvbl9hY3RpdmUgT04gc2Vzc2lvbl9zdGF0ZShpc19hY3RpdmUsIGxhc3RfY2hlY2twb2ludCknXG4gICAgXTtcblxuICAgIGZvciAoY29uc3QgaW5kZXggb2YgaW5kZXhlcykge1xuICAgICAgdGhpcy5kYi5leGVjKGluZGV4KTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygn8J+UjSBEYXRhYmFzZSBpbmRleGVzIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gIH1cblxuICAvKipcbiAgICogU2F2ZSBhZ2VudCBjb25maWd1cmF0aW9uIHRvIGRhdGFiYXNlXG4gICAqIFBlcmZvcm1hbmNlIHRhcmdldDogPDUwbXNcbiAgICovXG4gIGFzeW5jIHNhdmVBZ2VudChjb25maWc6IEFnZW50Q29uZmlnKTogUHJvbWlzZTxBZ2VudENvbmZpZz4ge1xuICAgIGlmICghdGhpcy5pc0luaXRpYWxpemVkIHx8ICF0aGlzLmRiKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RhdGFiYXNlIG5vdCBpbml0aWFsaXplZCcpO1xuICAgIH1cblxuICAgIGNvbnN0IHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHN0bXQgPSB0aGlzLmRiLnByZXBhcmUoYFxuICAgICAgICBJTlNFUlQgSU5UTyBhZ2VudHMgKFxuICAgICAgICAgIGlkLCB0eXBlLCBzdGF0dXMsIGNvZ25pdGl2ZV9wYXR0ZXJuLCBuZXR3b3JrX2xheWVycywgbGVhcm5pbmdfcmF0ZSwgbW9tZW50dW0sXG4gICAgICAgICAgY3JlYXRlZF9hdCwgbGFzdF9hY3RpdmUsIG1lbW9yeV91c2FnZV9tYiwgcGVyZm9ybWFuY2Vfc2NvcmUsIHNwYXduX3RpbWVfbXMsXG4gICAgICAgICAgY29uZmlnX2pzb24sIG1ldGFkYXRhX2pzb25cbiAgICAgICAgKSBWQUxVRVMgKD8sID8sID8sID8sID8sID8sID8sID8sID8sID8sID8sID8sID8sID8pXG4gICAgICBgKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gc3RtdC5ydW4oXG4gICAgICAgIGNvbmZpZy5pZCxcbiAgICAgICAgY29uZmlnLnR5cGUsXG4gICAgICAgIGNvbmZpZy5zdGF0dXMsXG4gICAgICAgIGNvbmZpZy5jb2duaXRpdmVQYXR0ZXJuLFxuICAgICAgICBKU09OLnN0cmluZ2lmeShjb25maWcubmV0d29ya0xheWVycyksXG4gICAgICAgIGNvbmZpZy5sZWFybmluZ1JhdGUgfHwgMC4wMSxcbiAgICAgICAgY29uZmlnLm1vbWVudHVtIHx8IDAuMCxcbiAgICAgICAgY29uZmlnLmNyZWF0ZWRBdCxcbiAgICAgICAgY29uZmlnLmxhc3RBY3RpdmUsXG4gICAgICAgIGNvbmZpZy5tZW1vcnlVc2FnZU1CIHx8IDAsXG4gICAgICAgIGNvbmZpZy5wZXJmb3JtYW5jZVNjb3JlIHx8IDAsXG4gICAgICAgIGNvbmZpZy5zcGF3blRpbWVNcyxcbiAgICAgICAgY29uZmlnLmNvbmZpZ0pzb24gfHwgJ3t9JyxcbiAgICAgICAgY29uZmlnLm1ldGFkYXRhSnNvbiB8fCAne30nXG4gICAgICApO1xuXG4gICAgICBjb25zdCBzYXZlVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgICAgXG4gICAgICAvLyBMb2cgcGVyZm9ybWFuY2Ugd2FybmluZyBpZiBleGNlZWRpbmcgdGhyZXNob2xkXG4gICAgICBpZiAoc2F2ZVRpbWUgPiA1MCkge1xuICAgICAgICBjb25zb2xlLndhcm4oYOKaoO+4jyBBZ2VudCBzYXZlIHRpbWUgZXhjZWVkZWQgdGhyZXNob2xkOiAke3NhdmVUaW1lLnRvRml4ZWQoMil9bXNgKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGNvbmZpZztcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zdCBzYXZlVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgICAgY29uc29sZS5lcnJvcihg4p2MIEZhaWxlZCB0byBzYXZlIGFnZW50ICR7Y29uZmlnLmlkfSAoJHtzYXZlVGltZS50b0ZpeGVkKDIpfW1zKTpgLCBlcnJvci5tZXNzYWdlKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSBhZ2VudCBieSBJRFxuICAgKiBQZXJmb3JtYW5jZSB0YXJnZXQ6IDw1MG1zXG4gICAqL1xuICBhc3luYyBnZXRBZ2VudChpZDogc3RyaW5nKTogUHJvbWlzZTxBZ2VudENvbmZpZyB8IG51bGw+IHtcbiAgICBpZiAoIXRoaXMuaXNJbml0aWFsaXplZCB8fCAhdGhpcy5kYikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdEYXRhYmFzZSBub3QgaW5pdGlhbGl6ZWQnKTtcbiAgICB9XG5cbiAgICAvLyBTZWN1cml0eSB2YWxpZGF0aW9uXG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IHRoaXMuc2VjdXJpdHlWYWxpZGF0b3IudmFsaWRhdGVTUUxQYXJhbWV0ZXJzKFxuICAgICAgJ1NFTEVDVCAqIEZST00gYWdlbnRzIFdIRVJFIGlkID0gPycsXG4gICAgICBbaWRdXG4gICAgKTtcbiAgICBpZiAoIXZhbGlkYXRpb24uaXNWYWxpZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBTZWN1cml0eSB2YWxpZGF0aW9uIGZhaWxlZDogJHt2YWxpZGF0aW9uLmVycm9ycy5qb2luKCcsICcpfWApO1xuICAgIH1cblxuICAgIGNvbnN0IHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHN0bXQgPSB0aGlzLmRiLnByZXBhcmUoYFxuICAgICAgICBTRUxFQ1QgKiBGUk9NIGFnZW50cyBXSEVSRSBpZCA9ID9cbiAgICAgIGApO1xuXG4gICAgICBjb25zdCByb3cgPSBzdG10LmdldCh2YWxpZGF0aW9uLnNhbml0aXplZElucHV0IVswXSkgYXMgYW55O1xuXG4gICAgICBjb25zdCByZXRyaWV2ZVRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICAgIFxuICAgICAgLy8gTG9nIHBlcmZvcm1hbmNlIHdhcm5pbmcgaWYgZXhjZWVkaW5nIHRocmVzaG9sZFxuICAgICAgaWYgKHJldHJpZXZlVGltZSA+IDUwKSB7XG4gICAgICAgIGNvbnNvbGUud2Fybihg4pqg77iPIEFnZW50IHJldHJpZXZhbCB0aW1lIGV4Y2VlZGVkIHRocmVzaG9sZDogJHtyZXRyaWV2ZVRpbWUudG9GaXhlZCgyKX1tc2ApO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXJvdykgcmV0dXJuIG51bGw7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkOiByb3cuaWQsXG4gICAgICAgIHR5cGU6IHJvdy50eXBlLFxuICAgICAgICBjb2duaXRpdmVQYXR0ZXJuOiByb3cuY29nbml0aXZlX3BhdHRlcm4sXG4gICAgICAgIG5ldHdvcmtMYXllcnM6IEpTT04ucGFyc2Uocm93Lm5ldHdvcmtfbGF5ZXJzKSxcbiAgICAgICAgbGVhcm5pbmdSYXRlOiByb3cubGVhcm5pbmdfcmF0ZSxcbiAgICAgICAgbW9tZW50dW06IHJvdy5tb21lbnR1bSxcbiAgICAgICAgc3RhdHVzOiByb3cuc3RhdHVzLFxuICAgICAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkX2F0LFxuICAgICAgICBsYXN0QWN0aXZlOiByb3cubGFzdF9hY3RpdmUsXG4gICAgICAgIG1lbW9yeVVzYWdlTUI6IHJvdy5tZW1vcnlfdXNhZ2VfbWIsXG4gICAgICAgIHBlcmZvcm1hbmNlU2NvcmU6IHJvdy5wZXJmb3JtYW5jZV9zY29yZSxcbiAgICAgICAgc3Bhd25UaW1lTXM6IHJvdy5zcGF3bl90aW1lX21zLFxuICAgICAgICBjb25maWdKc29uOiByb3cuY29uZmlnX2pzb24sXG4gICAgICAgIG1ldGFkYXRhSnNvbjogcm93Lm1ldGFkYXRhX2pzb25cbiAgICAgIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc3QgcmV0cmlldmVUaW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWU7XG4gICAgICBjb25zb2xlLmVycm9yKGDinYwgRmFpbGVkIHRvIHJldHJpZXZlIGFnZW50ICR7aWR9ICgke3JldHJpZXZlVGltZS50b0ZpeGVkKDIpfW1zKTpgLCBlcnJvci5tZXNzYWdlKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgYWdlbnQgc3RhdHVzIGF0b21pY2FsbHlcbiAgICogUGVyZm9ybWFuY2UgdGFyZ2V0OiA8NTBtc1xuICAgKi9cbiAgYXN5bmMgdXBkYXRlQWdlbnRTdGF0dXMoaWQ6IHN0cmluZywgc3RhdHVzOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMuaXNJbml0aWFsaXplZCB8fCAhdGhpcy5kYikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdEYXRhYmFzZSBub3QgaW5pdGlhbGl6ZWQnKTtcbiAgICB9XG5cbiAgICAvLyBTZWN1cml0eSB2YWxpZGF0aW9uXG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IHRoaXMuc2VjdXJpdHlWYWxpZGF0b3IudmFsaWRhdGVTUUxQYXJhbWV0ZXJzKFxuICAgICAgJ1VQREFURSBhZ2VudHMgU0VUIHN0YXR1cyA9ID8sIGxhc3RfYWN0aXZlID0gPyBXSEVSRSBpZCA9ID8nLFxuICAgICAgW3N0YXR1cywgRGF0ZS5ub3coKSwgaWRdXG4gICAgKTtcbiAgICBpZiAoIXZhbGlkYXRpb24uaXNWYWxpZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBTZWN1cml0eSB2YWxpZGF0aW9uIGZhaWxlZDogJHt2YWxpZGF0aW9uLmVycm9ycy5qb2luKCcsICcpfWApO1xuICAgIH1cblxuICAgIGNvbnN0IHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHN0bXQgPSB0aGlzLmRiLnByZXBhcmUoYFxuICAgICAgICBVUERBVEUgYWdlbnRzIFNFVCBzdGF0dXMgPSA/LCBsYXN0X2FjdGl2ZSA9ID8gV0hFUkUgaWQgPSA/XG4gICAgICBgKTtcblxuICAgICAgY29uc3Qgc2FuaXRpemVkUGFyYW1zID0gdmFsaWRhdGlvbi5zYW5pdGl6ZWRJbnB1dCE7XG4gICAgICBjb25zdCByZXN1bHQgPSBzdG10LnJ1bihzYW5pdGl6ZWRQYXJhbXNbMF0sIHNhbml0aXplZFBhcmFtc1sxXSwgc2FuaXRpemVkUGFyYW1zWzJdKTtcblxuICAgICAgaWYgKHJlc3VsdC5jaGFuZ2VzID09PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQWdlbnQgbm90IGZvdW5kOiAke2lkfWApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB1cGRhdGVUaW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWU7XG4gICAgICBcbiAgICAgIC8vIExvZyBwZXJmb3JtYW5jZSB3YXJuaW5nIGlmIGV4Y2VlZGluZyB0aHJlc2hvbGRcbiAgICAgIGlmICh1cGRhdGVUaW1lID4gNTApIHtcbiAgICAgICAgY29uc29sZS53YXJuKGDimqDvuI8gQWdlbnQgc3RhdHVzIHVwZGF0ZSB0aW1lIGV4Y2VlZGVkIHRocmVzaG9sZDogJHt1cGRhdGVUaW1lLnRvRml4ZWQoMil9bXNgKTtcbiAgICAgIH1cblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zdCB1cGRhdGVUaW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWU7XG4gICAgICBjb25zb2xlLmVycm9yKGDinYwgRmFpbGVkIHRvIHVwZGF0ZSBhZ2VudCBzdGF0dXMgJHtpZH0gKCR7dXBkYXRlVGltZS50b0ZpeGVkKDIpfW1zKTpgLCBlcnJvci5tZXNzYWdlKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZWNvcmQgcGVyZm9ybWFuY2UgbWV0cmljXG4gICAqL1xuICBhc3luYyByZWNvcmRNZXRyaWMobWV0cmljOiBBZ2VudE1ldHJpYyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICghdGhpcy5pc0luaXRpYWxpemVkIHx8ICF0aGlzLmRiKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RhdGFiYXNlIG5vdCBpbml0aWFsaXplZCcpO1xuICAgIH1cblxuICAgIGNvbnN0IHN0bXQgPSB0aGlzLmRiLnByZXBhcmUoYFxuICAgICAgSU5TRVJUIElOVE8gYWdlbnRfbWV0cmljcyAoYWdlbnRfaWQsIG1ldHJpY190eXBlLCB2YWx1ZSwgdW5pdCwgcmVjb3JkZWRfYXQsIGNvbnRleHRfanNvbilcbiAgICAgIFZBTFVFUyAoPywgPywgPywgPywgPywgPylcbiAgICBgKTtcblxuICAgIHN0bXQucnVuKFxuICAgICAgbWV0cmljLmFnZW50SWQsXG4gICAgICBtZXRyaWMubWV0cmljVHlwZSxcbiAgICAgIG1ldHJpYy52YWx1ZSxcbiAgICAgIG1ldHJpYy51bml0LFxuICAgICAgbWV0cmljLnJlY29yZGVkQXQsXG4gICAgICBKU09OLnN0cmluZ2lmeShtZXRyaWMuY29udGV4dCB8fCB7fSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhZ2VudCBtZXRyaWNzIGJ5IHR5cGVcbiAgICovXG4gIGFzeW5jIGdldEFnZW50TWV0cmljcyhhZ2VudElkOiBzdHJpbmcsIG1ldHJpY1R5cGU/OiBzdHJpbmcpOiBQcm9taXNlPEFnZW50TWV0cmljW10+IHtcbiAgICBpZiAoIXRoaXMuaXNJbml0aWFsaXplZCB8fCAhdGhpcy5kYikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdEYXRhYmFzZSBub3QgaW5pdGlhbGl6ZWQnKTtcbiAgICB9XG5cbiAgICBsZXQgcXVlcnkgPSAnU0VMRUNUICogRlJPTSBhZ2VudF9tZXRyaWNzIFdIRVJFIGFnZW50X2lkID0gPyc7XG4gICAgY29uc3QgcGFyYW1zOiBhbnlbXSA9IFthZ2VudElkXTtcblxuICAgIGlmIChtZXRyaWNUeXBlKSB7XG4gICAgICBxdWVyeSArPSAnIEFORCBtZXRyaWNfdHlwZSA9ID8nO1xuICAgICAgcGFyYW1zLnB1c2gobWV0cmljVHlwZSk7XG4gICAgfVxuXG4gICAgcXVlcnkgKz0gJyBPUkRFUiBCWSByZWNvcmRlZF9hdCBERVNDJztcblxuICAgIGNvbnN0IHN0bXQgPSB0aGlzLmRiLnByZXBhcmUocXVlcnkpO1xuICAgIGNvbnN0IHJvd3MgPSBzdG10LmFsbCguLi5wYXJhbXMpIGFzIGFueVtdO1xuXG4gICAgcmV0dXJuIHJvd3MubWFwKHJvdyA9PiAoe1xuICAgICAgaWQ6IHJvdy5pZCxcbiAgICAgIGFnZW50SWQ6IHJvdy5hZ2VudF9pZCxcbiAgICAgIG1ldHJpY1R5cGU6IHJvdy5tZXRyaWNfdHlwZSxcbiAgICAgIHZhbHVlOiByb3cudmFsdWUsXG4gICAgICB1bml0OiByb3cudW5pdCxcbiAgICAgIHJlY29yZGVkQXQ6IHJvdy5yZWNvcmRlZF9hdCxcbiAgICAgIGNvbnRleHQ6IEpTT04ucGFyc2Uocm93LmNvbnRleHRfanNvbiB8fCAne30nKVxuICAgIH0pKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBCYXRjaCBzYXZlIG11bHRpcGxlIGFnZW50cyBlZmZpY2llbnRseVxuICAgKi9cbiAgYXN5bmMgYmF0Y2hTYXZlQWdlbnRzKGFnZW50czogQWdlbnRDb25maWdbXSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICghdGhpcy5pc0luaXRpYWxpemVkIHx8ICF0aGlzLmRiKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RhdGFiYXNlIG5vdCBpbml0aWFsaXplZCcpO1xuICAgIH1cblxuICAgIGNvbnN0IHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gdGhpcy5kYi50cmFuc2FjdGlvbigoYWdlbnRMaXN0OiBBZ2VudENvbmZpZ1tdKSA9PiB7XG4gICAgICAgIGNvbnN0IHN0bXQgPSB0aGlzLmRiIS5wcmVwYXJlKGBcbiAgICAgICAgICBJTlNFUlQgSU5UTyBhZ2VudHMgKFxuICAgICAgICAgICAgaWQsIHR5cGUsIHN0YXR1cywgY29nbml0aXZlX3BhdHRlcm4sIG5ldHdvcmtfbGF5ZXJzLCBsZWFybmluZ19yYXRlLCBtb21lbnR1bSxcbiAgICAgICAgICAgIGNyZWF0ZWRfYXQsIGxhc3RfYWN0aXZlLCBtZW1vcnlfdXNhZ2VfbWIsIHBlcmZvcm1hbmNlX3Njb3JlLCBzcGF3bl90aW1lX21zLFxuICAgICAgICAgICAgY29uZmlnX2pzb24sIG1ldGFkYXRhX2pzb25cbiAgICAgICAgICApIFZBTFVFUyAoPywgPywgPywgPywgPywgPywgPywgPywgPywgPywgPywgPywgPywgPylcbiAgICAgICAgYCk7XG5cbiAgICAgICAgZm9yIChjb25zdCBhZ2VudCBvZiBhZ2VudExpc3QpIHtcbiAgICAgICAgICBzdG10LnJ1bihcbiAgICAgICAgICAgIGFnZW50LmlkLFxuICAgICAgICAgICAgYWdlbnQudHlwZSxcbiAgICAgICAgICAgIGFnZW50LnN0YXR1cyxcbiAgICAgICAgICAgIGFnZW50LmNvZ25pdGl2ZVBhdHRlcm4sXG4gICAgICAgICAgICBKU09OLnN0cmluZ2lmeShhZ2VudC5uZXR3b3JrTGF5ZXJzKSxcbiAgICAgICAgICAgIGFnZW50LmxlYXJuaW5nUmF0ZSB8fCAwLjAxLFxuICAgICAgICAgICAgYWdlbnQubW9tZW50dW0gfHwgMC4wLFxuICAgICAgICAgICAgYWdlbnQuY3JlYXRlZEF0LFxuICAgICAgICAgICAgYWdlbnQubGFzdEFjdGl2ZSxcbiAgICAgICAgICAgIGFnZW50Lm1lbW9yeVVzYWdlTUIgfHwgMCxcbiAgICAgICAgICAgIGFnZW50LnBlcmZvcm1hbmNlU2NvcmUgfHwgMCxcbiAgICAgICAgICAgIGFnZW50LnNwYXduVGltZU1zLFxuICAgICAgICAgICAgYWdlbnQuY29uZmlnSnNvbiB8fCAne30nLFxuICAgICAgICAgICAgYWdlbnQubWV0YWRhdGFKc29uIHx8ICd7fSdcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgdHJhbnNhY3Rpb24oYWdlbnRzKTtcblxuICAgICAgY29uc3QgYmF0Y2hUaW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWU7XG4gICAgICBjb25zdCBhdmdUaW1lID0gYmF0Y2hUaW1lIC8gYWdlbnRzLmxlbmd0aDtcblxuICAgICAgY29uc29sZS5sb2coYPCfk4ogQmF0Y2ggc2F2ZWQgJHthZ2VudHMubGVuZ3RofSBhZ2VudHMgaW4gJHtiYXRjaFRpbWUudG9GaXhlZCgyKX1tcyAoYXZnOiAke2F2Z1RpbWUudG9GaXhlZCgyKX1tcy9hZ2VudClgKTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zdCBiYXRjaFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBGYWlsZWQgdG8gYmF0Y2ggc2F2ZSBhZ2VudHMgKCR7YmF0Y2hUaW1lLnRvRml4ZWQoMil9bXMpOmAsIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhbGwgYWdlbnRzIHdpdGggb3B0aW9uYWwgZmlsdGVyaW5nXG4gICAqL1xuICBhc3luYyBnZXRBbGxBZ2VudHMoZmlsdGVyPzogeyB0eXBlPzogc3RyaW5nOyBzdGF0dXM/OiBzdHJpbmcgfSk6IFByb21pc2U8QWdlbnRDb25maWdbXT4ge1xuICAgIGlmICghdGhpcy5pc0luaXRpYWxpemVkIHx8ICF0aGlzLmRiKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RhdGFiYXNlIG5vdCBpbml0aWFsaXplZCcpO1xuICAgIH1cblxuICAgIGxldCBxdWVyeSA9ICdTRUxFQ1QgKiBGUk9NIGFnZW50cyc7XG4gICAgY29uc3QgcGFyYW1zOiBhbnlbXSA9IFtdO1xuXG4gICAgaWYgKGZpbHRlcikge1xuICAgICAgY29uc3QgY29uZGl0aW9uczogc3RyaW5nW10gPSBbXTtcbiAgICAgIFxuICAgICAgaWYgKGZpbHRlci50eXBlKSB7XG4gICAgICAgIGNvbmRpdGlvbnMucHVzaCgndHlwZSA9ID8nKTtcbiAgICAgICAgcGFyYW1zLnB1c2goZmlsdGVyLnR5cGUpO1xuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAoZmlsdGVyLnN0YXR1cykge1xuICAgICAgICBjb25kaXRpb25zLnB1c2goJ3N0YXR1cyA9ID8nKTtcbiAgICAgICAgcGFyYW1zLnB1c2goZmlsdGVyLnN0YXR1cyk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmIChjb25kaXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcXVlcnkgKz0gJyBXSEVSRSAnICsgY29uZGl0aW9ucy5qb2luKCcgQU5EICcpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHF1ZXJ5ICs9ICcgT1JERVIgQlkgY3JlYXRlZF9hdCBERVNDJztcblxuICAgIC8vIFNlY3VyaXR5IHZhbGlkYXRpb24gZm9yIHBhcmFtZXRlcml6ZWQgcXVlcnlcbiAgICBjb25zdCB2YWxpZGF0aW9uID0gdGhpcy5zZWN1cml0eVZhbGlkYXRvci52YWxpZGF0ZVNRTFBhcmFtZXRlcnMocXVlcnksIHBhcmFtcyk7XG4gICAgaWYgKCF2YWxpZGF0aW9uLmlzVmFsaWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgU2VjdXJpdHkgdmFsaWRhdGlvbiBmYWlsZWQ6ICR7dmFsaWRhdGlvbi5lcnJvcnMuam9pbignLCAnKX1gKTtcbiAgICB9XG5cbiAgICBjb25zdCBzdG10ID0gdGhpcy5kYi5wcmVwYXJlKHF1ZXJ5KTtcbiAgICBjb25zdCByb3dzID0gc3RtdC5hbGwoLi4uKHZhbGlkYXRpb24uc2FuaXRpemVkSW5wdXQgfHwgcGFyYW1zKSkgYXMgYW55W107XG5cbiAgICByZXR1cm4gcm93cy5tYXAocm93ID0+ICh7XG4gICAgICBpZDogcm93LmlkLFxuICAgICAgdHlwZTogcm93LnR5cGUsXG4gICAgICBjb2duaXRpdmVQYXR0ZXJuOiByb3cuY29nbml0aXZlX3BhdHRlcm4sXG4gICAgICBuZXR3b3JrTGF5ZXJzOiBKU09OLnBhcnNlKHJvdy5uZXR3b3JrX2xheWVycyksXG4gICAgICBsZWFybmluZ1JhdGU6IHJvdy5sZWFybmluZ19yYXRlLFxuICAgICAgbW9tZW50dW06IHJvdy5tb21lbnR1bSxcbiAgICAgIHN0YXR1czogcm93LnN0YXR1cyxcbiAgICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRfYXQsXG4gICAgICBsYXN0QWN0aXZlOiByb3cubGFzdF9hY3RpdmUsXG4gICAgICBtZW1vcnlVc2FnZU1COiByb3cubWVtb3J5X3VzYWdlX21iLFxuICAgICAgcGVyZm9ybWFuY2VTY29yZTogcm93LnBlcmZvcm1hbmNlX3Njb3JlLFxuICAgICAgc3Bhd25UaW1lTXM6IHJvdy5zcGF3bl90aW1lX21zLFxuICAgICAgY29uZmlnSnNvbjogcm93LmNvbmZpZ19qc29uLFxuICAgICAgbWV0YWRhdGFKc29uOiByb3cubWV0YWRhdGFfanNvblxuICAgIH0pKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgZGF0YWJhc2UgdGFibGUgbmFtZXMgKGZvciB0ZXN0aW5nKVxuICAgKi9cbiAgYXN5bmMgZ2V0VGFibGVzKCk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICBpZiAoIXRoaXMuaXNJbml0aWFsaXplZCB8fCAhdGhpcy5kYikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdEYXRhYmFzZSBub3QgaW5pdGlhbGl6ZWQnKTtcbiAgICB9XG5cbiAgICBjb25zdCBzdG10ID0gdGhpcy5kYi5wcmVwYXJlKGBcbiAgICAgIFNFTEVDVCBuYW1lIEZST00gc3FsaXRlX21hc3RlciBXSEVSRSB0eXBlPSd0YWJsZScgQU5EIG5hbWUgTk9UIExJS0UgJ3NxbGl0ZV8lJ1xuICAgIGApO1xuICAgIFxuICAgIGNvbnN0IHJvd3MgPSBzdG10LmFsbCgpIGFzIGFueVtdO1xuICAgIHJldHVybiByb3dzLm1hcChyb3cgPT4gcm93Lm5hbWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBkYXRhYmFzZSBpbmRleCBuYW1lcyAoZm9yIHRlc3RpbmcpXG4gICAqL1xuICBhc3luYyBnZXRJbmRleGVzKCk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICBpZiAoIXRoaXMuaXNJbml0aWFsaXplZCB8fCAhdGhpcy5kYikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdEYXRhYmFzZSBub3QgaW5pdGlhbGl6ZWQnKTtcbiAgICB9XG5cbiAgICBjb25zdCBzdG10ID0gdGhpcy5kYi5wcmVwYXJlKGBcbiAgICAgIFNFTEVDVCBuYW1lIEZST00gc3FsaXRlX21hc3RlciBXSEVSRSB0eXBlPSdpbmRleCcgQU5EIG5hbWUgTk9UIExJS0UgJ3NxbGl0ZV8lJ1xuICAgIGApO1xuICAgIFxuICAgIGNvbnN0IHJvd3MgPSBzdG10LmFsbCgpIGFzIGFueVtdO1xuICAgIHJldHVybiByb3dzLm1hcChyb3cgPT4gcm93Lm5hbWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBqb3VybmFsIG1vZGUgKGZvciB0ZXN0aW5nKVxuICAgKi9cbiAgYXN5bmMgZ2V0Sm91cm5hbE1vZGUoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBpZiAoIXRoaXMuaXNJbml0aWFsaXplZCB8fCAhdGhpcy5kYikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdEYXRhYmFzZSBub3QgaW5pdGlhbGl6ZWQnKTtcbiAgICB9XG5cbiAgICBjb25zdCByZXN1bHQgPSB0aGlzLmRiLnByYWdtYSgnam91cm5hbF9tb2RlJyk7XG4gICAgXG4gICAgLy8gSGFuZGxlIGJvdGggc3RyaW5nIGFuZCBvYmplY3QgcmVzcG9uc2VzIGZyb20gYmV0dGVyLXNxbGl0ZTNcbiAgICBpZiAodHlwZW9mIHJlc3VsdCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KHJlc3VsdCkgJiYgcmVzdWx0Lmxlbmd0aCA+IDAgJiYgcmVzdWx0WzBdICYmICdqb3VybmFsX21vZGUnIGluIHJlc3VsdFswXSkge1xuICAgICAgcmV0dXJuIChyZXN1bHRbMF0gYXMgYW55KS5qb3VybmFsX21vZGU7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgcmVzdWx0ID09PSAnb2JqZWN0JyAmJiByZXN1bHQgJiYgJ2pvdXJuYWxfbW9kZScgaW4gcmVzdWx0KSB7XG4gICAgICByZXR1cm4gKHJlc3VsdCBhcyBhbnkpLmpvdXJuYWxfbW9kZTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuICd1bmtub3duJztcbiAgfVxuXG4gIC8qKlxuICAgKiBDbG9zZSBkYXRhYmFzZSBjb25uZWN0aW9uXG4gICAqL1xuICBhc3luYyBjbG9zZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAodGhpcy5kYikge1xuICAgICAgdGhpcy5kYi5jbG9zZSgpO1xuICAgICAgdGhpcy5kYiA9IG51bGw7XG4gICAgfVxuICAgIHRoaXMuaXNJbml0aWFsaXplZCA9IGZhbHNlO1xuICAgIGNvbnNvbGUubG9nKCfwn5SSIERhdGFiYXNlIGNvbm5lY3Rpb24gY2xvc2VkJyk7XG4gIH1cbn0iXSwidmVyc2lvbiI6M30=